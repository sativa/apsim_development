<folder name="New Simulations" image="Images/layout_center24.png" version="8">
  <simulation name="Blank Simulation">
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\goond.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1989</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Blank Simulation.sum</filename>
    </summaryfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
      </manager>
    </area>
  </simulation>
  <shared name="shared" />
  <simulation name="Continuous Wheat Simulation">
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\goond.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1989</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Wheat Simulation.sum</filename>
    </summaryfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Sowing rule">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], crop_class = [class]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-may</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jul</date2>
            <must_sow type="yesno" description="Must sow? : ">no</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">30</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">200</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">wheat</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">100</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">hartog</cultivar>
            <class type="classes" croppropertyname="crop" description="Enter crop growth class : ">plant</class>
            <row_spacing type="text" description="Enter row spacing (mm) : ">250</row_spacing>
          </category>
        </rule>
        <rule name="Harvesting rule">
          <condition name="end_of_day">

           if [crop].stage_name = 'harvest_ripe' or [crop].plant_status = 'dead' then
              [crop]  harvest
              [crop]  end_crop
           endif

            </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">wheat</crop>
          </category>
        </rule>
        <rule name="Sowing fertiliser">
          <condition name="[modulename].[eventname]">
        [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            </condition>
          <category name="When should fertiliser be applied">
            <modulename type="modulename" description="On which module should the event come from : ">wheat</modulename>
            <eventname type="text" description="On which event should fertiliser be applied : ">sowing</eventname>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type type="list" description="Organic Matter type" listvalues="inert,manure,fym,bambatsi,barley,broccoli,camaldulensis,canola,chickpea,cowpea,danthonia,globulus,grandis,fababean,fieldpea,grass,lablab,lucerne,lupin,maize,millet,mucuna,mungbean,horsegram,navybean,cotton,orobanche,peanut,pigeonpea,rice,soybean,sorghum,stylo,sugar,sunflower,sweetcorn,sweetsorghum,weed,wheat">wheat</type>
        <mass description="Initial surface residue (kg/ha)">1000.</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <wheat />
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="wheat.biomass" description="Biomass" array="?" units="kg/ha" />
          <variable name="wheat.yield" description="Yield" array="?" units="kg/ha" />
          <variable name="wheat.grain_protein" description="grain protein content" array="?" units="%" />
          <variable name="wheat.grain_size" description="Size of each grain" array="?" units="g" />
          <variable name="esw" array="?" description="Extractable Soil Water (mm)" VariableType="Water" />
        </variables>
        <events name="Reporting Frequency">
          <event name="wheat.harvesting" description="" />
        </events>
      </outputfile>
      <soil name="Jimbour,Waco (#016)">
        <Site>Jimbour</Site>
        <Region>South East Queensland</Region>
        <LocalName>Waco</LocalName>
        <SoilType>Black Vertosol</SoilType>
        <NearestTown>Jimbour, Q 4352</NearestTown>
        <NaturalVegetation>Grassland, mainly Qld bluegrass</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.15</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>1.04</oc>
            <ph>8.4</ph>
            <fbiom>0.025</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <ec>0.2</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.03</bd>
            <ll15>0.29</ll15>
            <airdry>0.26</airdry>
            <dul>0.53</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>8.8</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.25</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9</ph>
            <fbiom>0.015</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.31</ec>
            <ll name="Barley">0.32</ll>
            <kl name="Barley">0.08</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.36</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.39</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.35</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.4</ec>
            <ll name="Barley">0.38</ll>
            <kl name="Barley">0.06</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.43</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.08</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.38</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.06</bd>
            <ll15>0.3</ll15>
            <airdry>0.3</airdry>
            <dul>0.52</dul>
            <sat>0.57</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.77</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.59</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.04</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.51</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.3</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.37</ll>
            <kl name="Maize">0.06</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.09</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.35</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.11</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.45</oc>
            <ph>9.1</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.84</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.02</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.31</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.4</ll>
            <kl name="Maize">0.04</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.07</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.12</bd>
            <ll15>0.32</ll15>
            <airdry>0.32</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.27</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.93</ec>
            <ll name="Barley">0.41</ll>
            <kl name="Barley">0.01</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.32</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.42</ll>
            <kl name="Maize">0.02</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.05</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.41</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.15</bd>
            <ll15>0.33</ll15>
            <airdry>0.33</airdry>
            <dul>0.48</dul>
            <sat>0.53</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.22</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.48</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.48</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.33</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.48</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.48</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.48</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.18</bd>
            <ll15>0.34</ll15>
            <airdry>0.34</airdry>
            <dul>0.47</dul>
            <sat>0.52</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.16</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.06</ec>
            <ll name="Barley">0.47</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.47</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.34</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.47</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.47</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.47</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.35</ll15>
            <airdry>0.35</airdry>
            <dul>0.46</dul>
            <sat>0.51</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.13</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.05</ec>
            <ll name="Barley">0.46</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.46</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.35</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.46</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.46</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.46</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.25</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.44</dul>
            <sat>0.49</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.12</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.44</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.44</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.36</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.44</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.42</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.44</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.44</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitWater>
          <percentmethod>
            <percent>1</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.503</no3>
              <nh4>0.599</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.101</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.101</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Continuous Wheat Simulation with Climate Change">
    <memo name="Read Me">e1xydGYxXGFuc2lcYW5zaWNwZzEyNTJcZGVmZjBcZGVmbGFuZzMwODF7XGZvbnR0Ymx7XGYwXGZuaWxcZmNoYXJzZXQwIE1pY3Jvc29mdCBTYW5zIFNlcmlmO319DQpcdmlld2tpbmQ0XHVjMVxwYXJkXGYwXGZzMjkgQ2xpbWF0ZSBDaGFuZ2UgaW4gQVBTSU0gU2ltdWxhdGlvbnNcZnMxN1xwYXINClxwYXINClRvIHBlcmZvcm0gYSBzaW1wbGUgc2ltdWxhdGlvbiB0byBxdWFudGlmeSB0aGUgZWZmZWN0cyBvZiBjbGltYXRlIGNoYW5nZSBvbiBwcm9kdWN0aW9uIHN5c3RlbSBzaW1wbHkgZHJhZyBhIGNsaW1hdGUgY2hhbmdlIG9iamVjdCBmcm9tIHRoZSBzdGFuZGFyZCB0b29sYm93IG9udG8gdGhlIHNpbXVsYXRpb24gYXQgdGhlIHNhbWUgbGV2ZWwgYXMgeW91ciBtZXQgZmlsZS4gIFRoZSBjbGltYXRlIGNoYW5nZSB1c2VyIGludGVyZmFjZSB3aWxsIGFsbG93IHlvdSB0byBlbnRlciBzaW1wbGUgbW9kaWZpZXJzIChlaXRoZXIgYWRkaXRpdmUgb3IgbXVsdGlwbGljYXRpdmUpIGZvciBtYXhpbXVtIGFuZCBtaW5pbXVtIHRlbXBlcmF0dXJlLCBzb2xhciByYWRpYXRpb24gYW5kIHJhaW5mYWxsLlxwYXINClxwYXINCn0NCg==</memo>
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\goond.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1989</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Wheat Simulation with Climate Change.sum</filename>
    </summaryfile>
    <climatechange>
      <maxtmodifier description="Change in maximum temperature in degrees celsius">1</maxtmodifier>
      <mintmodifier description="Change in minimum temperature in degrees celsius">1</mintmodifier>
      <rainmodifier description="Relative change in rainfall">0.9</rainmodifier>
      <radiationmodifier description="Relative change in radiation">1.0</radiationmodifier>
      <co2 description="Atmospheric C02 concentration (ppm)">400</co2>
    </climatechange>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Sowing rule">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], crop_class = [class]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-may</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jul</date2>
            <must_sow type="yesno" description="Must sow? : ">no</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">30</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">200</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">wheat</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">100</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">hartog</cultivar>
            <class type="classes" croppropertyname="crop" description="Enter crop growth class : ">plant</class>
            <row_spacing type="text" description="Enter row spacing (mm) : ">250</row_spacing>
          </category>
        </rule>
        <rule name="Harvesting rule">
          <condition name="end_of_day">

           if [crop].stage_name = 'harvest_ripe' or [crop].plant_status = 'dead' then
              [crop]  harvest
              [crop]  end_crop
           endif

            </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">wheat</crop>
          </category>
        </rule>
        <rule name="Sowing fertiliser">
          <condition name="[modulename].[eventname]">
        [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            </condition>
          <category name="When should fertiliser be applied">
            <modulename type="modulename" description="On which module should the event come from : ">wheat</modulename>
            <eventname type="text" description="On which event should fertiliser be applied : ">sowing</eventname>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type type="list" description="Organic Matter type" listvalues="inert,manure,fym,bambatsi,barley,broccoli,camaldulensis,canola,chickpea,cowpea,danthonia,globulus,grandis,fababean,fieldpea,grass,lablab,lucerne,lupin,maize,millet,mucuna,mungbean,horsegram,navybean,cotton,orobanche,peanut,pigeonpea,rice,soybean,sorghum,stylo,sugar,sunflower,sweetcorn,sweetsorghum,weed,wheat">wheat</type>
        <mass description="Initial surface residue (kg/ha)">1000.</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <wheat />
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="wheat.biomass" description="Biomass" array="?" units="kg/ha" />
          <variable name="wheat.yield" description="Yield" array="?" units="kg/ha" />
          <variable name="wheat.grain_protein" description="grain protein content" array="?" units="%" />
          <variable name="wheat.grain_size" description="Size of each grain" array="?" units="g" />
          <variable name="esw" array="?" description="Extractable Soil Water (mm)" VariableType="Water" />
        </variables>
        <events name="Reporting Frequency">
          <event name="wheat.harvesting" description="" />
        </events>
      </outputfile>
      <soil name="Jimbour,Waco (#016)">
        <Site>Jimbour</Site>
        <Region>South East Queensland</Region>
        <LocalName>Waco</LocalName>
        <SoilType>Black Vertosol</SoilType>
        <NearestTown>Jimbour, Q 4352</NearestTown>
        <NaturalVegetation>Grassland, mainly Qld bluegrass</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.15</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>1.04</oc>
            <ph>8.4</ph>
            <fbiom>0.025</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <ec>0.2</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.03</bd>
            <ll15>0.29</ll15>
            <airdry>0.26</airdry>
            <dul>0.53</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>8.8</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.25</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9</ph>
            <fbiom>0.015</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.31</ec>
            <ll name="Barley">0.32</ll>
            <kl name="Barley">0.08</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.36</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.39</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.35</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.4</ec>
            <ll name="Barley">0.38</ll>
            <kl name="Barley">0.06</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.43</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.08</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.38</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.06</bd>
            <ll15>0.3</ll15>
            <airdry>0.3</airdry>
            <dul>0.52</dul>
            <sat>0.57</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.77</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.59</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.04</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.51</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.3</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.37</ll>
            <kl name="Maize">0.06</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.09</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.35</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.11</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.45</oc>
            <ph>9.1</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.84</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.02</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.31</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.4</ll>
            <kl name="Maize">0.04</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.07</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.12</bd>
            <ll15>0.32</ll15>
            <airdry>0.32</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.27</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.93</ec>
            <ll name="Barley">0.41</ll>
            <kl name="Barley">0.01</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.32</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.42</ll>
            <kl name="Maize">0.02</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.05</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.41</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.15</bd>
            <ll15>0.33</ll15>
            <airdry>0.33</airdry>
            <dul>0.48</dul>
            <sat>0.53</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.22</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.48</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.48</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.33</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.48</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.48</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.48</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.18</bd>
            <ll15>0.34</ll15>
            <airdry>0.34</airdry>
            <dul>0.47</dul>
            <sat>0.52</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.16</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.06</ec>
            <ll name="Barley">0.47</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.47</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.34</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.47</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.47</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.47</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.35</ll15>
            <airdry>0.35</airdry>
            <dul>0.46</dul>
            <sat>0.51</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.13</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.05</ec>
            <ll name="Barley">0.46</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.46</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.35</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.46</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.46</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.46</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.25</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.44</dul>
            <sat>0.49</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.12</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.44</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.44</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.36</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.44</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.42</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.44</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.44</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitWater>
          <percentmethod>
            <percent>1</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.503</no3>
              <nh4>0.599</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.101</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.101</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.701</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Continuous Sorghum Simulation">
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\goond.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1989</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Sorghum Simulation.sum</filename>
    </summaryfile>
    <area name="paddock">
      <registrations name="global" />
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="sorghum.biomass" description="Biomass" array="?" units="kg/ha" />
          <variable name="sorghum.yield" description="Yield" array="?" units="kg/ha" />
          <variable name="esw" array="?" description="Extractable Soil Water (mm)" VariableType="Water" />
        </variables>
        <events name="Reporting Frequency">
          <event name="sorghum.harvesting" description="" />
        </events>
      </outputfile>
      <manager name="Manager">
        <rule name="Sorghum Sowing rule">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], tiller_no_fertile = [ftn] (), skip = [skiprow]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-oct</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jan</date2>
            <must_sow type="yesno" description="Must sow? : ">no</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">30</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">200</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">sorghum</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">7</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">early</cultivar>
            <row_spacing type="text" description="Enter row spacing (m) : ">1</row_spacing>
            <ftn type="text" description="Enter Fertile Tiller No. : ">1</ftn>
            <skiprow type="list" listvalues="solid, single, double" description="Skip row : ">solid</skiprow>
          </category>
        </rule>
        <rule name="Harvesting rule">
          <condition name="end_of_day">

           if [crop].stage_name = 'harvest_ripe' or [crop].plant_status = 'dead' then
              [crop]  harvest
              [crop]  end_crop
           endif

            </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">sorghum</crop>
          </category>
        </rule>
        <rule name="Sowing fertiliser">
          <condition name="[modulename].[eventname]">
        [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            </condition>
          <category name="When should fertiliser be applied">
            <modulename type="modulename" description="On which module should the event come from : ">sorghum</modulename>
            <eventname type="text" description="On which event should fertiliser be applied : ">sowing</eventname>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type type="list" description="Organic Matter type" listvalues="inert,manure,fym,bambatsi,barley,broccoli,camaldulensis,canola,chickpea,cowpea,danthonia,globulus,grandis,fababean,fieldpea,grass,lablab,lucerne,lupin,maize,millet,mucuna,mungbean,horsegram,navybean,cotton,orobanche,peanut,pigeonpea,rice,soybean,sorghum,stylo,sugar,sunflower,sweetcorn,sweetsorghum,weed,wheat">wheat</type>
        <mass description="Initial surface residue (kg/ha)">1000.</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <sorghum />
      <soil name="Jimbour,Waco (#16)">
        <Site>Jimbour</Site>
        <Region>South East Queensland</Region>
        <LocalName>Waco</LocalName>
        <SoilType>Black Vertosol</SoilType>
        <NearestTown>Jimbour, Q 4352</NearestTown>
        <NaturalVegetation>Grassland, mainly Qld bluegrass</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.145</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>1.04</oc>
            <ph>8.4</ph>
            <fbiom>0.025</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <ec>0.2</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.03</bd>
            <ll15>0.29</ll15>
            <airdry>0.26</airdry>
            <dul>0.53</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>8.8</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.25</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9</ph>
            <fbiom>0.015</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.31</ec>
            <ll name="Barley">0.32</ll>
            <kl name="Barley">0.08</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.36</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.39</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.35</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.4</ec>
            <ll name="Barley">0.38</ll>
            <kl name="Barley">0.06</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.43</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.08</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.38</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.06</bd>
            <ll15>0.3</ll15>
            <airdry>0.3</airdry>
            <dul>0.52</dul>
            <sat>0.57</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.77</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.59</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.04</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.51</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.3</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.37</ll>
            <kl name="Maize">0.06</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.09</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.35</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.11</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.45</oc>
            <ph>9.1</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.84</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.02</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.31</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.4</ll>
            <kl name="Maize">0.04</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.07</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.12</bd>
            <ll15>0.32</ll15>
            <airdry>0.32</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.27</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.93</ec>
            <ll name="Barley">0.41</ll>
            <kl name="Barley">0.01</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.32</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.42</ll>
            <kl name="Maize">0.02</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.05</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.41</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.15</bd>
            <ll15>0.33</ll15>
            <airdry>0.33</airdry>
            <dul>0.48</dul>
            <sat>0.53</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.22</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.48</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.48</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.33</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.48</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.48</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.48</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.18</bd>
            <ll15>0.34</ll15>
            <airdry>0.34</airdry>
            <dul>0.47</dul>
            <sat>0.52</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.16</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.06</ec>
            <ll name="Barley">0.47</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.47</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.34</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.47</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.47</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.47</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.35</ll15>
            <airdry>0.35</airdry>
            <dul>0.46</dul>
            <sat>0.51</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.13</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.05</ec>
            <ll name="Barley">0.46</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.46</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.35</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.46</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.46</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.46</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.25</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.44</dul>
            <sat>0.49</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.12</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.44</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.44</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.36</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.44</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.42</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.44</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.44</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitWater>
          <percentmethod>
            <percent>1</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.500</no3>
              <nh4>0.600</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Eucalypt Forest Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1987</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1997</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Eucalypt Forest Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\Toolara.met</filename>
    </metfile>
    <area name="Block">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Planting rule">
          <condition name="start_of_day">
         if (date('[date1]') = today) and [crop].plant_status = 'out' then
               [crop]  establish plants =[density], init_section = seedling
         endif
            </condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter planting date (dd-mmm) : ">15-mar</date1>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of growth module to sow : ">egrandis</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">1111</density>
          </category>
        </rule>
        <rule name="Establishment fertiliser">
          <condition name="[modulename].[eventname]">
        [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            </condition>
          <category name="When should fertiliser be applied">
            <modulename type="modulename" description="For which module is fertiliser applied : ">egrandis</modulename>
            <eventname type="text" description="On which event should fertiliser be applied : ">establishing</eventname>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
        <rule name="Fertilise on a date">
          <condition name="start_of_day">
            if (date('[date1]') = today) then
               [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            endif
        </condition>
          <category name="When should fertiliser be applied">
            <date1 type="ddmmmdate" description="Enter application date (dd-mmm) : ">15-mar</date1>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of fertiliser to apply (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="LitterLayer">
        <PoolName>egrandis</PoolName>
        <type>grandis</type>
        <mass>1000.</mass>
        <cnr>80.0</cnr>
        <standing_fraction>0.0</standing_fraction>
      </surfaceom>
      <micromet name="micromet">
        <soilalbedo name="soilalbedo">0.23</soilalbedo>
        <a_interception name="a_interception">0.0</a_interception>
        <b_interception name="b_interception">0.0</b_interception>
        <c_interception name="c_interception">0.1</c_interception>
        <d_interception name="d_interception">0.0</d_interception>
      </micromet>
      <egrandis />
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="esw" array="?" description="Extractable Soil Water (mm)" VariableType="Water" />
          <variable name="egrandis.lai" description="E. grandis leaf area index" array="?" />
          <variable name="egrandis.adm_green" array="?" description="E. grandis Live Above-ground Biomass Pools" />
          <variable name="egrandis.fw" description="E. grandis water stress factor" array="?" />
          <variable name="egrandis.fn" description="E. grandis N stress factor" array="?" />
          <variable name="egrandis.plants" description="E. grandis Plant Population" array="?" />
        </variables>
        <events name="Reporting Frequency">
          <event name="post" description="End of daily simulation time step" />
        </events>
      </outputfile>
      <soil name="UniformSoil">
        <Site>Hypothetical</Site>
        <Region />
        <LocalName>Uniform</LocalName>
        <SoilType>Loam</SoilType>
        <NearestTown />
        <NaturalVegetation />
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>1</oc>
            <ph>6</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.2</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.07</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.9</oc>
            <ph>6</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.2</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.07</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.9</oc>
            <ph>6</ph>
            <fbiom>0.02</fbiom>
            <finert>0.8</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.3</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.07</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.9</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.4</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.06</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.8</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.6</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.04</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.4</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.8</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.03</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.3</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>0.9</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.03</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.2</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>1</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.03</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.2</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>1.1</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.02</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.1</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>1</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.02</kl>
            <xf name="egrandis">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.1</ll15>
            <airdry>0.07</airdry>
            <dul>0.2</dul>
            <sat>0.3</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.1</oc>
            <ph>6</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1</no3>
            <nh4>0.1</nh4>
            <ec>1</ec>
            <ll name="egrandis">0.1</ll>
            <kl name="egrandis">0.02</kl>
            <xf name="egrandis">1</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>88</DiffusConst>
        <DiffusSlope>35.4</DiffusSlope>
        <U>4</U>
        <Salb>0.13</Salb>
        <Cn2Bare>65</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>60</RootCn>
        <RootWt>1000</RootWt>
        <SoilCn>20</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitWater>
          <percentmethod>
            <percent>0.5</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Sugar Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1944</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1993</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Sugar Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\ingham.met</filename>
    </metfile>
    <area name="paddock">
      <registrations name="global" />
      <sugar />
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="sugar.biomass" description="Sugar total above-ground biomass (green + trash) (g/m2)" array="?" />
          <variable name="sugar.cane_wt" description="Sugar cane dry weight (g/m2)" array="?" />
          <variable name="sugar.sucrose_wt" description="Sugar sucrose weight (g/m2)" array="?" />
          <variable name="sugar.sw_demand" description="Sugar crop demand for water (potential uptake) (mm)" array="?" />
          <variable name="sugar.das" description="Sugar days after sowing" array="?" />
          <variable name="sugar.ratoon_no" description="Sugar Ratoon number" array="?" />
          <variable name="sugar.crop_status" description="Sugar Crop status (dead,alive,out)" array="?" />
          <variable name="sugar.esw" array="?" description="Extractable Soil Water (mm)" VariableType="Water" />
          <variable name="sugar.lai" description="Sugar green leaf area index" array="?" />
          <variable name="sugar.nfact_photo" description="Sugar Nitrogen stress factor on photosynthesis (0-1)" array="?" />
          <variable name="sugar.root_depth" description="Sugar depth of roots (mm)" array="?" />
          <variable name="sugar.swdef_photo" description="Sugar water stress factor on photosynthesis (0-1)" array="?" />
          <variable name="sugar.canefw" description="Sugar cane fresh weight (t/ha)" array="?" />
          <variable name="radn" description="Solar Radiation (MJ/m2/day)" array="?" />
          <variable name="rain" description="Rainfall (mm)" array="?" />
          <variable name="maxt" description="Maximum temperature (oC)" array="?" />
          <variable name="mint" description="Minimum temperature (oC)" array="?" />
        </variables>
        <events name="Reporting Frequency">
          <event name="post" description="End of daily simulation time step" />
        </events>
      </outputfile>
      <fertiliser name="fertiliser" />
      <manager name="Manager">
        <rule name="SUGAR management">
          <condition name="start_of_day"><![CDATA[
            ! -----------------------------------------------------------------
            ! Book keeping to round days to integer values
            plantlen = nearest_int(plantlen)
            ratoonlen = nearest_int(ratoonlen)

            ! Initialise and set a time counter for entire run
            dah = 0

            if (sugar.crop_status = 'alive') then
               dah = 0

               ! Set harvest dates for each crop phase
               if (sugar.das = [plantlen] and ratoon_no = 0) or
                  (sugar.das = [ratoonlen] and ratoon_no > 0) then

                  sugar harvest

                  if (ratoon_no = [NoRatoons] + 1) then
                     ! plough the crop out
                     sugar kill_crop
                     sugar end_crop

                  else
                     ! Set stalk density
                     sugar.plants = [ratoon_stalks]
                  endif
               else
                  ! We have not reached the harvest date for this ratoon.
               endif

            elseif (sugar.crop_status = 'dead') then
               sugar harvest
               sugar end_crop

            elseif (sugar.crop_status = 'out') and (today = date('[planting_day]') then
               sugar sow plants = 10 (), cultivar = [variety], sowing_depth = [sowing_depth]
               sugar.plants = [plant_stalks]
               dah = 0

            else
               dah = dah + 1
            endif
               ]]></condition>
          <category name="Sugar plant crop management parameters">
            <crop type="crop" description="Enter name of crop to sow : ">sugar</crop>
            <planting_day type="ddmmmdate" description="Enter planting date (dd-mmm) : ">1-apr</planting_day>
            <plantlen type="text" description="Duration of a plant crop (days) (30 days/month * 15 months) : ">450</plantlen>
            <plant_stalks type="text" description="Stalk density of plant crop (/m2) :">10</plant_stalks>
            <variety type="list" listvalues="q117,q96,q138,ts65-28,h73,q141,nco376,n12,n14,cp51,r570,m1356,m55560,q124" description="Planting variety :">q117</variety>
            <sowing_depth type="text" description="Planting depth mm) :">150</sowing_depth>
          </category>
          <category name="Ratoon management parameters">
            <NoRatoons type="text" description="Number of ratoons (max = 5): ">4</NoRatoons>
            <ratoonlen type="text" description="Duration of a ratoon crop (days) (30 days/month * 13 months) : ">390</ratoonlen>
            <ratoon_stalks type="text" description="Stalk density of ratoon crop (/m2) :">10</ratoon_stalks>
          </category>
        </rule>
        <rule name="Fertilise on fixed date">
          <condition name="start_of_day"><![CDATA[
         if (today = date('[fert_date]') then
            N_topsoil = no3(1) + nh4(1) + no3(2) + nh4(2)
            if (N_topsoil < [fert_criteria]) then
               [fertmodule] apply amount = [fert_amount] (kg/ha), depth = 50 (mm), type = [fert_type] ()
            endif
         endif ]]></condition>
          <category name="When should fertiliser be applied">
            <fert_date type="ddmmmdate" description="Enter fertiliser date (dd-mmm) : ">01-sep</fert_date>
            <fert_criteria type="text" description="Don't add fertiliser if N in top 2 layers exceeds (kg/ha) : ">1000</fert_criteria>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount type="text" description="Amount of fertiliser to apply (kg/ha) : ">200</fert_amount>
            <fert_type type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type>
          </category>
        </rule>
      </manager>
      <soil name="Sample Soil">
        <Site>Jimbour</Site>
        <Region>South East Queensland</Region>
        <LocalName>Waco</LocalName>
        <SoilType>Black Vertosol</SoilType>
        <NearestTown>Jimbour, Q 4352</NearestTown>
        <NaturalVegetation>Grassland, mainly Qld bluegrass</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.14</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>1.04</oc>
            <ph>8.4</ph>
            <fbiom>0.025</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <ec>0.2</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.29</ll>
            <kl name="Sugar">0.1</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.03</bd>
            <ll15>0.29</ll15>
            <airdry>0.26</airdry>
            <dul>0.53</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>8.8</ph>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.25</ec>
            <ll name="Barley">0.29</ll>
            <kl name="Barley">0.1</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.29</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.29</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.29</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.29</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.29</ll>
            <kl name="Sugar">0.1</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.59</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9</ph>
            <fbiom>0.015</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <ec>0.31</ec>
            <ll name="Barley">0.32</ll>
            <kl name="Barley">0.08</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.36</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.1</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.39</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.35</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.32</ll>
            <kl name="Sugar">0.08</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.02</bd>
            <ll15>0.29</ll15>
            <airdry>0.29</airdry>
            <dul>0.54</dul>
            <sat>0.58</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.89</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.4</ec>
            <ll name="Barley">0.38</ll>
            <kl name="Barley">0.06</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.43</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.29</ll>
            <kl name="Lucerne">0.1</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.34</ll>
            <kl name="Maize">0.08</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.1</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.38</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.32</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.32</ll>
            <kl name="Sugar">0.06</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.06</bd>
            <ll15>0.3</ll15>
            <airdry>0.3</airdry>
            <dul>0.52</dul>
            <sat>0.57</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.77</oc>
            <ph>9.2</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.59</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.04</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.51</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.3</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.37</ll>
            <kl name="Maize">0.06</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.09</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.35</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.35</ll>
            <kl name="Sugar">0.04</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.11</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.45</oc>
            <ph>9.1</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.84</ec>
            <ll name="Barley">0.39</ll>
            <kl name="Barley">0.02</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.31</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.4</ll>
            <kl name="Maize">0.04</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0.07</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.38</ll>
            <kl name="Sugar">0.02</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.12</bd>
            <ll15>0.32</ll15>
            <airdry>0.32</airdry>
            <dul>0.5</dul>
            <sat>0.55</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.27</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>0.93</ec>
            <ll name="Barley">0.41</ll>
            <kl name="Barley">0.01</kl>
            <xf name="Barley">1</xf>
            <ll name="Chickpea">0.5</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Lucerne">0.32</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.42</ll>
            <kl name="Maize">0.02</kl>
            <xf name="Maize">1</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0.05</kl>
            <xf name="Perennial Grass">1</xf>
            <ll name="Sorghum">0.4</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.41</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
            <ll name="Sugar">0.41</ll>
            <kl name="Sugar">0.01</kl>
            <xf name="Sugar">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.15</bd>
            <ll15>0.33</ll15>
            <airdry>0.33</airdry>
            <dul>0.48</dul>
            <sat>0.53</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.22</oc>
            <ph>9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.48</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.48</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.33</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.48</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.41</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.48</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.48</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
            <ll name="Sugar">0.48</ll>
            <kl name="Sugar">0</kl>
            <xf name="Sugar">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.18</bd>
            <ll15>0.34</ll15>
            <airdry>0.34</airdry>
            <dul>0.47</dul>
            <sat>0.52</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.16</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.06</ec>
            <ll name="Barley">0.47</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.47</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.34</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.47</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.47</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.47</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
            <ll name="Sugar">0.47</ll>
            <kl name="Sugar">0</kl>
            <xf name="Sugar">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.2</bd>
            <ll15>0.35</ll15>
            <airdry>0.35</airdry>
            <dul>0.46</dul>
            <sat>0.51</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.13</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.05</ec>
            <ll name="Barley">0.46</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.46</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.35</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.46</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.4</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.46</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.46</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
            <ll name="Sugar">0.46</ll>
            <kl name="Sugar">0</kl>
            <xf name="Sugar">0</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.25</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.44</dul>
            <sat>0.49</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <oc>0.12</oc>
            <ph>8.9</ph>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <ec>1.01</ec>
            <ll name="Barley">0.44</ll>
            <kl name="Barley">0</kl>
            <xf name="Barley">0</xf>
            <ll name="Chickpea">0.44</ll>
            <kl name="Chickpea">0</kl>
            <xf name="Chickpea">0</xf>
            <ll name="Lucerne">0.36</ll>
            <kl name="Lucerne">0.09</kl>
            <xf name="Lucerne">1</xf>
            <ll name="Maize">0.44</ll>
            <kl name="Maize">0</kl>
            <xf name="Maize">0</xf>
            <ll name="Perennial Grass">0.42</ll>
            <kl name="Perennial Grass">0</kl>
            <xf name="Perennial Grass">0</xf>
            <ll name="Sorghum">0.44</ll>
            <kl name="Sorghum">0</kl>
            <xf name="Sorghum">0</xf>
            <ll name="Wheat">0.44</ll>
            <kl name="Wheat">0</kl>
            <xf name="Wheat">0</xf>
            <ll name="Sugar">0.44</ll>
            <kl name="Sugar">0</kl>
            <xf name="Sugar">0</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitWater>
          <percentmethod>
            <percent>0.5004617</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.500</no3>
              <nh4>0.600</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Rotation Sample">
    <metfile name="met">
      <filename name="filename">%apsuite\apsim\met\sample\goond.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">31/12/1950</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Rotation Sample.sum</filename>
    </summaryfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="CottonSowing">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants_pm =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">10-Oct</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-Dec</date2>
            <must_sow type="yesno" description="Must sow? : ">yes</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">10</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">100</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">cotton</crop>
            <density type="text" description="Enter sowing density  (plants/m row) : ">10</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">Siok</cultivar>
            <row_spacing type="text" description="Enter row spacing (mm) : ">1000</row_spacing>
            <skip type="text" description="Enter Skip Row (0=solid, 1=single, 2=double) : ">0</skip>
          </category>
        </rule>
        <rule name="ChickPeaSowing">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], crop_class = [class]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-may</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jul</date2>
            <must_sow type="yesno" description="Must sow? : ">no</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">25</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">50</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">chickpea</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">25</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">amethyst</cultivar>
            <class type="classes" croppropertyname="crop" description="Enter crop growth class : ">plant</class>
            <row_spacing type="text" description="Enter row spacing (mm) : ">500</row_spacing>
          </category>
        </rule>
        <rule name="WheatSowing">
          <condition name="start_of_day"><![CDATA[
      if (paddock_is_fallow() = 1 and FallowIn <> 'yes' and (NextCrop = 0 or NextCrop = '[crop]')) then
         if (date_within('[date1], [date2]') = 1) then
            if (rain[[rainnumdays]] >= [raincrit] AND esw >= [esw_amount]) OR
                ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN
               ChooseNextCrop = 'yes'   ! for rotations
               [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing], crop_class = [class]
            endif
            if today = date('[date2]') then
               ChooseNextCrop = 'yes'
            endif
         endif
      endif
            ]]></condition>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm) : ">15-may</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm) : ">10-jul</date2>
            <must_sow type="yesno" description="Must sow? : ">no</must_sow>
            <raincrit type="text" description="Amount of rainfall : ">25</raincrit>
            <rainnumdays type="text" description="Number of days of rainfall : ">3</rainnumdays>
            <esw_amount type="text" description="Enter minimum allowable available soil water (mm) : ">50</esw_amount>
          </category>
          <category name="Sowing parameters">
            <crop type="crop" description="Enter name of crop to sow : ">wheat</crop>
            <density type="text" description="Enter sowing density  (plants/m2) : ">100</density>
            <depth type="text" description="Enter sowing depth  (mm) : ">30</depth>
            <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">hartog</cultivar>
            <class type="classes" croppropertyname="crop" description="Enter crop growth class : ">plant</class>
            <row_spacing type="text" description="Enter row spacing (mm) : ">250</row_spacing>
          </category>
        </rule>
        <rule name="CottonHarvesting">
          <condition name="end_of_day"><![CDATA[

           if (ozcot_status > 0) then
              [crop]  harvest

           endif

            ]]></condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">cotton</crop>
          </category>
        </rule>
        <rule name="ChickPeaHarvesting">
          <condition name="end_of_day">

           if [crop].stage_name = 'harvest_ripe' or [crop].plant_status = 'dead' then
              [crop]  harvest
              [crop]  end_crop
           endif

            </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">chickpea</crop>
          </category>
        </rule>
        <rule name="WheatHarvesting">
          <condition name="end_of_day">

           if [crop].stage_name = 'harvest_ripe' or [crop].plant_status = 'dead' then
              [crop]  harvest
              [crop]  end_crop
           endif

            </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">wheat</crop>
          </category>
        </rule>
        <rule name="Fertilise at sowing">
          <condition name="[modulename].[eventname]">
        [fertmodule] apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow]
            </condition>
          <category name="When should fertiliser be applied">
            <modulename type="modulename" description="On which module should the event come from : ">wheat</modulename>
            <eventname type="text" description="On which event should fertiliser be applied : ">sowing</eventname>
          </category>
          <category name="Fertiliser application details">
            <fertmodule type="modulename" description="Module used to apply the fertiliser : ">fertiliser</fertmodule>
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha) : ">150</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Sowing fertiliser type : ">urea_N</fert_type_sow>
          </category>
        </rule>
        <rule name="Rotations">
          <condition name="init">
         NextCropIndex = 1
         NextCrop = ' '
         ChooseNextCrop = 'yes'
         SummerFallowIn = 'no'
         WinterFallowIn = 'no'
         FallowIn = 'no'
      </condition>
          <condition name="start_of_day">
      if (ChooseNextCrop = 'yes') then
         if (NextCropIndex = 1) then
            NextCrop = '[crop1]'
         elseif (NextCropIndex = 2) then
            NextCrop = '[crop2]'
         elseif (NextCropIndex = 3) then
            NextCrop = '[crop3]'
         elseif (NextCropIndex = 4) then
            NextCrop = '[crop4]'
         elseif (NextCropIndex = 5) then
            NextCrop = '[crop5]'
         elseif (NextCropIndex = 6) then
            NextCrop = '[crop6]'
         elseif (NextCropIndex = 7) then
            NextCrop = '[crop7]'
         elseif (NextCropIndex = 8) then
            NextCrop = '[crop8]'
         elseif (NextCropIndex = 9) then
            NextCrop = '[crop9]'
         elseif (NextCropIndex = 10) then
            NextCrop = '[crop10]'
         elseif (NextCropIndex = 11) then
            NextCrop = '[crop11]'
         elseif (NextCropIndex = 12) then
            NextCrop = '[crop12]'
         elseif (NextCropIndex = 13) then
            NextCrop = '[crop13]'
         elseif (NextCropIndex = 14) then
            NextCrop = '[crop14]'
         elseif (NextCropIndex = 15) then
            NextCrop = '[crop15]'
         elseif (NextCropIndex = 16) then
            NextCrop = '[crop16]'
         elseif (NextCropIndex = 17) then
            NextCrop = '[crop17]'
         elseif (NextCropIndex = 18) then
            NextCrop = '[crop18]'
         elseif (NextCropIndex = 19) then
            NextCrop = '[crop19]'
         elseif (NextCropIndex = 20) then
            NextCrop = '[crop20]'
         endif
         if (NextCrop = 'nil' or NextCrop = ' ') then
            NextCrop = '[crop1]'
            NextCropIndex = 1
         endif
         NextCropIndex = NextCropIndex + 1
         ChooseNextCrop = 'no'
      endif
      ! if the next crop is due to be a fallow and we're within the
      ! correct date range then put a fallow in.
      if (NextCrop = '[WinterFallowName]') then
         if (paddock_is_fallow() = 1 and FallowIn = 'no') then
            if (date_within('[SummerFallowEndDate], [WinterFallowEndDate]') then
               WinterFallowIn = 'yes'
               FallowIn = 'yes'
               ChooseNextCrop = 'yes'
            endif
         endif
      elseif (NextCrop = '[SummerFallowName]') then
         if (paddock_is_fallow() = 1 and FallowIn = 'no') then
            if (date_within('[WinterFallowEndDate], [SummerFallowEndDate]') then
               SummerFallowIn = 'yes'
               FallowIn = 'yes'
               ChooseNextCrop = 'yes'
            endif
         endif
      endif

      ! if we currently have a fallow in and we're at the end of the fallow window
      ! then remove the fallow.
      if (WinterFallowIn = 'yes' and today = date('[WinterFallowEndDate]')+1) then
         WinterFallowIn = 'no'
         FallowIn = 'no'
      endif
      if (SummerFallowIn = 'yes' and today = date('[SummerFallowEndDate]')+1) then
         SummerFallowIn = 'no'
         FallowIn = 'no'
      endif
      </condition>
          <category name="Fallow options">
            <SummerFallowName type="text" description="Enter summer fallow name : ">sf</SummerFallowName>
            <SummerFallowEndDate type="text" description="Enter summer fallow END date (dd-mmm) : ">15-mar</SummerFallowEndDate>
            <WinterFallowName type="text" description="Enter winter fallow name : ">wf</WinterFallowName>
            <WinterFallowEndDate type="text" description="Enter winter fallow END date (dd-mmm) : ">23-aug</WinterFallowEndDate>
          </category>
          <category name="Crop rotation sequence">
            <crop1 type="crop" description="Enter 1st crop : ">cotton</crop1>
            <crop2 type="crop" description="Enter 2nd crop : ">chickpea</crop2>
            <crop3 type="crop" description="Enter 3rd crop : ">sf</crop3>
            <crop4 type="crop" description="Enter 4th crop : ">wheat</crop4>
            <crop5 type="crop" description="Enter 5th crop : ">sf</crop5>
            <crop6 type="crop" description="Enter 6th crop : ">wf</crop6>
            <crop7 type="crop" description="Enter 7th crop : ">nil</crop7>
            <crop8 type="crop" description="Enter 8th crop : ">nil</crop8>
            <crop9 type="crop" description="Enter 9th crop : ">nil</crop9>
            <crop10 type="crop" description="Enter 10th crop : ">nil</crop10>
            <crop11 type="crop" description="Enter 11th crop : ">nil</crop11>
            <crop12 type="crop" description="Enter 12th crop : ">nil</crop12>
            <crop13 type="crop" description="Enter 13th crop : ">nil</crop13>
            <crop14 type="crop" description="Enter 14th crop : ">nil</crop14>
            <crop15 type="crop" description="Enter 15th crop : ">nil</crop15>
            <crop16 type="crop" description="Enter 16th crop : ">nil</crop16>
            <crop17 type="crop" description="Enter 17th crop : ">nil</crop17>
            <crop18 type="crop" description="Enter 18th crop : ">nil</crop18>
            <crop19 type="crop" description="Enter 19th crop : ">nil</crop19>
            <crop20 type="crop" description="Enter 20th crop : ">nil</crop20>
          </category>
        </rule>
      </manager>
      <wheat />
      <ozcot name="cotton" />
      <chickpea />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat_stubble</PoolName>
        <type type="list" description="Organic Matter type" listvalues="inert,manure,fym,bambatsi,barley,broccoli,camaldulensis,canola,chickpea,cowpea,danthonia,globulus,grandis,fababean,fieldpea,grass,lablab,lucerne,lupin,maize,millet,mucuna,mungbean,horsegram,navybean,cotton,orobanche,peanut,pigeonpea,rice,soybean,sorghum,stylo,sugar,sunflower,sweetcorn,sweetsorghum,weed,wheat">wheat</type>
        <mass description="Initial surface residue (kg/ha)">1000.</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="cotton.dm as Cotton.Biomass" description="Total above ground biomass (kg/ha)" array="?" />
          <variable name="biomass" description="Biomass" array="No" />
          <variable name="lai" description="Leaf area index" array="No" />
        </variables>
        <events name="Reporting Frequency">
          <event name="Daily" description="End of day" />
        </events>
      </outputfile>
      <fertiliser name="fertiliser" />
      <soil name="#009 - Kupunn">
        <Site>Kupunn</Site>
        <Region>South East Queensland</Region>
        <LocalName>Brigalow</LocalName>
        <SoilType>Grey Vertosol</SoilType>
        <NearestTown>Dalby, Q 4405</NearestTown>
        <NaturalVegetation>Brigalow, belah, wilga</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.4</bd>
            <ll15>0.21</ll15>
            <airdry>0.105</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.03</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <oc>1.24</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.21</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.21</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.21</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.21</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.39</bd>
            <ll15>0.21</ll15>
            <airdry>0.189</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <oc>1.24</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.21</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.21</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.21</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.21</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.37</bd>
            <ll15>0.22</ll15>
            <airdry>0.22</airdry>
            <dul>0.4</dul>
            <sat>0.45</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <oc>1.25</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.22</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.22</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.26</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.25</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.36</bd>
            <ll15>0.25</ll15>
            <airdry>0.25</airdry>
            <dul>0.41</dul>
            <sat>0.46</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>1.1</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.27</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.25</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.26</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.28</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.38</bd>
            <ll15>0.27</ll15>
            <airdry>0.27</airdry>
            <dul>0.4</dul>
            <sat>0.45</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.71</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.27</ll>
            <kl name="Cotton">0.09</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.28</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.31</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.39</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.34</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.34</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.31</ll>
            <kl name="Cotton">0.07</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.34</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.37</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.42</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.38</dul>
            <sat>0.43</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.26</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.38</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.36</ll>
            <kl name="Cotton">0.05</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.36</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <Comment>oc and ph not measured</Comment>
        <InitWater>
          <percentmethod>
            <percent>1</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.500</no3>
              <nh4>0.600</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Rotation Sample 2">
    <memo name="Readme">e1xydGYxXGFuc2lcYW5zaWNwZzEyNTJcZGVmZjBcZGVmbGFuZzMwODF7XGZvbnR0Ymx7XGYwXGZuaWxcZmNoYXJzZXQwIE1pY3Jvc29mdCBTYW5zIFNlcmlmO319DQpcdmlld2tpbmQ0XHVjMVxwYXJkXGYwXGZzMjkgVGhpcyBzaW11bGF0aW9uIGlzIGEgZGVtb25zdHJhdGlvbiBvZiB0b29scyBkZXZlbG9wZWQgYXMgcGFydCBvZiB0aGUgQ1FTRlMgcHJvamVjdCAtIHdoaWNoIGhhcyBiZWVuIGludmVzdGlnYXRpbmcgdGhlIHByb2JsZW0gb2Ygc2ltdWxhdGluZyByZXNvdXJjZSBtYW5hZ2VtZW50IGF0IGEgZmFybSBsZXZlbCAtIGllIHNpbXVsYXRpb24gb2YgcGFkZG9ja3MgYW5kIHRoZWlyIG1hbmFnZW1lbnQgd2l0aCBhcHNpbS4gQSBtYWpvciBvdXRjb21lIGhhcyBiZWVuIHRoZSB1c2Ugb2YgbGFuZ3VhZ2VzIHRoYXQgc3VwcG9ydCBjb21wbGV4IGRhdGEgc3RydWN0dXJlcyAmIHByb2NlZHVyZXMgdG8gbW9kZWwgZmFybSBkZWNpc2lvbiBtYWtpbmcuXHBhcg0KXHBhcg0KXHBhcg0KVGhlIHJvdGF0aW9uIGlzIGRlc2NyaWJlZCBhcyBhIERpcmVjdGVkIEdyYXBoIGNvbXByaXNlZCBvZiBub2RlcyAmIGVkZ2VzOiBccGFyDQogIC0gdGhlIHN0YXRlIG9mIHRoZSBwYWRkb2NrIGlzIGEgbm9kZSBvbiB0aGlzIGdyYXBoIChlZyBmYWxsb3csIGNoaWNrcGVhIGV0YykgXHBhcg0KICAtIHRoZSBlZGdlcyBvZiB0aGUgZ3JhcGggaGF2ZSAicnVsZXMiLCB3aGljaCBkZXRlcm1pbmUgaG93IHRoZSBwYWRkb2NrIG1vdmVzIGZyb20gc3RhdGUgdG8gc3RhdGUuXHBhcg0KXHBhcg0KRWFjaCBkYXksIHRoZSBtYW5hZ2VyIGV2YWx1YXRlcyBhbGwgcGF0aHMgdGhhdCBsZWFkIGF3YXkgZnJvbSB0aGUgY3VycmVudCBzdGF0ZS4gRWFjaCBwYXRoIGhhcyBhIHNldCBvZiBydWxlcyB3aGljaCBhcmUgZXZhbHVhdGVkOyB0aGUgInNjb3JlIiBmb3IgdGhhdCBwYXRocyB0YXJnZXQgbm9kZSBpcyB0aGUgcHJvZHVjdCBvZiBhbGwgYXNzb2NpYXRlZCBydWxlcy4gVGhlc2UgcnVsZXMgYXJlIHR5cGljYWxseSBiaW5hcnkgdmFsdWVzLCBidXQgY2FuIGJlIGFueSByZWFsIHZhbHVlLlxwYXINClxwYXINCkEgdGFibGUgb2YgZGVmYXVsdCBwYXJhbWV0ZXJzIChlZyBjdWx0aXZhciwgZmVydGlsaXNlciByYXRlcyBldGMpIGZvciBlYWNoIGNyb3AgaXMgdXNlZCB3aGVuIGNoYW5naW5nIHN0YXRlLlxwYXINClxwYXINCkEgc2ltcGxlIEdVSSBwb3BzIHVwIGF0IHRoZSBlbmQgb2YgdGhlIHNpbXVsYXRpb24gdGhhdCBzaG93cyB0aGUgY3JvcHBpbmcgaGlzdG9yeSBhbmQgdGhlIHZhbHVlIG9mIGV2YWx1YXRlZCBydWxlcyBvbiBhbnkgZGF5LiBDbGljayBvbiB0aGUgcnVnIHBsb3QgdG8gY2hhbmdlIHRoZSBkYXksIGFuZCB1c2UgdGhlIGFycm93IGtleXMgdG8gc3RlcCBiYWNrd2FyZC9mb3J3YXJkLlxwYXINClxwYXINCn0NCg==</memo>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date" lbound="1/01/1940" ubound="31/12/1989">1/01/1940</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date" lbound="1/01/1940" ubound="31/12/1989">31/12/1950</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Moonggoo.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">C:\Program Files\Apsim52\apsim\met\sample\goond.met</filename>
    </metfile>
    <area name="Paddock">
      <registrations name="global" />
      <tclmanager name="Manager">
        <tclui name="Rotation Rug Plot">
          <uiscript>
# Displays a rug plot of crop rotations

trace remove variable XMLDoc read setXML
package req tdom

# Get the value of one of our parameters
proc getValue {id thing} {
   foreach node [$id childNodes] {
      if {[string equal -nocase [$node nodeName] $thing]} {
         return [$node text]
      }
   }
   return ""
}

# Set the value of our 'thing'
proc setValue {w thing what} {
   upvar #0 $w data
   foreach node [$data(docroot) childNodes] {
      if {[string equal -nocase [$node nodeName] $thing]} {
         $data(docroot) removeChild $node
      }
   }
   set node [$data(doc) createElement $thing]
   $node appendChild [$data(doc) createTextNode $what]
   $data(docroot) appendChild $node
}

proc appletInit {w} {
   upvar #0 $w data
   global XMLDoc
   set data(doc) [dom parse $XMLDoc]
   set data(docroot) [$data(doc) documentElement]
   set data(filename) [getValue $data(docroot) filename]
}

# Read in the logfile
proc readIn {w} {
   upvar #0 $w data

   if {![file exists $data(filename)]} { set data(message) "$data(filename) does not exist."; return 0}

   set data(message) "Reading."; update

   set fp [open $data(filename) r]
   set data(finishedOK) 0
   set data(crops) {fallow}
   set date "X"
   while {[gets $fp line] &gt; 0} {
      if {[scan $line "%d,%d" day year]} {
         set date $line
         set data(latest) $date
      } elseif {[string match "Starting*" $line]} {
         set date [lindex $line 1]
         set data(earliest) $date; set data(latest) $date
      } elseif {[string match "paddocks*" $line]} {
         set data(paddocks) [join [lindex [split $line =] 1]]
         foreach paddock $data(paddocks) {
            set data($paddock,timeline) [list [list $data(earliest) fallow]]
         }
      } elseif {[string match "Finished*" $line]} {
         set data(finishedOK) 1
      } elseif {[string match colour* $line]} {
         set state [lindex $line 1]
         set data(colours,$state) [lindex $line 2]
      } elseif {[string match changeState* $line]} {
         set paddock [lindex $line 1]
         set state [lindex $line 2]
         lappend data($paddock,timeline) [list $date $state]
         if {[lsearch $data(crops) $state] &lt; 0} {lappend data(crops) $state}
         append data(text,$date) "$line\n"
      } else {
         append data(text,$date) "$line\n"
      }
   }
   close $fp
   if {![info exists data(earliest)]} {set data(message) "No 'Starting' tag found - is this really a logfile??"; return 0}
   if {$data(finishedOK) == 0} {set data(message) "No 'Finished' tag found - did the run crash??";return 0}

   foreach paddock $data(paddocks) {
      lappend data($paddock,timeline) [list $data(latest) end]
   }

   set message "Finished Reading."; update
   return 1
}

proc setupUI {w} {
   upvar #0 $w data

   panedwindow $w.p

   # Filename selector
   frame $w.f
   label $w.f.l -text "Filename"
   entry $w.f.e -textvariable $w\(filename\) -width 80
   button $w.f.b -text Browse -command "browseFilename $w"
   grid $w.f.l  -row 1 -column 1 -sticky w
   grid $w.f.e  -row 1 -column 2 -sticky ew
   grid $w.f.b  -row 1 -column 3 -sticky w
   grid columnconf $w.f 1 -weight 1

   # The rugplot canvas
   set data(canvas) [canvas $w.p.c]

   # Scrollable text window
   frame $w.p.t
   set data(text) [text $w.p.t.t -takefocus 0 -font "normal 14" -yscrollcommand "$w.p.t.sb set"]
   scrollbar $w.p.t.sb -orient v -command "$w.p.t.t yview"
   grid $w.p.t.t  -row 1 -column 1 -sticky nsew
   grid $w.p.t.sb -row 1 -column 2 -sticky nsw
   grid columnconf $w.p.t 1 -weight 1
   grid rowconf $w.p.t 1 -weight 1

   message $w.m  -textvariable $w\(message\) -aspect 1000 -anchor w

   $w.p add $w.p.c -sticky nsew
   $w.p add $w.p.t -sticky new

   grid $w.f  -row 1 -column 1 -sticky w
   grid $w.p  -row 2 -column 1 -sticky nsew
   grid $w.m  -row 3 -column 1  -sticky ew

   bind $w.p.c &lt;Motion&gt; "catch \"canvasMotion $w %x %y\""
   bind $w.p.c &lt;Button-1&gt;      "+focus %W; catch \"canvasButton $w %x %y\""
   bind $w.p.c &lt;Key-Up&gt;     "+catch \"canvasUp $w\""
   bind $w.p.c &lt;Key-Down&gt;   "+catch \"canvasDown $w\""
   bind $w.p.c &lt;Key-Left&gt;   "+catch \"canvasLeft $w\""
   bind $w.p.c &lt;Key-Right&gt;  "+catch \"canvasRight $w\""

   bind $w.p.c &lt;Configure&gt;  "+catch \"draw $w\""

   grid columnconf $w 1 -weight 1
   grid rowconf    $w 2 -weight 1
   focus $w.p.c
   return 1
}

proc browseFilename {w} {
   set types {
       {{Log Files}  .log }
       {{All Files} * }
   }
   set newFile [tk_getOpenFile -filetypes $types -multiple 0 -title "Choose log file"]
   if {$newFile != ""} {
      upvar #0 $w data
      set data(filename) $newFile
      setValue $w filename $newFile
      if {[readIn $w]} {draw $w}
   }
}

proc min {a b} { return [expr ($a &lt; $b) ? $a : $b] }
proc max {a b} { return [expr ($a &gt; $b) ? $a : $b] }

# Coordinate transforms
proc ctowx {w cx} {
   upvar #0 $w data
   set colwidth [expr ($data(width)-$data(xMargin))/[llength $data(paddocks)]]
   return [max [expr ($cx-$data(xMargin))/$colwidth] 0]
}
proc wtocx {w wx} {
   upvar #0 $w data
   set colwidth [expr ($data(width)-$data(xMargin))/[llength $data(paddocks)]]
   return [expr $data(xMargin) + $wx * $colwidth]
}
proc wtocy {w wy} {
   upvar #0 $w data
   return [expr 20 + ([date2num $wy]+$data(offsetY))*$data(scaleFactY) ]
}
proc ctowy {w cy} {
   upvar #0 $w data
   return [expr (($cy-20)/$data(scaleFactY))-$data(offsetY) ]
}
proc date2num {d} {
   set z [split $d ","]
   return [expr [lindex $z 1]+ [lindex $z 0]/365.0]
}
proc num2date {n} {
   set y [expr int($n)]
   set d [min 366 [max [expr int(($n-$y)*365.0)] 1]]
   return "$d,$y"
}

# Canvas bindings - mouse and keys
proc canvasMotion {w x y} {
   upvar #0 $w data
   set time [split [num2date [ctowy $w $y]] ","]
   set dstr ""
   catch {
     set dstr [clock format [clock scan "1/1/[lindex $time 1] + [expr [lindex $time 0]-1] days"] -format "%d-%b-%Y"]
   }
   set paddockName [lindex $data(paddocks) [ctowx $w $x]]
   set data(message) "$paddockName ; date=$dstr"
   update
}
proc canvasButton {w x y} {
   upvar #0 $w data
   set data(currTime) [num2date [ctowy $w $y]]
   set data(currPaddock) [lindex $data(paddocks) [ctowx $w $x]]
   showText $w
}
proc canvasUp {w} {
   upvar #0 $w data
   foreach {day year} [split $data(currTime) ","] {break}
   set day [expr $day-1]
   if {$day &lt;= 0} {set day 366; set year [expr $year-1]}
   set data(currTime) "$day,$year"
   showText $w
}
proc canvasDown {w} {
   upvar #0 $w data
   foreach {day year} [split $data(currTime) ","] {break}
   set day [expr $day+1]
   if {$day &gt; 366} {set day 1; set year [expr $year+1]}
   set data(currTime) "$day,$year"
   showText $w
}
proc canvasLeft {w} {
   upvar #0 $w data
   set paddock [lsearch $data(paddocks) $data(currPaddock)]
   set paddock [expr $paddock-1]
   if {$paddock &lt; 0} {set paddock [expr [llength $data(paddocks)]-1]}
   set data(currPaddock) [lindex $data(paddocks) $paddock]
   showText $w
}
proc canvasRight {w} {
   upvar #0 $w data
   set paddock [lsearch $data(paddocks) $data(currPaddock)]
   set paddock [expr $paddock+1]
   if {$paddock &gt; [expr [llength $data(paddocks)]-1]} {set paddock 0}
   set data(currPaddock) [lindex $data(paddocks) $paddock]
   showText $w
}

# Display the current ruleset in the text window
proc showText {w} {
   upvar #0 $w data
   set stime [split $data(currTime) ","]
   set year [lindex $stime 1]; set day [max [expr [lindex $stime 0]-1] 0]

   set dstr [clock format [clock scan "1/1/$year + $day days"] -format "%d-%b-%Y"]
   $data(text) delete 0.0 end
   $data(text) insert end "$dstr ($data(currTime))\n"
   if {[info exists data(text,$data(currTime))]} {
      $data(text) insert end $data(text,$data(currTime))
   }

   set paddock [lsearch $data(paddocks) $data(currPaddock)]
   $data(canvas) coords currPos [wtocx $w 0] [wtocy $w $data(currTime)] [wtocx $w [llength $data(paddocks)]] [wtocy $w $data(currTime)]
}

# Draw the paddock history
proc draw {w} {
   upvar #0 $w data

   $data(canvas) delete all

   set data(height) [winfo height $data(canvas)]
   set data(width)  [winfo width $data(canvas)]
   set data(xMargin) 60

   set t0 [date2num $data(earliest)]
   set t1 [date2num $data(latest)]
   set data(scaleFactY) [expr ($data(height)-20)/($t1 - $t0)]
   set data(offsetY) [expr - $t0]

   # boxes
   set column 0
   foreach paddock $data(paddocks) {
      for {set i 1} {$i &lt; [llength $data($paddock,timeline)]} {incr i} {
         set t0 [lindex [lindex $data($paddock,timeline) [expr $i-1]] 0]
         set t1 [lindex [lindex $data($paddock,timeline)       $i   ] 0]
         set what [lindex [lindex $data($paddock,timeline) [expr $i-1]] 1]
         if {[info exists data(colours,$what)]} {set colour $data(colours,$what)} else {set colour white}
         $data(canvas) create rect [wtocx $w $column] [wtocy $w $t0] [wtocx $w [expr $column+1]] [wtocy $w $t1] -fill $colour -outline {}
      }
      incr column
   }
   # text
   set column 0
   foreach paddock $data(paddocks) {
      for {set i 1} {$i &lt; [llength $data($paddock,timeline)]} {incr i} {
         set t0 [lindex [lindex $data($paddock,timeline) [expr $i-1]] 0]
         set t1 [lindex [lindex $data($paddock,timeline)       $i   ] 0]
         set what [lindex [lindex $data($paddock,timeline) [expr $i-1]] 1]
         $data(canvas) create text [expr 5 + [wtocx $w $column]] [wtocy $w $t0] -text $what -anchor nw
      }
      incr column
   }
   # column boundaries
   for {set col 0} {$col &lt; [llength $data(paddocks)]} {incr col} {
      $data(canvas) create line [wtocx $w $col] [wtocy $w $data(earliest)] [wtocx $w $col] [wtocy $w $data(latest)] -fill lightgray
   }
   # year boundaries
   for {set y [lindex [split $data(earliest) ","] 1]} {$y &lt;= [lindex [split $data(latest) ","] 1]} {incr y} {
      $data(canvas) create line [wtocx $w 0] [wtocy $w "1,$y"] [wtocx $w [llength $data(paddocks)]] [wtocy $w "1,$y"] -fill lightgray
      $data(canvas) create text 5 [wtocy $w "1,$y"] -text "1/1/$y" -anchor w
   }
   # top margin text
   set y [wtocy $w $data(earliest)]
   for {set x 0} {$x &lt; [llength $data(paddocks)]} {incr x} {
      $data(canvas) create text [expr 20 + [wtocx $w $x]] $y -text "[lindex $data(paddocks) $x]" -anchor sw
   }
   #Current position
   $data(canvas) create line [wtocx $w 0] [wtocy $w $data(earliest)] [wtocx $w 1] [wtocy $w $data(earliest)] -fill white -tag currPos
   set data(message) "Finished Drawing. ($data(width)x$data(height))"
}

##############################
########Main program starts here
##############################
catch {unset .w}
catch {destroy .w}

frame .w
grid forget .
grid .w -row 1 -column 1 -sticky nsew
grid columnconf . 1 -weight 1
grid rowconf    . 1 -weight 1

appletInit .w
setupUI .w
if {[readIn .w]} {draw .w}

proc setXML {name1 name2 op} {
   upvar #0 .w data
   if {[catch {set newXML [$data(doc) asXML]}]} {
      global errorInfo; tk_messageBox -title "Error - not updating" -message "$errorInfo" -type ok
   } else {
      global XMLDoc
      set XMLDoc $newXML
   }
}
trace add variable XMLDoc read setXML
</uiscript>
          <filename>Rotation Sample 2.log</filename>
        </tclui>
        <tclui name="Rotation Management">
          <uiscript><![CDATA[
package req Tk
package req struct
package req tdom
trace remove variable XMLDoc read setXML

# Get the value of one of our parameters
proc getValue {id thing} {
   foreach node [$id childNodes] {
      if {[string equal -nocase [$node nodeName] $thing]} {
         return [$node text]
      }
   }
   return ""
}

# Get the values of one of our parameters
proc getValues {id thing} {
   set result {}
   foreach node [$id childNodes] {
      if {[string equal -nocase [$node nodeName] $thing]} {
         lappend result [$node text]
      }
   }
   return $result
}

# return the tag of an item near (x,y)
proc getTag {c x y} {
   set tag [lindex [$c find overlapping [expr $x-5] [expr $y-5] [expr $x+5] [expr $y+5]] end]
   if {[llength $tag] > 0} {
      foreach tag [$c gettags $tag] {
         if {$tag != "current"} {
             return $tag
         }
      }
   }
   return {}
}

# Select an object near (x,y)
proc select {w x y} {
   upvar #0 $w cfg
   if {$cfg(selected) != {}} {
      foreach {type name} [split $cfg(selected) :] {break}
      if {$type == "node"} {
          catch {$cfg(c) itemconf $cfg(selected) -outline black -width 1}
      } elseif {$type == "arc"} {
          catch {$cfg(c) itemconf $cfg(selected) -fill black -width 1}
      }
   }
   set tag [getTag $cfg(c) $x $y]
   if {$tag != {}} {
      set cfg(selected) $tag
      set cfg(selectedX) $x
      set cfg(selectedY) $y
      foreach {type name} [split $tag :] {break}
      if {$type == "node"} {
        catch {$cfg(c) itemconf $tag -outline blue -width 3}
      } elseif {$type == "arc"} {
        catch {$cfg(c) itemconf $tag -fill blue -width 3}
      }
      showSelection $w $type $name
   } else {
      set cfg(selected) {}
      set cfg(selectedX) {}
      set cfg(selectedY) {}
      set cfg(message) "No items selected."
      showSelection $w help dummy
   }
}

# Move an already selected object
proc move {w x y} {
   upvar #0 $w cfg
   if {$cfg(selected) != {}} {
      set dx [expr {$x - $cfg(selectedX)}]
      set dy [expr {$y - $cfg(selectedY)}]
      set cfg(selectedX) $x
      set cfg(selectedY) $y
      foreach {type name} [split $cfg(selected) :] {break}
      if {$type == "node"} {
         $cfg(c) move $cfg(selected) $dx $dy
         foreach {x1 y1 x2 y2} [$cfg(c) coords $cfg(selected)] {}
         foreach what {x1 y1 x2 y2} {$cfg(g) node set $name $what [set $what]}
         foreach arc [$cfg(g) arcs -adj $name] {
            fixupArrow $w arc:$arc "node:[$cfg(g) arc source $arc]" "node:[$cfg(g) arc target $arc]"
         }
      } elseif {$type == "arc"} {
         set coords [$cfg(c) coords $cfg(selected)]
         set newx [expr $dx + [lindex $coords 2]]
         set newy [expr $dy + [lindex $coords 3]]
         $cfg(g) arc set $name x $newx
         $cfg(g) arc set $name y $newy
         fixupArrow $w $cfg(selected) "node:[$cfg(g) arc source $name]" "node:[$cfg(g) arc target $name]"
      }
   }
   $cfg(c) configure -scrollregion [$cfg(c) bbox all]
}


#Return a point on the edge of the node on a line to (x,y)
# NB. canvas origin at upper left corner
# Used to find arrow positions between nodes
proc findEdge {w x y node} {
   upvar #0 $w cfg
   set maxy [$w cget -height]

   # center of node
   set nc [$cfg(c) coords $node]
   set xn [expr ([lindex $nc 2] + [lindex $nc 0])/2.0]
   set yn [expr $maxy - ([lindex $nc 3] + [lindex $nc 1])/2.0]

   # angle of midline
   set a 0.0
   catch {set a [expr atan((($maxy-$y)-$yn)/($x-$xn))]}

   # Cheat - assume its always a circle and just take mid point of box
   set r [expr abs(([lindex $nc 2] - [lindex $nc 0])/2.0)]
   set dx [expr $x-$xn]
   set dy [expr ($maxy-$y)-$yn]
   if {$dx < 0} {
     set xe [expr $xn - $r * cos($a)]
     set ye [expr $yn - $r * sin($a)]
   } else {
     set xe [expr $xn + $r * cos($a)]
     set ye [expr $yn + $r * sin($a)]
   }
   return [list $xe [expr $maxy - $ye]]
}

# Set the arc coordinates between 2 nodes.
proc fixupArrow {w arc srcNode destNode} {
   upvar #0 $w cfg
   set arc [lindex [split $arc ":"] 1]
   set xm [$cfg(g) arc get $arc x]
   set ym [$cfg(g) arc get $arc y]

   set p0 [findEdge $w $xm $ym $srcNode]
   set p1 [findEdge $w $xm $ym $destNode]

   $cfg(c) coords arc:$arc [concat $p0 $xm $ym $p1]
}

# Right button click - post a context sensitive menu
proc action {w x y cx cy} {
   upvar #0 $w cfg
   set tag [getTag $cfg(c) $cx $cy]
   if {$cfg(selected) == {}} {
      postNewNodeMenu $w $x $y $cx $cy
   } elseif {$cfg(selected) != {} && "$tag" == $cfg(selected)} {
      postChangeMenu $w $tag $x $y $cx $cy
   } elseif {$cfg(selected) != {} && "$tag" != {} && "$tag" != $cfg(selected)} {
      postAddArcMenu $w $cfg(selected) $tag $x $y $cx $cy
   }
}

proc postNewNodeMenu {w x y cx cy} {
   upvar #0 $w cfg
   if {[winfo exists $cfg(c).newNodeMenu]} {destroy $cfg(c).newNodeMenu}
   menu $cfg(c).newNodeMenu -tearoff 0
   $cfg(c).newNodeMenu add command -label "Add New State" -command "addNewNode $w $cx $cy"
   tk_popup $cfg(c).newNodeMenu $x $y
}

proc addNewNode {w x y} {
   upvar #0 $w cfg
   set n 0; while {[$cfg(g) node exists n$n]} {incr n}; set n "n$n"
   $cfg(g) node insert $n
   $cfg(g) node set $n x1 [set x1 [expr $x-50]]
   $cfg(g) node set $n y1 [set y1 [expr $y-50]]
   $cfg(g) node set $n x2 [set x2 [expr $x+50]]
   $cfg(g) node set $n y2 [set y2 [expr $y+50]]
   $cfg(g) node set $n fill brown
   $cfg(g) node set $n name $n
   $cfg(g) node set $n desc  "New state"
   $cfg(g) node set $n alias "newnode"

   $cfg(c) create oval $x1 $y1 $x2 $y2 -fill brown -tags node:$n
   set mx($n) [expr ($x1 + $x2) / 2.0]; set my($n) [expr ($y1 + $y2) / 2.0]
   $cfg(c) create text $mx($n) $my($n) -text "$n" -anchor center -tags node:$n

   select $w [$cfg(c) canvasx $x] [$cfg(c) canvasy $y]
   $cfg(c) configure -scrollregion [$cfg(c) bbox all]
}

proc dupNode {w tag} {
   upvar #0 $w cfg
   set srcNode [lindex [split $tag :] 1]

   set n 0; while {[$cfg(g) node exists n$n]} {incr n}; set n "n$n"
   $cfg(g) node insert $n
   $cfg(g) node set $n x1 [set x1 [expr [$cfg(g) node get $srcNode x1]+50]]
   $cfg(g) node set $n y1 [set y1 [expr [$cfg(g) node get $srcNode y1]+50]]
   $cfg(g) node set $n x2 [set x2 [expr [$cfg(g) node get $srcNode x2]+50]]
   $cfg(g) node set $n y2 [set y2 [expr [$cfg(g) node get $srcNode y2]+50]]
   $cfg(g) node set $n fill [$cfg(g) node get $srcNode fill]
   $cfg(g) node set $n name [$cfg(g) node get $srcNode name]
   $cfg(g) node set $n desc [$cfg(g) node get $srcNode desc]
   $cfg(g) node set $n alias [$cfg(g) node get $srcNode alias]

   $cfg(c) create oval $x1 $y1 $x2 $y2 -fill [$cfg(g) node get $srcNode fill] -tags node:$n
   set mx($n) [expr ($x1 + $x2) / 2.0]; set my($n) [expr ($y1 + $y2) / 2.0]
   $cfg(c) create text $mx($n) $my($n) -text [$cfg(g) node get $srcNode name] -anchor center -tags node:$n

   foreach arc [$cfg(g) arcs -in $srcNode] {
      set src  "node:[$cfg(g) arc source $arc]"
      set dest "node:$n"
      set newArc [addNewArc $w $src $dest]
      foreach what {rules actions} {
        foreach thing [$cfg(g) arc get $arc $what] {
           $cfg(g) arc lappend $newArc $what $thing
        }
      }
   }

   foreach arc [$cfg(g) arcs -out $srcNode] {
      set src  "node:$n"
      set dest "node:[$cfg(g) arc target $arc]"
      set newArc [addNewArc $w $src $dest]
      foreach what {rules actions} {
        foreach thing [$cfg(g) arc get $arc $what] {
           $cfg(g) arc lappend $newArc $what $thing
        }
      }
   }
}

proc deleteNode {w tag} {
   upvar #0 $w cfg
   set node [lindex [split $tag :] 1]
   foreach arcTag [$cfg(g) arcs -adj $node] {
      $cfg(c) delete arc:$arcTag
   }
   $cfg(c) delete $tag
   $cfg(g) node delete $node
   set cfg(selected) {}
   select $w 0 0
}

proc postAddArcMenu {w srcTag destTag x y cx cy} {
   upvar #0 $w cfg
   catch {destroy $cfg(c).addArcMenu}
   menu $cfg(c).addArcMenu -tearoff 0
   set srcName [lindex [split $srcTag :] 1]; set destName [lindex [split $destTag :] 1]

   if {![catch {set src [$cfg(g) node get $srcName name];
                set dest [$cfg(g) node get $destName name]}]} {
      $cfg(c).addArcMenu add command \
          -label "Add arc from $src to $dest" \
          -command "addNewArc $w $srcTag $destTag"
      tk_popup $cfg(c).addArcMenu $x $y
   }
}

proc addNewArc {w srcTag destTag} {
   upvar #0 $w cfg
   set n 0; while {[$cfg(g) arc exists arc$n]} {incr n}
   set arc "arc$n"
   set c1 [$cfg(c) coords $srcTag]
   set x1 [expr ([lindex $c1 0] + [lindex $c1 2])/2]
   set y1 [expr ([lindex $c1 1] + [lindex $c1 3])/2]
   set c2 [$cfg(c) coords $destTag]
   set x2 [expr ([lindex $c2 0] + [lindex $c2 2])/2]
   set y2 [expr ([lindex $c2 1] + [lindex $c2 3])/2]
   set mx [expr ($x1 + $x2) / 2.0]; set my [expr ($y1 + $y2) / 2.0]
   $cfg(c) create line $x1 $y1 $mx $my $x2 $y2 -smooth bezier -tags arc:$arc -arrow last -arrowshape {15 25 10}

   $cfg(g) arc insert [lindex [split $srcTag :] 1] [lindex [split $destTag :] 1] $arc
   $cfg(g) arc lappend $arc rules   {}
   $cfg(g) arc lappend $arc actions {}
   $cfg(g) arc set $arc x $mx
   $cfg(g) arc set $arc y $my
   $cfg(c) configure -scrollregion [$cfg(c) bbox all]

   return $arc
}

proc deleteArc {w tag} {
   upvar #0 $w cfg
   $cfg(c) delete $tag
   $cfg(g) arc delete [lindex [split $tag :] 1]
}

proc dupArc {w tag} {
   upvar #0 $w cfg
   set arc [lindex [split $tag :] 1]
   set src  "node:[$cfg(g) arc source $arc]"
   set dest "node:[$cfg(g) arc target $arc]"
   set newArc [addNewArc $w $src $dest]

   foreach rule [$cfg(g) arc get $arc rules] {
     $cfg(g) arc lappend $newArc rules  $rule
   }
   foreach action [$cfg(g) arc get $arc actions] {
     $cfg(g) arc lappend $newArc actions $action
   }
}

proc postChangeMenu {w tag x y cx cy} {
   upvar #0 $w cfg
   set isNode [string match "node*" $tag]
   catch {destroy $cfg(c).postChangeMenu}
   menu $cfg(c).postChangeMenu -tearoff 0
   if {$isNode} {
      $cfg(c).postChangeMenu add command -label "Delete" -command "deleteNode $w $tag"
      $cfg(c).postChangeMenu add command -label "Duplicate" -command "dupNode $w $tag"
   } else {
      $cfg(c).postChangeMenu add command -label "Delete" -command "deleteArc $w $tag"
      $cfg(c).postChangeMenu add command -label "Duplicate" -command "dupArc $w $tag"
   }
   tk_popup $cfg(c).postChangeMenu  $x $y
}

# Create the UI for the current object and fill it out
proc showSelection {w type name} {
   upvar #0 $w cfg

   # Save old edits
   if {$cfg(edit) != {}} {
      catch {set_$cfg(editType) $w}
   }
   if {"$cfg(s)" != "$w.$type"} {
      catch {$w forget $cfg(s)}
      $w add $w.$type
      set cfg(s) "$w.$type"
   }
   show_$type $w
}

proc setup_help {w junk} {
   upvar #0 $w cfg
   set f [text $w.help -width 70 -height 10]
   $f insert end {<left-click>: select a node or arc.
<right-click>:  shows a context-sensitive  menu.

Once a node/arc is selected, it can be dragged to a new position.

Nodes are created by right-clicking on a blank area.

Arcs are created by firstly selecting a source node, then right-
clicking over a target node.
}
   return $f
}
proc show_help {w} {}

# UI for node editing
proc setup_node {w name} {
   upvar #0 $w cfg
   set f [frame $w.node]
   label $f.l1 -text "Name"
   entry $f.e1 -textvariable $w\(name\) -width 12 -validate key -vcmd {string is wordchar %P}
   label $f.l2 -text "Alias"
   entry $f.e2 -textvariable $w\(alias\) -width 12 -validate key -vcmd {string is wordchar %P}
   label $f.l3 -text "Description"
   entry $f.e3 -textvariable $w\(desc\) -width 40
   label $f.l4 -text "Colour"
   entry $f.e4 -textvariable $w\(fill\) -width 12

   grid $f.l1 -row 1 -column 1 -sticky w
   grid $f.e1 -row 1 -column 2 -sticky w
   grid $f.l2 -row 2 -column 1 -sticky w
   grid $f.e2 -row 2 -column 2 -sticky w
   grid $f.l3 -row 3 -column 1 -sticky w
   grid $f.e3 -row 3 -column 2 -sticky ew
   grid $f.l4 -row 4 -column 1 -sticky w
   grid $f.e4 -row 4 -column 2 -sticky w
   grid columnconf $f 3 -weight 1
   grid rowconf    $f 6 -weight 1

   return $f
}

proc show_node {w} {
   upvar #0 $w cfg
   set node [lindex [split $cfg(selected) :] 1]
   set cfg(name) [$cfg(g) node get $node name]
   set cfg(alias) [$cfg(g) node get $node alias]
   set cfg(desc) [$cfg(g) node get $node desc]
   set cfg(fill) [$cfg(g) node get $node fill]

   set cfg(message) "State $cfg(name)"
   set cfg(edit) $node; set cfg(editType) "node"
}

proc set_node {w} {
   upvar #0 $w cfg
   set node $cfg(edit)
   if {$node == {}} {return}

   # Make the node name unique: append a "_1", "_2" etc.. if needed.
   set candidate $cfg(name); set found 1
   while {$found} {
      set found 0
      foreach otherNode [$cfg(g) nodes] {
         if {"$node" != "$otherNode" &&
             [string equal [$cfg(g) node get $otherNode name] $candidate]} {
            set found 1
         }
      }
      if {$found} {
         set num [lindex [split $candidate "_"] end]
         if {! [string is integer -strict $num]} {
           set candidate "${candidate}_1"
         } else {
           set root [join [lrange [split $candidate "_"] 0 end-1] "_"]
           set candidate "${root}_[expr 1+$num]"
         }
      }
   }

   $cfg(g) node set $node name [set cfg(name) $candidate]
   $cfg(g) node set $node alias $cfg(alias)
   $cfg(g) node set $node desc $cfg(desc)
   $cfg(g) node set $node fill $cfg(fill)
   foreach id [$cfg(c) find withtag node:$node] {
     if {[$cfg(c) type $id] == "text"}  {$cfg(c) itemconf $id -text $cfg(name)}
     if {[$cfg(c) type $id] == "oval"}  {$cfg(c) itemconf $id -fill $cfg(fill)}
   }
   set cfg(edit) {}
}

proc setup_arc {w name} {
   upvar #0 $w cfg
   set f [frame $w.arc]
   set p [panedwindow $f.p -orient vertical]

   frame $p.r
   label $p.r.l1 -text "Rules"
   set cfg(rulesW) [text $p.r.rules -height 4 -wrap none  -yscrollcommand "$p.r.rsbar set"]
   scrollbar $p.r.rsbar -orient vertical -command "$p.r.rules yview"
   grid $p.r.l1 -row 1 -column 1 -sticky w
   grid $p.r.rules -row 2 -column 1 -sticky nsew
   grid $p.r.rsbar -row 2 -column 2 -sticky w
   grid rowconfig $p.r 2 -weight 1
   grid columnconfig $p.r 1 -weight 1

   frame $p.a
   label $p.a.l2 -text "Actions"
   set cfg(actionsW) [text $p.a.actions -height 3 -wrap none  -yscrollcommand "$p.a.asbar set"]
   scrollbar $p.a.asbar -orient vertical -command "$p.a.actions yview"
   grid $p.a.l2 -row 1 -column 1 -sticky w
   grid $p.a.actions -row 2 -column 1 -sticky nsew
   grid $p.a.asbar   -row 2 -column 2 -sticky w
   grid rowconfig $p.a 2 -weight 1
   grid columnconfig $p.a 1 -weight 1

   $p add $p.r $p.a

   grid $f.p -row 1 -column 1 -sticky nsew
   grid rowconfig $f 1 -weight 1
   grid columnconfig $f 1 -weight 1

   #if {[info exists cfg(rules_height)]} {$p sash place 0 2 $cfg(rules_height)}
   #bind $p <ButtonRelease-1> "+ set $w\(rules_height\) \[lindex \[$p sash coord 0\] 1\]; set $w\(message\) \[lindex \[$p sash coord 0\] 1\]"
   return $f
}
proc show_arc {w} {
   upvar #0 $w cfg
   set arc [lindex [split $cfg(selected) :] 1]

   $cfg(rulesW) delete 0.0 end
   foreach rule [$cfg(g) arc get $arc rules] {
      $cfg(rulesW) insert end "$rule\n"
   }
   $cfg(actionsW) delete 0.0 end
   foreach action [$cfg(g) arc get $arc actions] {
      $cfg(actionsW) insert end "$action\n"
   }
   set src [$cfg(g) node get [$cfg(g) arc source $arc] name]
   set dest [$cfg(g) node get [$cfg(g) arc target $arc] name]
   set cfg(message) "Transition from $src to $dest"

   set cfg(edit) $arc; set cfg(editType) "arc"
}

proc set_arc {w} {
   upvar #0 $w cfg
   set arc $cfg(edit)
   if {$arc != {}} {
      $cfg(g) arc set $arc rules {}
      foreach rule [split [$cfg(rulesW) get 0.0 end] "\n"] {
         if {$rule != {}} {$cfg(g) arc lappend $arc rules $rule}
      }
      $cfg(g) arc set $arc actions {}
      foreach action [split [$cfg(actionsW) get 0.0 end] "\n"] {
         if {$action != {}} {$cfg(g) arc lappend $arc actions $action}
      }
   }
   set cfg(edit) {}
}

# Save the graph to an XML tree. Makes both our node/ arc  objects, and an invisible rule
# for the manager.
proc saveGraph {w} {
   upvar #0 $w cfg

   if {!$cfg(setupOk)} {error "Initialisation failed - Not saving"}

   # Clean up any edits in progress
   if {$cfg(edit) != {}} {
      catch {set_$cfg(editType) $w}
   }

   set x "<tclui name=\"[$cfg(docroot) getAttribute name]\">\n"
   append x "<uiscript><!\[CDATA\[[getValue $cfg(docroot) uiscript]\]\]></uiscript>\n"
   foreach what {canvas_height rules_height} {
      append x "<$what>$cfg($what)</$what>\n"
   }

   set rule "<rule name=\"Init rule\" invisible=\"yes\" condition=\"init\">\n"
   append rule "<!\[CDATA\[package require struct\n"
   append rule "::struct::graph stateGraph\n"

   foreach node [$cfg(g) nodes] {
      append x "<node>\n"
      foreach key [$cfg(g) node keys $node] {
         set value [$cfg(g) node get $node $key]
         append x " <$key>$value</$key>\n"
      }
      append x "</node>\n"
      append rule "stateGraph node insert \"[$cfg(g) node get $node name]\"\n"
      append rule "set alias([$cfg(g) node get $node name]) \"[$cfg(g) node get $node alias]\"\n"
      append rule "set colour([$cfg(g) node get $node name]) \"[$cfg(g) node get $node fill]\"\n"
   }
   foreach arc [$cfg(g) arcs] {
      append x "<arc><name>$arc</name>\n"
      set sourceNodeName [$cfg(g) node get [$cfg(g) arc source $arc] name]
      append x " <source>$sourceNodeName</source>\n"
      set targetNodeName [$cfg(g) node get [$cfg(g) arc target $arc] name]
      append x " <target>$targetNodeName</target>\n"
      append rule "stateGraph arc insert \"$sourceNodeName\" \"$targetNodeName\" \"$arc\"\n"

      foreach {key value} [$cfg(g) arc getall $arc] {
         if {$key != "rules" && $key != "actions"} {
            append x " <$key>$value</$key>\n"
         } else {
            foreach thing [$cfg(g) arc get $arc $key] {
               if {$thing != {}} {
                  append rule "stateGraph arc lappend \"$arc\" $key \{$thing\}\n"
                  set thing [string map {\< "&lt;"  \> "&gt;"
                                         \& "&amp;" \" "&quot;"
                                         \[ "&#91;" \] "&#93;"} $thing]
                  append x " <$key>$thing</$key>\n"
               }
            }
         }
      }
      append x " <rules/><actions/>\n"
      append x "</arc>\n"
      append rule "stateGraph arc lappend \"$arc\" actions \{\}\n"
   }

   append x "$rule\]\]></rule>\n"
   append x "</tclui>\n"

   return $x
}

# Read the graph from an XML tree
proc openGraph {w} {
   upvar #0 $w cfg
   catch {$cfg(g) destroy}
   catch {g destroy}

   set errorsFound 0

   set cfg(g) [::struct::graph g]

   global XMLDoc
   set cfg(doc) [dom parse $XMLDoc]
   set cfg(docroot) [$cfg(doc) documentElement]

   set cfg(canvas_height) [getValue $cfg(docroot) canvas_height]; if {$cfg(canvas_height) == {}} {set cfg(canvas_height) 400}
   set cfg(rules_height) [getValue $cfg(docroot) rules_height]; if {$cfg(rules_height) == {}} {set cfg(rules_height) 40}

   foreach node [$cfg(docroot) selectNodes //node] {
      $cfg(g) node insert [set nodeName [getValue $node name]]
      $cfg(g) node set $nodeName name $nodeName
      foreach {what default} {x1 100 x2 200 y1 100 y2 200 fill purple desc "No description" alias zzz} {
         if {[set value [getValue $node $what]] == ""} {
            $cfg(g) node set $nodeName $what $default
         } else {
            $cfg(g) node set $nodeName $what $value
         }
      }
   }

   foreach arc [$cfg(docroot) selectNodes //arc] {
      set arcName [getValue $arc name]
      set sourceNode [getValue $arc source]
      set targetNode [getValue $arc target]
      if {[$cfg(g) node exists $sourceNode] && [$cfg(g) node exists $targetNode]} {
         $cfg(g) arc insert $sourceNode $targetNode $arcName
         foreach {what default} {x 300 y 300} {
            if {[set value [getValue $arc $what]] == ""} {
                $cfg(g) arc set $arcName $what $default
            } elseif {$what != "name"} {
                $cfg(g) arc set $arcName $what $value
            }
         }
         foreach {what} {rules actions} {
            foreach value [getValues $arc $what] {
               set value [string map {"&lt;"  \<  "&gt;" \>
                                      "&amp;" \&  "&quot;"  \"
                                      "&#91;" \[  "&#93;" \] } $value]

               $cfg(g) arc lappend $arcName $what $value
            }
         }
      } else {
         tk_messageBox -title "Whoops!!" -message "source ($sourceNode) and/or target ($targetNode) is missing??" -type ok
         set errorsFound 1
      }
   }
   set cfg(setupOk) [expr ! $errorsFound]
}

# Create a graph on a canvas
proc createGraph {w} {
   upvar #0 $w cfg
   foreach id [$cfg(c) find all] {$cfg(c) delete $id}
   foreach n [$cfg(g) nodes] {
      foreach what {x1 y1 x2 y2 name fill} {set $what [$cfg(g) node get $n $what]}
      $cfg(c) create oval $x1 $y1 $x2 $y2 -fill $fill -tags node:$n
      set mx($n) [expr ($x1 + $x2) / 2.0]; set my($n) [expr ($y1 + $y2) / 2.0]
      $cfg(c) create text $mx($n) $my($n) -text $name -anchor center -tags node:$n
   }

   foreach a [$cfg(g) arcs] {
      set n1 [$cfg(g) arc source $a]
      set n2 [$cfg(g) arc target $a]
      $cfg(c) create line 0 0 0 0 -smooth bezier -tags arc:$a -arrow last -arrowshape {15 25 10}
      fixupArrow $w arc:$a "node:$n1" "node:$n2"
   }
   $cfg(c) configure -scrollregion [$cfg(c) bbox all]

   bind $cfg(c) <Button-1>  "+select $w \[$cfg(c) canvasx %x\] \[$cfg(c) canvasy %y\]"
   bind $cfg(c) <B1-Motion> "+move $w   \[$cfg(c) canvasx %x\] \[$cfg(c) canvasy %y\]"
   bind $cfg(c) <Button-3>  "+action $w %X %Y \[$cfg(c) canvasx %x\] \[$cfg(c) canvasy %y\]"
   set cfg(selected) {}

   setup_node $w dummy
   setup_arc  $w dummy
   setup_help $w dummy
   showSelection $w help dummy
}

##############################
catch {unset .w}
catch {destroy .w}

set .w(g) {}
set .w(s) {}
set .w(edit) {}
set .w(setupOk) 0

if {[catch {openGraph .w}]} {tk_messageBox -title "openGraph" -message "$errorInfo" -type ok}

panedwindow .w -orient vertical

frame .w.t
scrollbar .w.t.hs -orient horiz -command ".w.t.c xview"
scrollbar .w.t.vs -orient vert  -command ".w.t.c yview"
set .w(c) [canvas .w.t.c -xscrollcommand ".w.t.hs set" -yscrollcommand ".w.t.vs set"]
label .w.t.m -width 40 -textvariable .w(message) -anchor w

grid .w.t.c -row 1 -column 1 -sticky nsew
grid .w.t.hs -row 2 -column 1 -sticky ew
grid .w.t.vs -row 1 -column 2 -sticky ns
grid .w.t.m -row 3 -column 1 -sticky ew
grid columnconf .w.t 1 -weight 1
grid rowconf    .w.t 1 -weight 1
.w add .w.t                 -sticky nswe

if {[catch {createGraph .w}]} {tk_messageBox -title "createGraph" -message "$errorInfo" -type ok}

grid forget .
grid .w -row 1 -column 1   -sticky nsew
grid columnconf . 1 -weight 1
grid rowconf    . 1 -weight 1
update

if {[info exists .w(canvas_height)]} {.w sash place 0 2 [set .w(canvas_height)]}
bind .w <Leave> "+ set .w\(canvas_height\) \[lindex \[.w sash coord 0\] 1\]"

trace add variable XMLDoc read setXML
proc setXML {name1 name2 op} {
   if {[catch {set newXML [saveGraph .w]}]} {
      global errorInfo
      tk_messageBox -title "Error - not saved" -message $errorInfo -type ok
   }  else {
      global XMLDoc
      set XMLDoc $newXML
   }
}

##bind . <Escape> {+console show}         ;# quick restart
]]></uiscript>
          <node>
            <x1>568.0</x1>
            <name>Chickpea</name>
            <alias>chickpea</alias>
            <y1>44.0</y1>
            <x2>668.0</x2>
            <desc>Chickpea</desc>
            <fill>lightgreen</fill>
            <y2>144.0</y2>
          </node>
          <node>
            <x1>194.0</x1>
            <name>SummerFallow2</name>
            <alias>fallow</alias>
            <y1>406.0</y1>
            <x2>294.0</x2>
            <desc>New state</desc>
            <fill>gray</fill>
            <y2>506.0</y2>
          </node>
          <node>
            <x1>427.0</x1>
            <name>Wheat</name>
            <alias>wheat</alias>
            <y1>437.0</y1>
            <x2>527.0</x2>
            <desc>Wheat Crop</desc>
            <fill>darkgreen</fill>
            <y2>537.0</y2>
          </node>
          <node>
            <x1>121.0</x1>
            <name>WinterFallow</name>
            <alias>fallow</alias>
            <y1>228.0</y1>
            <x2>221.0</x2>
            <desc>New state</desc>
            <fill>gray</fill>
            <y2>328.0</y2>
          </node>
          <node>
            <x1>173.0</x1>
            <name>Cotton</name>
            <alias>cotton</alias>
            <y1>53.0</y1>
            <x2>273.0</x2>
            <desc>A Cotton Crop</desc>
            <fill>purple</fill>
            <y2>153.0</y2>
          </node>
          <node>
            <x1>368.0</x1>
            <name>F1</name>
            <alias>fallow</alias>
            <y1>4.0</y1>
            <x2>468.0</x2>
            <desc>New state</desc>
            <fill>gray</fill>
            <y2>104.0</y2>
          </node>
          <node>
            <x1>563.0</x1>
            <name>SummerFallow1</name>
            <alias>fallow</alias>
            <y1>277.0</y1>
            <x2>663.0</x2>
            <desc>New state</desc>
            <fill>maroon</fill>
            <y2>377.0</y2>
          </node>
          <arc>
            <name>arc6</name>
            <source>WinterFallow</source>
            <target>Cotton</target>
            <x>138.5</x>
            <actions>apsimSendMessage cotton sow {plants_pm 10} {sowing_depth  30} {cultivar  siok} {row_spacing 1000}</actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>174.5</y>
            <rules>[dateWithin 288 349]</rules>
            <rules>[sumLastRain 4] &gt; 10</rules>
            <rules>[apsimGet esw] &gt; 100</rules>
          </arc>
          <arc>
            <name>arc2</name>
            <source>SummerFallow1</source>
            <target>WinterFallow</target>
            <x>353.5</x>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>499.0</y>
            <rules>[apsimGet day]  == 192</rules>
          </arc>
          <arc>
            <name>arc7</name>
            <source>F1</source>
            <target>SummerFallow1</target>
            <x>591.5</x>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>123.0</y>
            <rules>[apsimGet day]  == 192</rules>
          </arc>
          <arc>
            <name>arc3</name>
            <source>Wheat</source>
            <target>SummerFallow2</target>
            <x>363.0</x>
            <actions>apsimSendMessage wheat harvest</actions>
            <actions>apsimSendMessage wheat end_crop</actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>522.5</y>
            <rules>{[apsimGet wheat.stage_name] == "harvest_ripe" || [apsimGet wheat.plant_status] == "dead"}</rules>
          </arc>
          <arc>
            <name>arc8</name>
            <source>Chickpea</source>
            <target>SummerFallow1</target>
            <x>647.0</x>
            <actions>apsimSendMessage chickpea harvest</actions>
            <actions>apsimSendMessage chickpea end_crop</actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>210.5</y>
            <rules>{[apsimGet chickpea.stage_name] == "harvest_ripe" || [apsimGet chickpea.plant_status] == "dead"}</rules>
          </arc>
          <arc>
            <name>arc0</name>
            <source>F1</source>
            <target>Chickpea</target>
            <x>521.0</x>
            <actions>apsimSendMessage chickpea sow {plants 25} {sowing_depth 30} {cultivar amethyst} {row_spacing 500} </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>39.0</y>
            <rules>[dateWithin 135 191]</rules>
            <rules>[sumLastRain 3] &gt; 25</rules>
            <rules>[apsimGet esw] &gt; 50</rules>
          </arc>
          <arc>
            <name>arc9</name>
            <source>SummerFallow2</source>
            <target>WinterFallow</target>
            <x>164.0</x>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>385.5</y>
            <rules>[apsimGet day]  == 74</rules>
          </arc>
          <arc>
            <name>arc10</name>
            <source>WinterFallow</source>
            <target>Cotton</target>
            <x>235.5</x>
            <actions>apsimSendMessage cotton sow {plants_pm 10} {sowing_depth  30} {cultivar  siok} {row_spacing 1000}</actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>210.5</y>
            <rules>[apsimGet day] == 350</rules>
          </arc>
          <arc>
            <name>arc5</name>
            <source>Cotton</source>
            <target>F1</target>
            <x>288.5</x>
            <actions>apsimSendMessage cotton harvest</actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>34.5</y>
            <rules>[apsimGet ozcot_status] &gt; 0</rules>
          </arc>
          <arc>
            <name>arc1</name>
            <source>SummerFallow1</source>
            <target>Wheat</target>
            <x>576.5</x>
            <actions>apsimSendMessage wheat sow {plants 100} {sowing_depth 30} {cultivar hartog} {row_spacing 250} </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <actions>
            </actions>
            <y>410.5</y>
            <rules>[dateWithin 135 191]</rules>
            <rules>[sumLastRain 3] &gt; 25</rules>
            <rules>[apsimGet esw] &gt; 50</rules>
          </arc>
          <rule name="Init rule" invisible="yes" condition="init"><![CDATA[package require struct
::struct::graph stateGraph
stateGraph node insert "Chickpea"
set alias(Chickpea) "chickpea"
set colour(Chickpea) "lightgreen"
stateGraph node insert "SummerFallow2"
set alias(SummerFallow2) "fallow"
set colour(SummerFallow2) "gray"
stateGraph node insert "Wheat"
set alias(Wheat) "wheat"
set colour(Wheat) "darkgreen"
stateGraph node insert "WinterFallow"
set alias(WinterFallow) "fallow"
set colour(WinterFallow) "gray"
stateGraph node insert "Cotton"
set alias(Cotton) "cotton"
set colour(Cotton) "purple"
stateGraph node insert "F1"
set alias(F1) "fallow"
set colour(F1) "gray"
stateGraph node insert "SummerFallow1"
set alias(SummerFallow1) "fallow"
set colour(SummerFallow1) "maroon"
stateGraph arc insert "WinterFallow" "Cotton" "arc6"
stateGraph arc lappend "arc6" actions {apsimSendMessage cotton sow {plants_pm 10} {sowing_depth  30} {cultivar  siok} {row_spacing 1000}}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" actions {}
stateGraph arc lappend "arc6" rules {[dateWithin 288 349]}
stateGraph arc lappend "arc6" rules {[sumLastRain 4] > 10}
stateGraph arc lappend "arc6" rules {[apsimGet esw] > 100}
stateGraph arc insert "SummerFallow1" "WinterFallow" "arc2"
stateGraph arc lappend "arc2" actions {}
stateGraph arc lappend "arc2" actions {}
stateGraph arc lappend "arc2" actions {}
stateGraph arc lappend "arc2" rules {[apsimGet day]  == 192}
stateGraph arc insert "F1" "SummerFallow1" "arc7"
stateGraph arc lappend "arc7" actions {}
stateGraph arc lappend "arc7" actions {}
stateGraph arc lappend "arc7" actions {}
stateGraph arc lappend "arc7" rules {[apsimGet day]  == 192}
stateGraph arc insert "Wheat" "SummerFallow2" "arc3"
stateGraph arc lappend "arc3" actions {apsimSendMessage wheat harvest}
stateGraph arc lappend "arc3" actions {apsimSendMessage wheat end_crop}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" actions {}
stateGraph arc lappend "arc3" rules {{[apsimGet wheat.stage_name] == "harvest_ripe" || [apsimGet wheat.plant_status] == "dead"}}
stateGraph arc insert "Chickpea" "SummerFallow1" "arc8"
stateGraph arc lappend "arc8" actions {apsimSendMessage chickpea harvest}
stateGraph arc lappend "arc8" actions {apsimSendMessage chickpea end_crop}
stateGraph arc lappend "arc8" actions {}
stateGraph arc lappend "arc8" actions {}
stateGraph arc lappend "arc8" actions {}
stateGraph arc lappend "arc8" actions {}
stateGraph arc lappend "arc8" rules {{[apsimGet chickpea.stage_name] == "harvest_ripe" || [apsimGet chickpea.plant_status] == "dead"}}
stateGraph arc insert "F1" "Chickpea" "arc0"
stateGraph arc lappend "arc0" actions {apsimSendMessage chickpea sow {plants 25} {sowing_depth 30} {cultivar amethyst} {row_spacing 500} }
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" actions {}
stateGraph arc lappend "arc0" rules {[dateWithin 135 191]}
stateGraph arc lappend "arc0" rules {[sumLastRain 3] > 25}
stateGraph arc lappend "arc0" rules {[apsimGet esw] > 50}
stateGraph arc insert "SummerFallow2" "WinterFallow" "arc9"
stateGraph arc lappend "arc9" actions {}
stateGraph arc lappend "arc9" actions {}
stateGraph arc lappend "arc9" actions {}
stateGraph arc lappend "arc9" actions {}
stateGraph arc lappend "arc9" actions {}
stateGraph arc lappend "arc9" rules {[apsimGet day]  == 74}
stateGraph arc insert "WinterFallow" "Cotton" "arc10"
stateGraph arc lappend "arc10" actions {apsimSendMessage cotton sow {plants_pm 10} {sowing_depth  30} {cultivar  siok} {row_spacing 1000}}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" actions {}
stateGraph arc lappend "arc10" rules {[apsimGet day] == 350}
stateGraph arc insert "Cotton" "F1" "arc5"
stateGraph arc lappend "arc5" actions {apsimSendMessage cotton harvest}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" actions {}
stateGraph arc lappend "arc5" rules {[apsimGet ozcot_status] > 0}
stateGraph arc insert "SummerFallow1" "Wheat" "arc1"
stateGraph arc lappend "arc1" actions {apsimSendMessage wheat sow {plants 100} {sowing_depth 30} {cultivar hartog} {row_spacing 250} }
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" actions {}
stateGraph arc lappend "arc1" rules {[dateWithin 135 191]}
stateGraph arc lappend "arc1" rules {[sumLastRain 3] > 25}
stateGraph arc lappend "arc1" rules {[apsimGet esw] > 50}
]]></rule>
        </tclui>
        <rule name="Initialisation">
          <condition name="init"><![CDATA[
# Support procedures

# return true if today's date is within 2 points.
proc dateWithin {t0 t1} {
   set t [apsimGet day]
   if {$t0 > $t1} {
      return [expr $t >= $t0 || $t <= $t1]
   } else {
      return [expr $t >= $t0 && $t <= $t1]
   }
   # notreached
}

proc dateIs {t} {
   return [expr $t == [apsimGet day]]
}

# Return the current state of the system
proc currentState {} {
   global state
   return $state
}

# Return the sum of the last n days rainfall
proc sumLastRain {n} {
   global rainList
   return  [expr [join [lrange $rainList end-[expr $n-1] end] "+"]]
}

# Maintain a list of rainfall amounts.
proc accumRain {} {
   global rainList
   set rainList [concat [lrange $rainList 1 end] [apsimGet rain]]
}

# This "logfile" is used to generate the rugplots of farm activities
set logFile {}
proc setupLogging {} {
   global logFile simName colour
   set logFile [open $simName.log w]
   puts $logFile "Starting [apsimGet day],[apsimGet year]"
   puts $logFile "paddocks = p1"
   foreach {state col} [array get colour] {
      puts $logFile "colour $state $col"
   }
   flush $logFile
   apsimWriteToSummaryFile "initialised logging:paddocks=p1"
}
proc closeLogging {} {
   global logFile
   puts $logFile "Finished"
   close $logFile
}
proc log {msg} {
   global logFile
   puts $logFile $msg
   apsimWriteToSummaryFile $msg
}

############### The decision routine.
# Return the score for planting "what"
proc checkRules {} {
  log "State is [currentState]. (esw=[format %.0f [apsimGet esw]])"

  set bestScore -1.0; set bestTarget {}
  foreach arc [stateGraph arcs -out [currentState]] {
     set expr {}
     set target [stateGraph arc target $arc]
     foreach rule [stateGraph arc get $arc rules] {
        set value [uplevel #0 expr $rule]
        log "target=$target,rule=$rule, value=$value"
        lappend expr $value
     }
     set score [expr [join $expr "*"]]
     if {$score > $bestScore} {
        set bestScore $score
        set bestTarget $target
     }
  }
  return [list $bestTarget $bestScore]
}

# Change state to another
proc changeState {newState} {
   global state
   set arcs {}
   foreach arc [stateGraph arcs -out [currentState]] {
      if {[stateGraph arc target $arc] == "$newState" } {
         lappend arcs $arc
      }
   }
   if {[llength $arcs] == 0} {error "No paths from [currentState] to $newState!"}
   if {[llength $arcs] > 1} {
      # More than 1 path - evaluate best option
      set bestScore -1.0; set bestArc {}
      foreach arc $arcs {
         set expr {}
         foreach rule [stateGraph arc get $arc rules] {
            set value [uplevel #0 expr $rule]
            lappend expr $value
         }
         set score [expr [join $expr "*"]]
         if {$score > $bestScore} {
            set bestScore $score
            set bestArc $arc
         }
      }
      if {$bestScore > 0.0} {
         apsimWriteToSummaryFile "Taking arc $bestArc from [currentState] to $newState"
         set arc $bestArc
      } else {
         error "No viable paths from [currentState] to $newState! (candidates are $arcs)"
      }
   } else {
      # Only 1 path - take it.
      set arc $arcs
   }
   foreach action [stateGraph arc get $arc actions] { uplevel #0 $action }
   set state $newState
   log "changeState p1 $newState"
}

proc doProcess {} {
    log "[apsimGet day],[apsimGet year]"
    foreach  {target score} [checkRules] {break}
    if {$score > 0} {changeState $target}
}

# A flag for initialisation procedures.
# NB. some funny business here. Delay opening report file until the 1st day of
# simulation as it's hard to know how many paddocks are present at init2 time.
set setupDone 0
proc checkSetup {} {
   global setupDone
   if {!$setupDone} {
      foreach node [stateGraph nodes] {
         if {[llength [stateGraph arcs -out $node]] <= 0} {error "No arcs out of $node!!"}
      }
     setupLogging
     log "changeState p1 [currentState]"
     set setupDone 1
  }
}

############### Stuff starts here.
# The 10 day rainfall accumulator - should be the 10 days of rain prior to start of simulation
set rainList {0.2 1.0 0 0 0 0 15 12 0 0 0 0}

# the initial state
set state    "WinterFallow"

set simName "Rotation Sample 2"
]]></condition>
          <condition name="prepare" />
          <condition name="process">if {[catch {checkSetup ; accumRain; doProcess}]} {
    error "$errorInfo"
}</condition>
          <condition name="post" />
          <condition name="exit">closeLogging
</condition>
        </rule>
      </tclmanager>
      <wheat />
      <ozcot name="cotton" />
      <chickpea />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat_stubble</PoolName>
        <type description="Organic Matter type">wheat</type>
        <mass description="Initial surface residue (kg/ha)">1000.</mass>
        <cnr description="C:N ration of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <variables name="Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="cotton.dm as Cotton.Biomass" description="Total above ground biomass (kg/ha)" array="?" />
          <variable name="biomass" description="Biomass" array="No" />
          <variable name="lai" description="Leaf area index" array="No" />
        </variables>
        <events name="Reporting Frequency">
          <event name="harvesting" description="" />
        </events>
      </outputfile>
      <fertiliser name="fertiliser" />
      <soil name="#009 - Kupunn">
        <Site>Kupunn</Site>
        <Region>South East Queensland</Region>
        <LocalName>Brigalow</LocalName>
        <SoilType>Grey Vertosol</SoilType>
        <NearestTown>Dalby, Q 4405</NearestTown>
        <NaturalVegetation>Brigalow, belah, wilga</NaturalVegetation>
        <profile>
          <layer>
            <thickness>150</thickness>
            <bd>1.4</bd>
            <ll15>0.21</ll15>
            <airdry>0.105</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.03</fbiom>
            <finert>0.4</finert>
            <no3>6.5</no3>
            <nh4>0.6</nh4>
            <oc>1.24</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.21</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.21</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.21</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.21</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>150</thickness>
            <bd>1.39</bd>
            <ll15>0.21</ll15>
            <airdry>0.189</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <oc>1.24</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.21</ll>
            <kl name="Chickpea">0.1</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.21</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.21</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.21</ll>
            <kl name="Wheat">0.1</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.37</bd>
            <ll15>0.22</ll15>
            <airdry>0.22</airdry>
            <dul>0.4</dul>
            <sat>0.45</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.8</finert>
            <no3>2.1</no3>
            <nh4>0.1</nh4>
            <oc>1.25</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.22</ll>
            <kl name="Chickpea">0.08</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.22</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.26</ll>
            <kl name="Sorghum">0.1</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.25</ll>
            <kl name="Wheat">0.08</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.36</bd>
            <ll15>0.25</ll15>
            <airdry>0.25</airdry>
            <dul>0.41</dul>
            <sat>0.46</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>1.1</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.27</ll>
            <kl name="Chickpea">0.06</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.25</ll>
            <kl name="Cotton">0.1</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.26</ll>
            <kl name="Sorghum">0.08</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.28</ll>
            <kl name="Wheat">0.06</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.38</bd>
            <ll15>0.27</ll15>
            <airdry>0.27</airdry>
            <dul>0.4</dul>
            <sat>0.45</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.71</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.29</ll>
            <kl name="Chickpea">0.04</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.27</ll>
            <kl name="Cotton">0.09</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.28</ll>
            <kl name="Sorghum">0.06</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.31</ll>
            <kl name="Wheat">0.04</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.39</bd>
            <ll15>0.31</ll15>
            <airdry>0.31</airdry>
            <dul>0.39</dul>
            <sat>0.44</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.34</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.34</ll>
            <kl name="Chickpea">0.02</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.31</ll>
            <kl name="Cotton">0.07</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.34</ll>
            <kl name="Sorghum">0.04</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.37</ll>
            <kl name="Wheat">0.02</kl>
            <xf name="Wheat">1</xf>
          </layer>
          <layer>
            <thickness>300</thickness>
            <bd>1.42</bd>
            <ll15>0.36</ll15>
            <airdry>0.36</airdry>
            <dul>0.38</dul>
            <sat>0.43</sat>
            <sw>9999.99</sw>
            <swcon>0.3</swcon>
            <fbiom>0.01</fbiom>
            <finert>0.95</finert>
            <no3>1.7</no3>
            <nh4>0.1</nh4>
            <oc>0.26</oc>
            <ph>7</ph>
            <ll name="Chickpea">0.38</ll>
            <kl name="Chickpea">0.01</kl>
            <xf name="Chickpea">1</xf>
            <ll name="Cotton">0.36</ll>
            <kl name="Cotton">0.05</kl>
            <xf name="Cotton">1</xf>
            <ll name="Sorghum">0.36</ll>
            <kl name="Sorghum">0.02</kl>
            <xf name="Sorghum">1</xf>
            <ll name="Wheat">0.38</ll>
            <kl name="Wheat">0.01</kl>
            <xf name="Wheat">1</xf>
          </layer>
        </profile>
        <Cona>3.5</Cona>
        <DiffusConst>40</DiffusConst>
        <DiffusSlope>16</DiffusSlope>
        <U>6</U>
        <Salb>0.13</Salb>
        <Cn2Bare>73</Cn2Bare>
        <CnRed>20</CnRed>
        <CnCov>0.8</CnCov>
        <CnCanopyFact>1</CnCanopyFact>
        <RootCn>40</RootCn>
        <RootWt>200</RootWt>
        <SoilCn>12.5</SoilCn>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <Comment>oc and ph not measured</Comment>
        <InitWater>
          <percentmethod>
            <percent>1</percent>
            <distributed>filled from top</distributed>
          </percentmethod>
        </InitWater>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>6.500</no3>
              <nh4>0.600</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>2.100</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1.700</no3>
              <nh4>0.100</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
      </soil>
    </area>
  </simulation>
  <simulation name="Wether_Lucerne_Supplement">
    <metfile name="met">
      <filename name="filename">C:\data\Apsim\development\apsim\met\sample\Workshop.met</filename>
    </metfile>
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date" lbound="1/01/1995" ubound="31/12/1996">1/01/1995</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date" lbound="1/01/1995" ubound="31/12/1996">30/12/1996</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Wether_Lucerne.sum</filename>
    </summaryfile>
    <outputfile name="Outputfile">
      <variables name="My Variables">
        <variable name="StockHerbageConverter.dm_feed_on_offer()" description="Dry matter of feed on offer (kg/ha)" array="?" />
        <variable name="StockHerbageConverter.dm_feed_removed()" description="Dry matter of feed removed (kg/ha)" array="?" />
        <variable name="stock.age" array="?" />
        <variable name="stock.wt_change" array="?" />
        <variable name="stock.weight" array="?" />
        <variable name="stock.sex" array="?" />
        <variable name="stock.past_intake" array="?" />
        <variable name="stock.number" array="?" />
        <variable name="lucerne.biomass" description="Biomass" array="?" />
        <variable name="lucerne.stage" description="Plant stage" array="?" />
        <variable name="lucerne.lai" description="Leaf area index" array="?" />
        <variable name="stock.cond_score_all" array="?" />
        <variable name="stock.past_intake_all" array="?" />
        <variable name="stock.supp_intake_all" array="?" />
        <variable name="stock.fleece_wt_all" array="?" />
        <variable name="stock.fibre_diam_all" array="?" />
        <variable name="clock.dd/mmm/yyyy" description="Date (dd/mmm/yyyy)" array="?" />
        <variable name="clock.year" description="Year" array="?" />
        <variable name="met.rain" description="Rainfall (mm)" array="?" />
        <variable name="lucerne.cover_tot" array="?" />
        <variable name="lucerne.dlt_dm" description="Change in dry matter" array="?" />
        <variable name="lucerne.dlt_dm_green as dlt_dm_green_leaf(2)" description="change in green pool" array="?" />
        <variable name="lucerne.dlt_dm_green as dlt_dm_green_stem(3)" description="change in green pool" array="?" />
        <variable name="lucerne.dm_green_leaf" description="Weight of leaf" array="?" />
        <variable name="lucerne.dm_green_stem" description="Weight of stem" array="?" />
        <variable name="lucerne.dm_senesced_leaf" description="Weight of senesced leaf" array="?" />
        <variable name="lucerne.dm_senesced_stem" description="Weight of senesced stem" array="?" />
        <variable name="lucerne.dm_dead_stem" description="Weight of dead stem" array="?" />
        <variable name="lucerne.dm_dead_leaf" description="Weight of dead leaf" array="?" />
      </variables>
      <events name="My Variables Events">
        <event name="clock.post" description="End of daily simulation time step" />
      </events>
    </outputfile>
    <manager name="Manager">
      <rule name="Sow on a fixed date">
        <condition name="start_of_day">
        if (today = date('[date]') then
              [crop] sow plants =[density], sowing_depth = [depth], cultivar = [cultivar], row_spacing = [row_spacing]
         endif
               </condition>
        <category name="Sowing criteria">
          <date type="text" description="Enter sowing date (dd-mmm) : ">1/07/1995</date>
        </category>
        <category name="Sowing parameters">
          <crop type="crop" description="Enter name of crop to sow : ">lucerne</crop>
          <density type="text" description="Enter sowing density  (plants/m2) : ">100</density>
          <depth type="text" description="Enter sowing depth  (mm) : ">50</depth>
          <cultivar type="cultivars" croppropertyname="crop" description="Enter cultivar : ">sceptre</cultivar>
          <row_spacing type="text" description="Enter row spacing (mm) : ">500</row_spacing>
        </category>
      </rule>
      <rule name="Buy sheep on feed-on-offer">
        <condition name="init">
               sheep_presence = 'off'
            </condition>
        <condition name="start_of_day"><![CDATA[
        if ([herbage_module].biomass >= [buy_feed_on_offer] AND sheep_presence = 'off') then
           [stockmodule] buystock number = [buy_number] (-), genotype = '[genotype]', sex = [sex], age = [buy_age] (months), weight = [buy_weight] (kg)
           sheep_presence = 'on'
         endif
               ]]></condition>
        <category name="Buy properties">
          <stockmodule type="modulename" description="Name of stock converter module : ">StockScienceConverter</stockmodule>
          <genotype type="list" listvalues="black face x white face,border leicester, border leicester x merino,columbia,corriedale,delaine-merino,dorset x merino,dorset,finnsheep,hampshire,large merino,medium merino,small merino,polwarth,polypay,romney,ryeland,southdown,suffolk,targhee,texel,US corriedale,US romney,US southdown,US suffolk" description="Select Genotype : ">suffolk</genotype>
          <herbage_module type="modulename" description="Module supplying herbage : ">lucerne</herbage_module>
          <buy_feed_on_offer type="text" description="Feed on offer (kg/ha) : ">200</buy_feed_on_offer>
          <buy_number type="text" description="Number of stock : ">15</buy_number>
          <sex type="list" listvalues="ewe,wether,ram,crypto" description="Select sex : ">wether</sex>
          <buy_age type="text" description="Age (months) : ">12</buy_age>
          <buy_weight type="text" description="Weight (kg) : ">45</buy_weight>
        </category>
      </rule>
      <rule name="Sell sheep on weight">
        <condition name="start_of_day"><![CDATA[
        if ((stock.weight >= [sell_on_weight_gain] OR stock.weight <= [sell_on_weight_loss]) AND sheep_presence = 'on') then
           [stockmodule] sellstock number = [sell_number] (-)
           sheep_presence = 'off'
        endif
               ]]></condition>
        <category name="Sell properties">
          <stockmodule type="modulename" description="Name of stock converter module : ">StockScienceConverter</stockmodule>
          <sell_on_weight_gain type="text" description="Weight (gaining) : ">50</sell_on_weight_gain>
          <sell_on_weight_loss type="text" description="Weight (losing) : ">40</sell_on_weight_loss>
          <sell_number type="text" description="Number of stock : ">15</sell_number>
        </category>
      </rule>
      <rule name="Buy supplement on a fixed date">
        <condition name="start_of_day">
        if (today = date('[buy_date]') then
           [supplementmodule] buysupplement supplement = [buy_name] (-), amount = [buy_amount] (kg)
         endif
               </condition>
        <category name="Buy properties">
          <supplementmodule type="modulename" description="Name of supplement converter module : ">SupplementScienceConverter</supplementmodule>
          <buy_date type="text" description="Date (dd-mmm) : ">1-jan</buy_date>
          <buy_name type="list" listvalues="'barley- crushed','barley- whole','barley straw','beans- field','bran','brewers grains','canola meal','canola straw','citrus pulp- dry','coconut meal','cottonseed- whole','cottonseed meal','fish meal','groundnut meal','hay','lucerne pellets','lupins','linseed meal','maize','maize bran','maize gluten fd','maize straw','molasses','oats- crushed','oats- whole','oat bran','oat chaff','oat straw','peas','pea pod meal','pea straw','pellets','rice- crushed','rice- whole','rice bran','rice straw','rye','safflower meal','silage','sorghum','sorghum- whole','soya bean meal','sunflower meal','tallow','triticale- crushed','triticale- whole','urea','vetch grain','wheat- crushed','wheat- whole','wheat chaff','wheat pollard','wheat straw'" description="Name of the supplement to purchase : ">'lupins'</buy_name>
          <buy_amount type="text" description="Fresh weight of supplement to purchase (kg) : ">1000</buy_amount>
        </category>
      </rule>
      <rule name="Feed supplement on animal condition loss">
        <condition name="init">
         FALSE = 0
         TRUE = 1
         feeding = FALSE
         feed_rate = 0.0     ! Rate of feeding in kg FW/day
         crit_cs = 0.0
         feed_rate_factor = 0.2
         est_lag_days = 10.0 / feed_rate_factor
         initial_feed_rate = 0.0
            </condition>
        <condition name="start_of_day"><![CDATA[
         dlt_cond_score = cond_score_all - yest_cond_score_all
         yest_cond_score_all = cond_score_all
            if (feeding = TRUE AND cond_score_all = 0.0) then
               crit_cs = 0.0
               feeding = FALSE
            endif

            if (dlt_cond_score[[days]] < [crit_condition_change] AND crit_cs <= 0.0) then
               crit_cs = cond_score_all
            endif
            if ((feeding = FALSE) AND (cond_score_all < crit_cs)) then
               feeding = TRUE
               feed_rate = initial_feed_rate
            else
               ! leave feeding as is
            endif

            if (feeding = TRUE) then
               feed_rate = feed_rate - feed_rate_factor * (cond_score_all + dlt_cond_score*est_lag_days - crit_cs)
               if (feed_rate > [max_feed_rate]) then
                  feed_rate = [max_feed_rate]
               elseif (feed_rate < 0.0) then
                  feed_rate = 0.0
               endif
               if (feed_rate > 0) then
                   feed_amount = feed_rate * number_all
                   [supplementmodule] feedsupplement  supplement = [feed_name], amount = feed_amount
               else
                  feed_rate = 0.0
               endif
            else
               feed_rate = 0.0
            endif

               ]]></condition>
        <category name="Feed properties">
          <supplementmodule type="modulename" description="Name of supplement converter module : ">SupplementScienceConverter</supplementmodule>
          <days type="text" description="Number of days to sum condition change : ">5</days>
          <crit_condition_change type="text" description="Critical condition change needed to start feeding (kg/head) : ">0.0</crit_condition_change>
          <max_feed_rate type="text" description="Maximum rate of feeding in kg FW/day; 1.0 is sensible for sheep : ">1.0</max_feed_rate>
          <feed_name type="list" listvalues="'barley- crushed','barley- whole','barley straw','beans- field','bran','brewers grains','canola meal','canola straw','citrus pulp- dry','coconut meal','cottonseed- whole','cottonseed meal','fish meal','groundnut meal','hay','lucerne pellets','lupins','linseed meal','maize','maize bran','maize gluten fd','maize straw','molasses','oats- crushed','oats- whole','oat bran','oat chaff','oat straw','peas','pea pod meal','pea straw','pellets','rice- crushed','rice- whole','rice bran','rice straw','rye','safflower meal','silage','sorghum','sorghum- whole','soya bean meal','sunflower meal','tallow','triticale- crushed','triticale- whole','urea','vetch grain','wheat- crushed','wheat- whole','wheat chaff','wheat pollard','wheat straw'" description="Name of the supplement to purchase : ">'lupins'</feed_name>
        </category>
      </rule>
    </manager>
    <surfaceom name="Surface Organic Matter">
      <PoolName description="Organic Matter pool name">wheat_stubble</PoolName>
      <type description="Organic Matter type">wheat</type>
      <mass description="Initial surface residue (kg/ha)">1000.</mass>
      <cnr description="C:N ratio of initial residue">80.0</cnr>
      <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
    </surfaceom>
    <lucerne />
    <stock>
      <sheep>
        <genotypename>medium merino</genotypename>
        <number>0</number>
        <sex type="list" listvalues="ewe,wether,ram,crypto">wether</sex>
        <age>730.0</age>
        <weight>50.0</weight>
        <max_prev_wt>50.0</max_prev_wt>
        <fleece_wt>6.0</fleece_wt>
        <fibre_diam>20.0</fibre_diam>
        <mated_to />
        <pregnant>0</pregnant>
        <lactating>0</lactating>
        <no_young>0</no_young>
        <birth_cs>0.0</birth_cs>
        <lamb_wt>0.0</lamb_wt>
        <lamb_fleece_wt>0.0</lamb_fleece_wt>
        <paddock />
        <tag>0</tag>
        <priority>0</priority>
      </sheep>
      <stockgenotype name="Medium Merino Genotype">
        <genotypename>medium merino</genotypename>
        <dam_breed>medium merino</dam_breed>
        <sire_breed>medium merino</sire_breed>
        <generation>0</generation>
        <srw>50.0</srw>
        <conception1>0.8</conception1>
        <conception2>0.15</conception2>
        <death_rate>0.02</death_rate>
        <ref_fleece_wt>4.5</ref_fleece_wt>
        <max_fibre_diam>19.0</max_fibre_diam>
        <fleece_yield>0.7</fleece_yield>
        <peak_milk>25.0</peak_milk>
      </stockgenotype>
    </stock>
    <StockScienceConverter>
      <debug type="list" listvalues="on,off">off</debug>
      <stock_module type="modulename">stock</stock_module>
      <conversion_model>nonherbage</conversion_model>
      <fraction_faeces_added>0.5</fraction_faeces_added>
      <fraction_urine_added>0.5</fraction_urine_added>
    </StockScienceConverter>
    <StockHerbageConverter>
      <debug type="list" listvalues="on,off">off</debug>
      <conversion_model>herbage</conversion_model>
      <herbage_model>plant</herbage_model>
      <herbage_module_name type="modulename">lucerne</herbage_module_name>
    </StockHerbageConverter>
    <FarmwiseSequencerConverter name="FarmwiseSequencer" />
    <SupplementScienceConverter>
      <debug type="list" listvalues="on,off">off</debug>
      <supplement_module type="modulename">supplement</supplement_module>
    </SupplementScienceConverter>
    <supplement>
      <spoilage_time>0.0</spoilage_time>
      <supplementstore name="Wheat Store">
        <name>wheat</name>
        <stored>10000000</stored>
        <roughage>false</roughage>
        <dm_content>0.89</dm_content>
        <dmd>0.9</dmd>
        <me_content>13.8</me_content>
        <cp_conc>0.14</cp_conc>
        <prot_dg>0.92</prot_dg>
        <p_conc>0.0038</p_conc>
        <s_conc>0.0014</s_conc>
        <ee_conc>0.02</ee_conc>
        <adip2cp>0.02</adip2cp>
        <ash_alk>0.18</ash_alk>
        <max_passage>0.0</max_passage>
      </supplementstore>
    </supplement>
    <accum name="accum">
      <variable name="variable">dlt_cond_score[20]</variable>
    </accum>
    <soil name="SampleBlackEarth">
      <region>South East Queensland</region>
      <site>Generic</site>
      <SoilType>Black Vertosol</SoilType>
      <comment>estimated cotton LL</comment>
      <profile>
        <layer>
          <thickness>150</thickness>
          <bd>1.02</bd>
          <ll15>0.29</ll15>
          <airdry>0.14</airdry>
          <dul>0.54</dul>
          <sat>0.59</sat>
          <swcon>0.3</swcon>
          <fbiom>0.025</fbiom>
          <finert>0.4</finert>
          <oc>1.04</oc>
          <ph>8.4</ph>
          <ec>0.2</ec>
          <ll name="wheat">0.29</ll>
          <kl name="wheat">0.1</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.29</ll>
          <kl name="barley">0.1</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.29</ll>
          <kl name="canola">0.1</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.29</ll>
          <kl name="Chickpea">0.1</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.29</ll>
          <kl name="Lucerne">0.1</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.29</ll>
          <kl name="Maize">0.1</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.29</ll>
          <kl name="Perennial Grass">0.1</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.29</ll>
          <kl name="Sorghum">0.1</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.29</ll>
          <kl name="Cowpea">0.1</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.29</ll>
          <kl name="Fababean">0.1</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.29</ll>
          <kl name="Mungbean">0.1</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.29</ll>
          <kl name="Navybean">0.1</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.29</ll>
          <kl name="Peanut">0.1</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.29</ll>
          <kl name="Pigeonpea">0.1</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.29</ll>
          <kl name="Soybean">0.1</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.29</ll>
          <kl name="Stylo">0.1</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.29</ll>
          <kl name="Sugar">0.1</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.29</ll>
          <kl name="Sunflower">0.1</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.29</ll>
          <kl name="Lablab">0.1</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.29</ll>
          <kl name="Cotton">0.1</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>150</thickness>
          <bd>1.03</bd>
          <ll15>0.29</ll15>
          <airdry>0.26</airdry>
          <dul>0.53</dul>
          <sat>0.58</sat>
          <swcon>0.3</swcon>
          <fbiom>0.02</fbiom>
          <finert>0.6</finert>
          <oc>0.89</oc>
          <ph>8.8</ph>
          <ec>0.25</ec>
          <ll name="wheat">0.29</ll>
          <kl name="wheat">0.1</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.29</ll>
          <kl name="barley">0.1</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.29</ll>
          <kl name="canola">0.1</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.29</ll>
          <kl name="Chickpea">0.1</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.29</ll>
          <kl name="Lucerne">0.1</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.29</ll>
          <kl name="Maize">0.1</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.29</ll>
          <kl name="Perennial Grass">0.1</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.29</ll>
          <kl name="Sorghum">0.1</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.29</ll>
          <kl name="Cowpea">0.1</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.29</ll>
          <kl name="Fababean">0.1</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.29</ll>
          <kl name="Mungbean">0.1</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.29</ll>
          <kl name="Navybean">0.1</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.29</ll>
          <kl name="Peanut">0.1</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.29</ll>
          <kl name="Pigeonpea">0.1</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.29</ll>
          <kl name="Soybean">0.1</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.29</ll>
          <kl name="Stylo">0.1</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.29</ll>
          <kl name="Sugar">0.1</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.29</ll>
          <kl name="Sunflower">0.1</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.29</ll>
          <kl name="Lablab">0.1</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.29</ll>
          <kl name="Cotton">0.1</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.02</bd>
          <ll15>0.29</ll15>
          <airdry>0.29</airdry>
          <dul>0.54</dul>
          <sat>0.59</sat>
          <swcon>0.3</swcon>
          <fbiom>0.015</fbiom>
          <finert>0.8</finert>
          <oc>0.89</oc>
          <ph>9</ph>
          <ec>0.31</ec>
          <ll name="wheat">0.32</ll>
          <kl name="wheat">0.08</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.32</ll>
          <kl name="barley">0.08</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.32</ll>
          <kl name="canola">0.08</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.36</ll>
          <kl name="Chickpea">0.08</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.29</ll>
          <kl name="Lucerne">0.1</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.34</ll>
          <kl name="Maize">0.1</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.39</ll>
          <kl name="Perennial Grass">0.1</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.35</ll>
          <kl name="Sorghum">0.1</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.32</ll>
          <kl name="Cowpea">0.08</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.32</ll>
          <kl name="Fababean">0.08</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.32</ll>
          <kl name="Mungbean">0.08</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.32</ll>
          <kl name="Navybean">0.08</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.32</ll>
          <kl name="Peanut">0.08</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.32</ll>
          <kl name="Pigeonpea">0.08</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.32</ll>
          <kl name="Soybean">0.08</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.32</ll>
          <kl name="Stylo">0.08</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.32</ll>
          <kl name="Sugar">0.08</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.32</ll>
          <kl name="Sunflower">0.08</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.32</ll>
          <kl name="Lablab">0.08</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.35</ll>
          <kl name="Cotton">0.1</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.02</bd>
          <ll15>0.29</ll15>
          <airdry>0.29</airdry>
          <dul>0.54</dul>
          <sat>0.58</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.9</finert>
          <oc>0.89</oc>
          <ph>9.2</ph>
          <ec>0.4</ec>
          <ll name="wheat">0.32</ll>
          <kl name="wheat">0.06</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.38</ll>
          <kl name="barley">0.06</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.32</ll>
          <kl name="canola">0.06</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.43</ll>
          <kl name="Chickpea">0.06</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.29</ll>
          <kl name="Lucerne">0.1</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.34</ll>
          <kl name="Maize">0.08</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.41</ll>
          <kl name="Perennial Grass">0.1</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.38</ll>
          <kl name="Sorghum">0.08</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.32</ll>
          <kl name="Cowpea">0.06</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.32</ll>
          <kl name="Fababean">0.06</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.32</ll>
          <kl name="Mungbean">0.06</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.32</ll>
          <kl name="Navybean">0.06</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.32</ll>
          <kl name="Peanut">0.06</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.32</ll>
          <kl name="Pigeonpea">0.06</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.32</ll>
          <kl name="Soybean">0.06</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.32</ll>
          <kl name="Stylo">0.06</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.32</ll>
          <kl name="Sugar">0.06</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.32</ll>
          <kl name="Sunflower">0.06</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.32</ll>
          <kl name="Lablab">0.06</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.36</ll>
          <kl name="Cotton">0.08</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.06</bd>
          <ll15>0.3</ll15>
          <airdry>0.3</airdry>
          <dul>0.52</dul>
          <sat>0.57</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.77</oc>
          <ph>9.2</ph>
          <ec>0.59</ec>
          <ll name="wheat">0.35</ll>
          <kl name="wheat">0.04</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.39</ll>
          <kl name="barley">0.04</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.35</ll>
          <kl name="canola">0.04</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.51</ll>
          <kl name="Chickpea">0.04</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.3</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.37</ll>
          <kl name="Maize">0.06</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.4</ll>
          <kl name="Perennial Grass">0.09</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.4</ll>
          <kl name="Sorghum">0.06</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.35</ll>
          <kl name="Cowpea">0.04</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.35</ll>
          <kl name="Fababean">0.04</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.35</ll>
          <kl name="Mungbean">0.04</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.35</ll>
          <kl name="Navybean">0.04</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.35</ll>
          <kl name="Peanut">0.04</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.35</ll>
          <kl name="Pigeonpea">0.04</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.35</ll>
          <kl name="Soybean">0.04</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.35</ll>
          <kl name="Stylo">0.04</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.35</ll>
          <kl name="Sugar">0.04</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.35</ll>
          <kl name="Sunflower">0.04</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.35</ll>
          <kl name="Lablab">0.04</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.38</ll>
          <kl name="Cotton">0.06</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.11</bd>
          <ll15>0.31</ll15>
          <airdry>0.31</airdry>
          <dul>0.5</dul>
          <sat>0.55</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.45</oc>
          <ph>9.1</ph>
          <ec>0.84</ec>
          <ll name="wheat">0.38</ll>
          <kl name="wheat">0.02</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.39</ll>
          <kl name="barley">0.02</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.38</ll>
          <kl name="canola">0.02</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.5</ll>
          <kl name="Chickpea">0.02</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.31</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.4</ll>
          <kl name="Maize">0.04</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.4</ll>
          <kl name="Perennial Grass">0.07</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.4</ll>
          <kl name="Sorghum">0.04</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.38</ll>
          <kl name="Cowpea">0.02</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.38</ll>
          <kl name="Fababean">0.02</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.38</ll>
          <kl name="Mungbean">0.02</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.38</ll>
          <kl name="Navybean">0.02</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.38</ll>
          <kl name="Peanut">0.02</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.38</ll>
          <kl name="Pigeonpea">0.02</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.38</ll>
          <kl name="Soybean">0.02</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.38</ll>
          <kl name="Stylo">0.02</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.38</ll>
          <kl name="Sugar">0.02</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.38</ll>
          <kl name="Sunflower">0.02</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.38</ll>
          <kl name="Lablab">0.02</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.39</ll>
          <kl name="Cotton">0.04</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.12</bd>
          <ll15>0.32</ll15>
          <airdry>0.32</airdry>
          <dul>0.5</dul>
          <sat>0.55</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.27</oc>
          <ph>9</ph>
          <ec>0.93</ec>
          <ll name="wheat">0.41</ll>
          <kl name="wheat">0.01</kl>
          <xf name="wheat">1</xf>
          <ll name="barley">0.41</ll>
          <kl name="barley">0.01</kl>
          <xf name="barley">1</xf>
          <ll name="canola">0.41</ll>
          <kl name="canola">0.01</kl>
          <xf name="canola">1</xf>
          <ll name="Chickpea">0.5</ll>
          <kl name="Chickpea">0.01</kl>
          <xf name="Chickpea">1</xf>
          <ll name="Lucerne">0.32</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.42</ll>
          <kl name="Maize">0.02</kl>
          <xf name="Maize">1</xf>
          <ll name="Perennial Grass">0.41</ll>
          <kl name="Perennial Grass">0.05</kl>
          <xf name="Perennial Grass">1</xf>
          <ll name="Sorghum">0.4</ll>
          <kl name="Sorghum">0.02</kl>
          <xf name="Sorghum">1</xf>
          <ll name="Cowpea">0.41</ll>
          <kl name="Cowpea">0.01</kl>
          <xf name="Cowpea">1</xf>
          <ll name="Fababean">0.41</ll>
          <kl name="Fababean">0.01</kl>
          <xf name="Fababean">1</xf>
          <ll name="Mungbean">0.41</ll>
          <kl name="Mungbean">0.01</kl>
          <xf name="Mungbean">1</xf>
          <ll name="Navybean">0.41</ll>
          <kl name="Navybean">0.01</kl>
          <xf name="Navybean">1</xf>
          <ll name="Peanut">0.41</ll>
          <kl name="Peanut">0.01</kl>
          <xf name="Peanut">1</xf>
          <ll name="Pigeonpea">0.41</ll>
          <kl name="Pigeonpea">0.01</kl>
          <xf name="Pigeonpea">1</xf>
          <ll name="Soybean">0.41</ll>
          <kl name="Soybean">0.01</kl>
          <xf name="Soybean">1</xf>
          <ll name="Stylo">0.41</ll>
          <kl name="Stylo">0.01</kl>
          <xf name="Stylo">1</xf>
          <ll name="Sugar">0.41</ll>
          <kl name="Sugar">0.01</kl>
          <xf name="Sugar">1</xf>
          <ll name="Sunflower">0.41</ll>
          <kl name="Sunflower">0.01</kl>
          <xf name="Sunflower">1</xf>
          <ll name="Lablab">0.41</ll>
          <kl name="Lablab">0.01</kl>
          <xf name="Lablab">1</xf>
          <ll name="Cotton">0.39</ll>
          <kl name="Cotton">0.02</kl>
          <xf name="Cotton">1</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.15</bd>
          <ll15>0.33</ll15>
          <airdry>0.33</airdry>
          <dul>0.48</dul>
          <sat>0.53</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.22</oc>
          <ph>9</ph>
          <ec>1.01</ec>
          <ll name="wheat">0.48</ll>
          <kl name="wheat">0</kl>
          <xf name="wheat">0</xf>
          <ll name="barley">0.48</ll>
          <kl name="barley">0</kl>
          <xf name="barley">0</xf>
          <ll name="canola">0.48</ll>
          <kl name="canola">0</kl>
          <xf name="canola">0</xf>
          <ll name="Chickpea">0.48</ll>
          <kl name="Chickpea">0</kl>
          <xf name="Chickpea">0</xf>
          <ll name="Lucerne">0.33</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.48</ll>
          <kl name="Maize">0</kl>
          <xf name="Maize">0</xf>
          <ll name="Perennial Grass">0.41</ll>
          <kl name="Perennial Grass">0</kl>
          <xf name="Perennial Grass">0</xf>
          <ll name="Sorghum">0.48</ll>
          <kl name="Sorghum">0</kl>
          <xf name="Sorghum">0</xf>
          <ll name="Cowpea">0.48</ll>
          <kl name="Cowpea">0</kl>
          <xf name="Cowpea">0</xf>
          <ll name="Fababean">0.48</ll>
          <kl name="Fababean">0</kl>
          <xf name="Fababean">0</xf>
          <ll name="Mungbean">0.48</ll>
          <kl name="Mungbean">0</kl>
          <xf name="Mungbean">0</xf>
          <ll name="Navybean">0.48</ll>
          <kl name="Navybean">0</kl>
          <xf name="Navybean">0</xf>
          <ll name="Peanut">0.48</ll>
          <kl name="Peanut">0</kl>
          <xf name="Peanut">0</xf>
          <ll name="Pigeonpea">0.48</ll>
          <kl name="Pigeonpea">0</kl>
          <xf name="Pigeonpea">0</xf>
          <ll name="Soybean">0.48</ll>
          <kl name="Soybean">0</kl>
          <xf name="Soybean">0</xf>
          <ll name="Stylo">0.48</ll>
          <kl name="Stylo">0</kl>
          <xf name="Stylo">0</xf>
          <ll name="Sugar">0.48</ll>
          <kl name="Sugar">0</kl>
          <xf name="Sugar">0</xf>
          <ll name="Sunflower">0.48</ll>
          <kl name="Sunflower">0</kl>
          <xf name="Sunflower">0</xf>
          <ll name="Lablab">0.48</ll>
          <kl name="Lablab">0</kl>
          <xf name="Lablab">0</xf>
          <ll name="Cotton">0.48</ll>
          <kl name="Cotton">0</kl>
          <xf name="Cotton">0</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.18</bd>
          <ll15>0.34</ll15>
          <airdry>0.34</airdry>
          <dul>0.47</dul>
          <sat>0.52</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.16</oc>
          <ph>8.9</ph>
          <ec>1.06</ec>
          <ll name="wheat">0.47</ll>
          <kl name="wheat">0</kl>
          <xf name="wheat">0</xf>
          <ll name="barley">0.47</ll>
          <kl name="barley">0</kl>
          <xf name="barley">0</xf>
          <ll name="canola">0.47</ll>
          <kl name="canola">0</kl>
          <xf name="canola">0</xf>
          <ll name="Chickpea">0.47</ll>
          <kl name="Chickpea">0</kl>
          <xf name="Chickpea">0</xf>
          <ll name="Lucerne">0.34</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.47</ll>
          <kl name="Maize">0</kl>
          <xf name="Maize">0</xf>
          <ll name="Perennial Grass">0.4</ll>
          <kl name="Perennial Grass">0</kl>
          <xf name="Perennial Grass">0</xf>
          <ll name="Sorghum">0.47</ll>
          <kl name="Sorghum">0</kl>
          <xf name="Sorghum">0</xf>
          <ll name="Cowpea">0.47</ll>
          <kl name="Cowpea">0</kl>
          <xf name="Cowpea">0</xf>
          <ll name="Fababean">0.47</ll>
          <kl name="Fababean">0</kl>
          <xf name="Fababean">0</xf>
          <ll name="Mungbean">0.47</ll>
          <kl name="Mungbean">0</kl>
          <xf name="Mungbean">0</xf>
          <ll name="Navybean">0.47</ll>
          <kl name="Navybean">0</kl>
          <xf name="Navybean">0</xf>
          <ll name="Peanut">0.47</ll>
          <kl name="Peanut">0</kl>
          <xf name="Peanut">0</xf>
          <ll name="Pigeonpea">0.47</ll>
          <kl name="Pigeonpea">0</kl>
          <xf name="Pigeonpea">0</xf>
          <ll name="Soybean">0.47</ll>
          <kl name="Soybean">0</kl>
          <xf name="Soybean">0</xf>
          <ll name="Stylo">0.47</ll>
          <kl name="Stylo">0</kl>
          <xf name="Stylo">0</xf>
          <ll name="Sugar">0.47</ll>
          <kl name="Sugar">0</kl>
          <xf name="Sugar">0</xf>
          <ll name="Sunflower">0.47</ll>
          <kl name="Sunflower">0</kl>
          <xf name="Sunflower">0</xf>
          <ll name="Lablab">0.47</ll>
          <kl name="Lablab">0</kl>
          <xf name="Lablab">0</xf>
          <ll name="Cotton">0.47</ll>
          <kl name="Cotton">0</kl>
          <xf name="Cotton">0</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.2</bd>
          <ll15>0.35</ll15>
          <airdry>0.35</airdry>
          <dul>0.46</dul>
          <sat>0.51</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.13</oc>
          <ph>8.9</ph>
          <ec>1.05</ec>
          <ll name="wheat">0.46</ll>
          <kl name="wheat">0</kl>
          <xf name="wheat">0</xf>
          <ll name="barley">0.46</ll>
          <kl name="barley">0</kl>
          <xf name="barley">0</xf>
          <ll name="canola">0.46</ll>
          <kl name="canola">0</kl>
          <xf name="canola">0</xf>
          <ll name="Chickpea">0.46</ll>
          <kl name="Chickpea">0</kl>
          <xf name="Chickpea">0</xf>
          <ll name="Lucerne">0.35</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.46</ll>
          <kl name="Maize">0</kl>
          <xf name="Maize">0</xf>
          <ll name="Perennial Grass">0.4</ll>
          <kl name="Perennial Grass">0</kl>
          <xf name="Perennial Grass">0</xf>
          <ll name="Sorghum">0.46</ll>
          <kl name="Sorghum">0</kl>
          <xf name="Sorghum">0</xf>
          <ll name="Cowpea">0.46</ll>
          <kl name="Cowpea">0</kl>
          <xf name="Cowpea">0</xf>
          <ll name="Fababean">0.46</ll>
          <kl name="Fababean">0</kl>
          <xf name="Fababean">0</xf>
          <ll name="Mungbean">0.46</ll>
          <kl name="Mungbean">0</kl>
          <xf name="Mungbean">0</xf>
          <ll name="Navybean">0.46</ll>
          <kl name="Navybean">0</kl>
          <xf name="Navybean">0</xf>
          <ll name="Peanut">0.46</ll>
          <kl name="Peanut">0</kl>
          <xf name="Peanut">0</xf>
          <ll name="Pigeonpea">0.46</ll>
          <kl name="Pigeonpea">0</kl>
          <xf name="Pigeonpea">0</xf>
          <ll name="Soybean">0.46</ll>
          <kl name="Soybean">0</kl>
          <xf name="Soybean">0</xf>
          <ll name="Stylo">0.46</ll>
          <kl name="Stylo">0</kl>
          <xf name="Stylo">0</xf>
          <ll name="Sugar">0.46</ll>
          <kl name="Sugar">0</kl>
          <xf name="Sugar">0</xf>
          <ll name="Sunflower">0.46</ll>
          <kl name="Sunflower">0</kl>
          <xf name="Sunflower">0</xf>
          <ll name="Lablab">0.46</ll>
          <kl name="Lablab">0</kl>
          <xf name="Lablab">0</xf>
          <ll name="Cotton">0.46</ll>
          <kl name="Cotton">0</kl>
          <xf name="Cotton">0</xf>
        </layer>
        <layer>
          <thickness>300</thickness>
          <bd>1.25</bd>
          <ll15>0.36</ll15>
          <airdry>0.36</airdry>
          <dul>0.44</dul>
          <sat>0.49</sat>
          <swcon>0.3</swcon>
          <fbiom>0.01</fbiom>
          <finert>0.95</finert>
          <oc>0.12</oc>
          <ph>8.9</ph>
          <ec>1.01</ec>
          <ll name="wheat">0.44</ll>
          <kl name="wheat">0</kl>
          <xf name="wheat">0</xf>
          <ll name="barley">0.44</ll>
          <kl name="barley">0</kl>
          <xf name="barley">0</xf>
          <ll name="canola">0.44</ll>
          <kl name="canola">0</kl>
          <xf name="canola">0</xf>
          <ll name="Chickpea">0.44</ll>
          <kl name="Chickpea">0</kl>
          <xf name="Chickpea">0</xf>
          <ll name="Lucerne">0.36</ll>
          <kl name="Lucerne">0.09</kl>
          <xf name="Lucerne">1</xf>
          <ll name="Maize">0.44</ll>
          <kl name="Maize">0</kl>
          <xf name="Maize">0</xf>
          <ll name="Perennial Grass">0.42</ll>
          <kl name="Perennial Grass">0</kl>
          <xf name="Perennial Grass">0</xf>
          <ll name="Sorghum">0.44</ll>
          <kl name="Sorghum">0</kl>
          <xf name="Sorghum">0</xf>
          <ll name="Cowpea">0.44</ll>
          <kl name="Cowpea">0</kl>
          <xf name="Cowpea">0</xf>
          <ll name="Fababean">0.44</ll>
          <kl name="Fababean">0</kl>
          <xf name="Fababean">0</xf>
          <ll name="Mungbean">0.44</ll>
          <kl name="Mungbean">0</kl>
          <xf name="Mungbean">0</xf>
          <ll name="Navybean">0.44</ll>
          <kl name="Navybean">0</kl>
          <xf name="Navybean">0</xf>
          <ll name="Peanut">0.44</ll>
          <kl name="Peanut">0</kl>
          <xf name="Peanut">0</xf>
          <ll name="Pigeonpea">0.44</ll>
          <kl name="Pigeonpea">0</kl>
          <xf name="Pigeonpea">0</xf>
          <ll name="Soybean">0.44</ll>
          <kl name="Soybean">0</kl>
          <xf name="Soybean">0</xf>
          <ll name="Stylo">0.44</ll>
          <kl name="Stylo">0</kl>
          <xf name="Stylo">0</xf>
          <ll name="Sugar">0.44</ll>
          <kl name="Sugar">0</kl>
          <xf name="Sugar">0</xf>
          <ll name="Sunflower">0.44</ll>
          <kl name="Sunflower">0</kl>
          <xf name="Sunflower">0</xf>
          <ll name="Lablab">0.44</ll>
          <kl name="Lablab">0</kl>
          <xf name="Lablab">0</xf>
          <ll name="Cotton">0.44</ll>
          <kl name="Cotton">0</kl>
          <xf name="Cotton">0</xf>
        </layer>
      </profile>
      <U>6</U>
      <Cona>3.5</Cona>
      <Salb>0.13</Salb>
      <DiffusConst>40</DiffusConst>
      <DiffusSlope>16</DiffusSlope>
      <CN2Bare>73</CN2Bare>
      <CNRed>20</CNRed>
      <CNCov>0.8</CNCov>
      <RootCN>40</RootCN>
      <RootWT>200</RootWT>
      <SoilCN>12.5</SoilCN>
      <EnrACoeff>7.4</EnrACoeff>
      <EnrBCoeff>0.2</EnrBCoeff>
      <WaterFormat>VolumetricPercent</WaterFormat>
      <InitWater>
        <profile>
          <layer>
            <sw>0.540</sw>
            <thickness>150</thickness>
          </layer>
          <layer>
            <sw>0.530</sw>
            <thickness>150</thickness>
          </layer>
          <layer>
            <sw>0.540</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.540</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.520</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.500</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.500</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.480</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.470</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.460</sw>
            <thickness>300</thickness>
          </layer>
          <layer>
            <sw>0.440</sw>
            <thickness>300</thickness>
          </layer>
        </profile>
      </InitWater>
      <InitNitrogen>
        <profile>
          <layer>
            <no3>6.500</no3>
            <nh4>0.600</nh4>
            <thickness>150</thickness>
          </layer>
          <layer>
            <no3>2.100</no3>
            <nh4>0.100</nh4>
            <thickness>150</thickness>
          </layer>
          <layer>
            <no3>2.100</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
          <layer>
            <no3>1.700</no3>
            <nh4>0.100</nh4>
            <thickness>300</thickness>
          </layer>
        </profile>
      </InitNitrogen>
    </soil>
  </simulation>
  <simulation name="Continuous Maize Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/06/1995</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">1/05/2000</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Maize Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">C:\Program Files\Apsim51\apsim\met\sample\hre.met</filename>
    </metfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Harvesting rule for intercropping">
          <condition name="init">
          crop_to_harvest = 'nil'
      </condition>
          <condition name="end_of_day">
         if (crop_to_harvest = '[crop]') then
            [crop] harvest, remove=[fraction_to_remove]
            [crop] kill_crop
            [crop] end_crop
                  crop_in = crop_in - 1
            crop_to_harvest = 'nil'
            fert_tot = 0
            sow_year = 0
            if (crop_current = '[crop]') then
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current1 = '[crop]') then
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current2 = '[crop]') then
               crop_current2 = blank
            endif
         endif

         if ([crop].stage_name = 'harvest_ripe' OR [crop].plant_status = 'dead') then
            crop_to_harvest = '[crop]'
         endif
         </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">maize</crop>
            <fraction_to_remove type="text" description="Enter fraction of stover to remove : ">0.95</fraction_to_remove>
          </category>
        </rule>
        <rule name="Output at harvest for intercropping">
          <condition name="end_of_day">
         if (crop_to_harvest = '[crop]') then
            outputfile do_output
         endif
         </condition>
          <category name="Output criteria">
            <crop type="crop" description="Enter name of crop to output at harvest : ">maize</crop>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0
         </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
         </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop description="Name of this crop" type="crop">maize</crop>
            <cultivar1 description="Enter cultivar" type="cultivars" croppropertyname="crop">sc401</cultivar1>
            <cropmethod description="Method of cropping" type="list" listvalues="sole,intercrop">sole</cropmethod>
            <rotation_exclude description="Exclude from rotation sequence" type="yesno">no</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 description="Enter sowing window START date (dd-mmm)" type="ddmmmdate">1-nov</date1>
            <date2 description="Enter sowing window END date (dd-mmm)" type="ddmmmdate">30-dec</date2>
            <must_sow description="Must Sow" type="yesno">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">20</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">5</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">2.2</density>
            <depth description="Enter sowing depth  (mm)">100</depth>
            <row_spacing description="Enter row spacing  (mm) (m for maize)" type="text">0.9</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow description="Amount of starter fertiliser at sowing (kg/ha)" type="text">0</fert_amount_sow>
            <fert_type_sow description="Type" type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress description="Enter number of days after sowing to apply top-dress fertiliser (days)" type="text">35</fert_days_TopDress>
            <fert_amount_TopDress description="Amount of TopDress fertiliser (kg/ha)" type="text">27</fert_amount_TopDress>
            <fert_type_TopDress description="Type" type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" moduletype="surfaceom" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow description="Enter number of days before window to apply pre-crop manure (days)" type="text">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" moduletype="surfaceom" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type description="Planter type" type="list" listvalues="user_defined, planter">user_defined</planter_type>
            <planter_depth description="User_defined depth of seedbed preparation (mm)" type="text">150</planter_depth>
            <thin_fraction description="Enter fraction of weed population killed (0-1)" type="text">1.0</thin_fraction>
            <planter_f_incorp description="User_defined fraction of surface residues to incorporate (0-1)" type="text">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Remove all residues on a fixed date">
          <condition name="start_of_day">
         if today = date('[date]') then
            '[surfaceommodule]' tillage type = user_defined, f_incorp = 1.0 (), tillage_depth = 0.0 ()
         endif
         </condition>
          <category name="Removal criteria">
            <date description="Date to remove residues (dd-mmm) :" type="ddmmmdate">1-may</date>
            <surfaceommodule type="modulename" moduletype="surfaceom" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type description="Organic Matter type">wheat</type>
        <mass description="Initial surface residue (kg/ha)">0</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <filename name="filename">Continuous Maize Simulation.out</filename>
        <variables name="My Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="esw" description="Extractable Soil Water (mm)" VariableType="Water" array="?" />
          <variable name="day" description="Day" array="?" />
          <variable name="year" description="Year" array="?" />
          <variable name="maize.yield" description="Maize Yield (kg/ha)" array="?" />
          <variable name="maize.stover" description="Maize Stover (kg/ha)" array="?" />
          <variable name="maize.biomass" description="Maize Total Above Ground Biomass (kg/ha)" array="?" />
        </variables>
        <events name="My Variables Events" />
      </outputfile>
      <maize />
      <soil name="Zimbabwe Fertile Luvisol (187mm PAWC)">
        <profile>
          <layer>
            <thickness>100</thickness>
            <ll15>0.11</ll15>
            <airdry>0.04</airdry>
            <dul>0.22</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.11</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.11</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.11</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.11</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.11</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.11</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.11</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1.2</oc>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.14</ll15>
            <airdry>0.14</airdry>
            <dul>0.25</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.14</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.14</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.14</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.14</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.14</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.14</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.14</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1</oc>
            <fbiom>0.01</fbiom>
            <finert>0.65</finert>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.16</ll15>
            <airdry>0.15</airdry>
            <dul>0.27</dul>
            <sat>0.32</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.16</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.16</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.16</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.16</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.16</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.16</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.16</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>0.86</oc>
            <fbiom>0.01</fbiom>
            <finert>0.7</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.17</ll15>
            <airdry>0.16</airdry>
            <dul>0.28</dul>
            <sat>0.33</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6.2</ph>
            <oc>0.83</oc>
            <fbiom>0.01</fbiom>
            <finert>0.75</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.19</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.34</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.19</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.19</ll>
            <kl name="cowpea">0.06</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.19</ll>
            <kl name="maize">0.06</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.19</ll>
            <kl name="mucuna">0.06</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.19</ll>
            <kl name="peanut">0.06</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.19</ll>
            <kl name="pigeonp">0.06</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.19</ll>
            <kl name="soybean">0.06</kl>
            <xf name="soybean">1</xf>
            <ph>6.5</ph>
            <oc>0.58</oc>
            <fbiom>0.01</fbiom>
            <finert>0.8</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.35</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.04</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.04</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.04</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.04</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.04</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.04</kl>
            <xf name="soybean">1</xf>
            <ph>6.7</ph>
            <oc>0.54</oc>
            <fbiom>0.01</fbiom>
            <finert>0.85</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.36</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.03</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.03</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.03</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.03</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.03</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.03</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.47</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.32</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.02</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.02</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.02</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.02</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.02</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.02</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
          </layer>
        </profile>
        <Cona>2.5</Cona>
        <U>9</U>
        <CN2Bare>75</CN2Bare>
        <Salb>0.13</Salb>
        <DiffusConst>88</DiffusConst>
        <DiffusSlope>35.4</DiffusSlope>
        <CNRed>20</CNRed>
        <CNCov>0.8</CNCov>
        <RootCN>45</RootCN>
        <RootWT>1000</RootWT>
        <SoilCN>14.5</SoilCN>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>0.237</no3>
              <nh4>0.194</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.484</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.290</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.554</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.158</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.079</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
          </profile>
        </InitNitrogen>
        <InitWater>
          <PercentMethod>
            <Percent>0.00</Percent>
            <Distributed>Filled from top</Distributed>
          </PercentMethod>
        </InitWater>
      </soil>
    </area>
  </simulation>
  <simulation name="Continuous Maize and Weeds Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date" lbound="2/11/1961" ubound="31/01/2001">1/06/1995</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date" lbound="2/11/1961" ubound="31/01/2001">1/05/2000</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Maize and Weeds Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">C:\Program Files\Apsim51\apsim\met\sample\hre.met</filename>
    </metfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Harvesting rule for intercropping">
          <condition name="init">
          [crop]_to_harvest = 0
      </condition>
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            [crop] harvest, remove=[fraction_to_remove]
            [crop] kill_crop
            [crop] end_crop
                  crop_in = crop_in - 1
            [crop]_to_harvest = 0
            fert_tot = 0
            sow_year = 0
            if (crop_current = '[crop]') then
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current1 = '[crop]') then
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current2 = '[crop]') then
               crop_current2 = blank
            endif
         endif

         if ([crop].stage_name = 'harvest_ripe' OR [crop].plant_status = 'dead') then
            [crop]_to_harvest = 1
         endif
      </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">maize</crop>
            <fraction_to_remove type="text" description="Enter fraction of stover to remove : ">0.95</fraction_to_remove>
          </category>
        </rule>
        <rule name="Output at harvest for intercropping">
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            outputfile do_output
         endif
      </condition>
          <category name="Output criteria">
            <crop type="crop" description="Enter name of crop to output at harvest : ">maize</crop>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
            </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">maize</crop>
            <cultivar1 type="cultivars" croppropertyname="crop" description="Enter cultivar">sc401</cultivar1>
            <cropmethod type="list" listvalues="sole,intercrop" description="Method of cropping">intercrop</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">yes</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">1-nov</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">30-dec</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">20</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">5</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">2.2</density>
            <depth description="Enter sowing depth  (mm)">100</depth>
            <row_spacing type="text" description="Enter row spacing  (mm) (m for maize)">0.9</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha)">0</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress type="text" description="Enter number of days after sowing to apply top-dress fertiliser (days)">35</fert_days_TopDress>
            <fert_amount_TopDress type="text" description="Amount of TopDress fertiliser (kg/ha)">27</fert_amount_TopDress>
            <fert_type_TopDress type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow type="text" description="Enter number of days before window to apply pre-crop manure (days)">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type type="list" listvalues="user_defined, planter" description="Planter type">user_defined</planter_type>
            <planter_depth type="text" description="User_defined depth of seedbed preparation (mm)">150</planter_depth>
            <thin_fraction type="text" description="Enter fraction of weed population killed (0-1)">1.0</thin_fraction>
            <planter_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Sow WEEDS using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_fert_pre_sow = 0
         days_last_year = 365
         fert_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="process"><![CDATA[
               if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then


                  if (today = date('[date2]')) then
                     if ('[rotation_exclude]' = 'no') then
                        ready_for_next = 1
                     endif
                  endif

                  if (wd_sow_opp_num > 0) then
                     wd_sow_opp_days = wd_sow_opp_days + 1
                  else
                  endif

                  if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
                      AND weed.plant_status = 'out')
                      AND days_after_weed_kill > 0) then
                        if (date_within('[date1], [date2]') = 1) then
                           crop_sow = 'waiting'
                           surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                           if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                                 (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                               ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                              if (wd_sow_opp_days >= [rain_days] OR wd_sow_opp_num = 0) then
                                 wd_sow_opp_num = wd_sow_opp_num + 1
                                 wd_sow_opp_days = 0
                              endif

                              if ((wd_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                                 if (date_within('[date1], [date_ch1]') = 1) then
                                    weed sow crop_class = [cla], plants = [density] (plants/m2), sowing_depth = [depth], cultivar = [cultivar1], row_spacing = [row_spacing]
                                 else
                                    weed sow crop_class = [cla], plants = [density] (plants/m2), sowing_depth = [depth], cultivar = [cultivar2], row_spacing = [row_spacing]
                                 endif
                                 crop_in = crop_in + 1
                                 if ('[rotation_exclude]' = 'no') then
                                    ready_for_next = 1
                                 endif
                                 crop_current2 = crop_current1
                                 crop_current1 = crop_current
                                 crop_current = '[crop]'
                                 crop_sow = '[crop]'
                              else
                                 !not this opportunity
                              endif
                        endif
                     endif
                  endif
               endif
                           ]]></condition>
          <condition name="end_of_day"><![CDATA[

               days_after_weed_kill = days_after_weed_kill + 1

               if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
                  !   Tillage - presowing seedbed preparation
                  if ( [till_days_pre_sow] > 0) then
                     ! calculate presowing tillage date
                     till_day_pre_sow = date('[date1]') - [till_days_pre_sow]
                     ! Need to correct for possible year boundary condition
                     if (till_day_pre_sow < today) then
                        till_day_pre_sow = days_this_year + till_day_pre_sow
                     endif
                     if (today = till_day_pre_sow) then
                        ready_to_till_pre_sow = 1
                     endif
                     if ((crop_in = 0 OR '[must_till]' = 'yes') AND (ready_to_till_pre_sow = 1)) then
                        ! tillage
                        if (weed.plant_status <> 'out') then
                           weed harvest, remove=[fraction]
                           weed kill_crop
                           weed end_crop
                           crop_in = crop_in - 1
                          if (crop_current = 'weed') then
                              crop_current = crop_current1
                              crop_current1 = crop_current2
                              crop_current2 = blank
                           elseif (crop_current1 = 'weed') then
                              crop_current1 = crop_current2
                              crop_current2 = blank
                           elseif (crop_current2 = 'weed') then
                              crop_current2 = blank
                           endif
                        endif
                     endif
                  endif
               endif


               if (date_within('[date1], [date2]') = 1) THEN
               else
                  wd_sow_opp_num = 0
                  wd_sow_opp_days = 0
               endif

            ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">weed</crop>
            <cultivar1 type="list" listvalues="late, early" description="Enter first type"> early</cultivar1>
            <cla type="list" listvalues="winter_grass, winter_dicot, summer_grass, perennial_legume" description="Enter class type "> summer_grass</cla>
            <date_ch1 type="ddmmmdate" description="Enter type change date (dd-mmm)">1-jul</date_ch1>
            <cultivar2 type="list" listvalues="late, early" description="Enter second type">late</cultivar2>
            <cropmethod type="list" listvalues="sole, intercrop" description="Method of cropping">intercrop</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">yes</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">01-oct</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">30-apr</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount type="text" description="Enter amount of rainfall (mm)">10</rain_amount>
            <rain_days type="text" description="Enter number of days of rainfall (days)">5</rain_days>
            <esw_amount type="text" description="Enter amount of soil water (mm)">5</esw_amount>
            <sow_opp type="text" description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up type="text" description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low type="text" description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density type="text" description="Enter sowing density  (plants/m2)">5</density>
            <depth type="text" description="Enter sowing depth  (mm)">15</depth>
            <row_spacing type="text" description="Enter row spacing  (mm)">350</row_spacing>
          </category>
          <category name="Seed-bed Tillage Preparation">
            <till_days_pre_sow type="text" description="Enter number of days before window to prepare seed-bed (days)">0</till_days_pre_sow>
            <must_till type="yesno" description="Must Till">no</must_till>
            <tillage_type type="list" listvalues="user_defined, chisel, disc, planter,burn, burn_90, graze, scarifier, rip, blade, tine" description="Tillage type">disc</tillage_type>
            <tillage_depth type="text" description="User_defined depth of seedbed preparation (mm)">100</tillage_depth>
            <tillage_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</tillage_f_incorp>
            <fraction type="text" description="Enter biomass removal fraction of growing weeds from field (0-1)">0.0</fraction>
          </category>
        </rule>
        <rule name="Weeding at threshold weed biomass or maximum days">
          <condition name="init">
          daemerge = 0
      </condition>
          <condition name="end_of_day"><![CDATA[
         if ((crop_in >= 1)
            AND (weed.plant_status <> 'out')) then
            if (weed.stage >= 3.0) then
               daemerge = daemerge + 1
            endif

            if (weed.biomass > [weed_biomass] OR daemerge >= [weed_interval]) then
               if ((crop_in > 1 AND [weed_maxno_in] > weed_count_in) OR (crop_in = 1 AND [weed_maxno_out] > weed_count_out)) then
                  if (crop_in > 1) then
                     weed_count_in = weed_count_in + 1
                  elseif (crop_in = 1) then
                     weed_count_out = weed_count_out + 1
                  endif
                  weed harvest, remove = [fraction]
                  weed kill_crop plants_kill_fraction = [thin_fraction]
                  if ([thin_fraction] = 1.0) then
                     weed end_crop
                     days_after_weed_kill = 0
                 else
                  endif
                  '[surfaceommodule]' tillage type = [tillage_type], f_incorp = [f_incorp], tillage_depth = [tillage_depth]
                  if ([thin_fraction] = 1.0) then
                    crop_in = crop_in - 1
                    if (crop_current = 'weed') then
                        crop_current = crop_current1
                        crop_current1 = crop_current2
                        crop_current2 = blank
                     elseif (crop_current1 = 'weed') then
                        crop_current1 = crop_current2
                        crop_current2 = blank
                     elseif (crop_current2 = 'weed') then
                        crop_current2 = blank
                     endif
                     daemerge = 0
                  else
                  endif
               else
               endif
            else
            endif
         else
            daemerge = 0
         endif

         if (((crop_in = 1)
            AND (weed.plant_status <> 'out'))
            OR (crop_in = 0)) then
            weed_count_in = 0
         else
            weed_count_out = 0
         endif
      ]]></condition>
          <category name="Weeding properties">
            <weed_interval type="text" description="Maximum days after emergence to weed (days) : ">35</weed_interval>
            <weed_biomass type="text" description="Weeding biomass threshold to weed (kg/ha) : ">5000</weed_biomass>
            <weed_maxno_in type="text" description="Maximum number of in-crop weedings (1..n) : ">1</weed_maxno_in>
            <weed_maxno_out type="text" description="Maximum number of fallow weedings (1..n) : ">0</weed_maxno_out>
            <thin_fraction type="text" description="Enter fraction of weed population weeded (0-1) : ">1.0</thin_fraction>
            <fraction type="text" description="Enter biomass removal fraction from field (0-1) : ">0.0</fraction>
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <tillage_type type="text" description="Enter name of tillage type : ">user_defined</tillage_type>
            <f_incorp type="text" description="Enter fraction of surface residues incorporated into soil (0-1) : ">0.1</f_incorp>
            <tillage_depth type="text" description="Enter depth of incorporation of surface residues (mm) : ">25</tillage_depth>
          </category>
        </rule>
        <rule name="Remove all residues on a fixed date">
          <condition name="start_of_day">
         if today = date('[date]') then
            '[surfaceommodule]' tillage type = user_defined, f_incorp = 0.95 (), tillage_depth = 0.0 ()
         endif
            </condition>
          <category name="Removal criteria">
            <date type="ddmmmdate" description="Date to remove residues (dd-mmm) :">08-may</date>
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">surface organic matter</surfaceommodule>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type description="Organic Matter type">wheat</type>
        <mass description="Initial surface residue (kg/ha)">0</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <filename name="filename">Continuous Maize and Weeds Simulation.out</filename>
        <variables name="My Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="Zimbabwe Fertile Luvisol (187mm PAWC) Water.esw" description="Extractable Soil Water (mm)" array="?" />
          <variable name="day" description="Day" array="?" />
          <variable name="year" description="Year" array="?" />
          <variable name="maize.yield" description="Maize Yield (kg/ha)" array="?" />
          <variable name="maize.stover" description="Maize Stover (kg/ha)" array="?" />
          <variable name="maize.biomass" description="Maize Total Above Ground Biomass (kg/ha)" array="?" />
          <variable name="weed.biomass" description="Biomass" array="No" />
        </variables>
        <events name="My Variables Events" />
      </outputfile>
      <maize />
      <weed />
      <canopy name="Canopy">
        <intercrop name="intercrop" description="Enter crop names to intercrop" type="text">maize weed</intercrop>
      </canopy>
      <soil name="Zimbabwe Fertile Luvisol (187mm PAWC)">
        <profile>
          <layer>
            <thickness>100</thickness>
            <ll15>0.11</ll15>
            <airdry>0.04</airdry>
            <dul>0.22</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.11</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.11</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.11</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.11</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.11</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.11</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.11</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1.2</oc>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <ll name="weed">0.11</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.14</ll15>
            <airdry>0.14</airdry>
            <dul>0.25</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.14</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.14</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.14</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.14</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.14</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.14</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.14</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1</oc>
            <fbiom>0.01</fbiom>
            <finert>0.65</finert>
            <ll name="weed">0.14</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.16</ll15>
            <airdry>0.15</airdry>
            <dul>0.27</dul>
            <sat>0.32</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.16</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.16</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.16</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.16</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.16</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.16</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.16</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>0.86</oc>
            <fbiom>0.01</fbiom>
            <finert>0.7</finert>
            <ll name="weed">0.16</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.17</ll15>
            <airdry>0.16</airdry>
            <dul>0.28</dul>
            <sat>0.33</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6.2</ph>
            <oc>0.83</oc>
            <fbiom>0.01</fbiom>
            <finert>0.75</finert>
            <ll name="weed">0.17</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.19</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.34</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.19</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.19</ll>
            <kl name="cowpea">0.06</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.19</ll>
            <kl name="maize">0.06</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.19</ll>
            <kl name="mucuna">0.06</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.19</ll>
            <kl name="peanut">0.06</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.19</ll>
            <kl name="pigeonp">0.06</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.19</ll>
            <kl name="soybean">0.06</kl>
            <xf name="soybean">1</xf>
            <ph>6.5</ph>
            <oc>0.58</oc>
            <fbiom>0.01</fbiom>
            <finert>0.8</finert>
            <ll name="weed">0.19</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.35</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.04</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.04</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.04</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.04</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.04</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.04</kl>
            <xf name="soybean">1</xf>
            <ph>6.7</ph>
            <oc>0.54</oc>
            <fbiom>0.01</fbiom>
            <finert>0.85</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.36</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.03</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.03</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.03</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.03</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.03</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.03</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.47</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.32</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.02</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.02</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.02</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.02</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.02</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.02</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
        </profile>
        <Cona>2.5</Cona>
        <U>9</U>
        <CN2Bare>75</CN2Bare>
        <Salb>0.13</Salb>
        <DiffusConst>88</DiffusConst>
        <DiffusSlope>35.4</DiffusSlope>
        <CNRed>20</CNRed>
        <CNCov>0.8</CNCov>
        <RootCN>45</RootCN>
        <RootWT>1000</RootWT>
        <SoilCN>14.5</SoilCN>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>0.237</no3>
              <nh4>0.194</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.484</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.290</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.554</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.158</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.079</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
          </profile>
        </InitNitrogen>
        <InitWater>
          <PercentMethod>
            <Percent>0.00</Percent>
            <Distributed>Filled from top</Distributed>
          </PercentMethod>
        </InitWater>
        <WaterFormat>VolumetricPercent</WaterFormat>
      </soil>
    </area>
  </simulation>
  <simulation name="Continuous Maize Bimodal Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date">1/06/1995</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date">1/05/2000</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Continuous Maize Bimodal Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">C:\Program Files\Apsim51\apsim\met\sample\hre.met</filename>
    </metfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Harvesting rule for intercropping">
          <condition name="init">
          crop_to_harvest = 'nil'
      </condition>
          <condition name="end_of_day">
         if (crop_to_harvest = '[crop]') then
            [crop] harvest, remove=[fraction_to_remove]
            [crop] kill_crop
            [crop] end_crop
                  crop_in = crop_in - 1
            crop_to_harvest = 'nil'
            fert_tot = 0
            sow_year = 0
            if (crop_current = '[crop]') then
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current1 = '[crop]') then
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current2 = '[crop]') then
               crop_current2 = blank
            endif
         endif

         if ([crop].stage_name = 'harvest_ripe' OR [crop].plant_status = 'dead') then
            crop_to_harvest = '[crop]'
         endif
      </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">maize</crop>
            <fraction_to_remove type="text" description="Enter fraction of stover to remove : ">0.95</fraction_to_remove>
          </category>
        </rule>
        <rule name="Output at harvest for intercropping">
          <condition name="end_of_day">
         if (crop_to_harvest = '[crop]') then
            outputfile do_output
         endif
      </condition>
          <category name="Output criteria">
            <crop type="crop" description="Enter name of crop to output at harvest : ">maize</crop>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
            </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">maize</crop>
            <cultivar1 type="cultivars" croppropertyname="crop" description="Enter cultivar">katumani</cultivar1>
            <cropmethod type="list" listvalues="sole,intercrop" description="Method of cropping">sole</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">no</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">10-mar</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">01-may</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">40</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">8</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">2</density>
            <depth description="Enter sowing depth  (mm)">30</depth>
            <row_spacing type="text" description="Enter row spacing  (mm) (m for maize)">1</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha)">0</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress type="text" description="Enter number of days after sowing to apply top-dress fertiliser (days)">35</fert_days_TopDress>
            <fert_amount_TopDress type="text" description="Amount of TopDress fertiliser (kg/ha)">0</fert_amount_TopDress>
            <fert_type_TopDress type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow type="text" description="Enter number of days before window to apply pre-crop manure (days)">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type type="list" listvalues="user_defined, planter" description="Planter type">user_defined</planter_type>
            <planter_depth type="text" description="User_defined depth of seedbed preparation (mm)">150</planter_depth>
            <thin_fraction type="text" description="Enter fraction of weed population killed (0-1)">1.0</thin_fraction>
            <planter_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping{2}">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
            </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">maize</crop>
            <cultivar1 type="cultivars" croppropertyname="crop" description="Enter cultivar">katumani</cultivar1>
            <cropmethod type="list" listvalues="sole,intercrop" description="Method of cropping">sole</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">no</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">10-oct</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">20-nov</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">40</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">8</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">2</density>
            <depth description="Enter sowing depth  (mm)">30</depth>
            <row_spacing type="text" description="Enter row spacing  (mm) (m for maize)">1</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow description="Amount of starter fertiliser at sowing (kg/ha)" type="text">0</fert_amount_sow>
            <fert_type_sow description="Type" type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress description="Enter number of days after sowing to apply top-dress fertiliser (days)" type="text">35</fert_days_TopDress>
            <fert_amount_TopDress description="Amount of TopDress fertiliser (kg/ha)" type="text">27</fert_amount_TopDress>
            <fert_type_TopDress description="Type" type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" moduletype="surfaceom" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow description="Enter number of days before window to apply pre-crop manure (days)" type="text">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" moduletype="surfaceom" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type description="Planter type" type="list" listvalues="user_defined, planter">user_defined</planter_type>
            <planter_depth description="User_defined depth of seedbed preparation (mm)" type="text">150</planter_depth>
            <thin_fraction description="Enter fraction of weed population killed (0-1)" type="text">1.0</thin_fraction>
            <planter_f_incorp description="User_defined fraction of surface residues to incorporate (0-1)" type="text">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Remove all residues on a fixed date">
          <condition name="start_of_day">
         if today = date('[date]') then
            '[surfaceommodule]' tillage type = user_defined, f_incorp = 1.0 (), tillage_depth = 0.0 ()
         endif
            </condition>
          <category name="Removal criteria">
            <date type="ddmmmdate" description="Date to remove residues (dd-mmm) :">1-sep</date>
            <surfaceommodule type="modulename" moduletype="surfaceom" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
          </category>
        </rule>
        <rule name="Remove all residues on a fixed date{2}">
          <condition name="start_of_day">
         if today = date('[date]') then
            '[surfaceommodule]' tillage type = user_defined, f_incorp = 1.0 (), tillage_depth = 0.0 ()
         endif
            </condition>
          <category name="Removal criteria">
            <date type="ddmmmdate" description="Date to remove residues (dd-mmm) :">1-may</date>
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type description="Organic Matter type">wheat</type>
        <mass description="Initial surface residue (kg/ha)">0</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <filename name="filename">Continuous Maize Bimodal Simulation.out</filename>
        <variables name="My Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="Chromic Luvisol, Katumani Research Station (PAWC = 164mm) Water.esw" description="Extractable Soil Water (mm)" array="?" />
          <variable name="day" description="Day" array="?" />
          <variable name="year" description="Year" array="?" />
          <variable name="maize.yield" description="Maize Yield (kg/ha)" array="?" />
          <variable name="maize.stover" description="Maize Stover (kg/ha)" array="?" />
          <variable name="maize.biomass" description="Maize Total Above Ground Biomass (kg/ha)" array="?" />
          <variable name="maize.swdef_expan" description="Maize soil water factor for expansion" array="?" />
          <variable name="maize.swdef_photo" description="Maize soil water factor for photosynthesis" array="?" />
          <variable name="maize.nfact_expan" description="Maize Nitrogen factor for expansion" array="?" />
          <variable name="maize.nfact_photo" description="Maize Nitrogen factor for photosynthesis" array="?" />
          <variable name="maize.grain_no" description="Maize Grain number (g/m2)" array="?" />
          <variable name="Chromic Luvisol, Katumani Research Station (PAWC = 164mm) Nitrogen.no3()" description="NO3 - layered (kg/ha)" array="?" />
        </variables>
        <events name="My Variables Events" />
      </outputfile>
      <maize />
      <soil name="Chromic Luvisol, Katumani Research Station (PAWC = 164mm)">
        <profile>
          <layer>
            <thickness>150</thickness>
            <ll15>0.15</ll15>
            <airdry>0.11</airdry>
            <dul>0.28</dul>
            <sat>0.32</sat>
            <swcon>0.5</swcon>
            <bd>1.28</bd>
            <ll name="sorg">0.15</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.15</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.15</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.15</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.15</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.15</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.15</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>0.92</oc>
            <fbiom>0.02</fbiom>
            <finert>0.5</finert>
          </layer>
          <layer>
            <thickness>150</thickness>
            <ll15>0.15</ll15>
            <airdry>0.12</airdry>
            <dul>0.28</dul>
            <sat>0.32</sat>
            <swcon>0.5</swcon>
            <bd>1.27</bd>
            <ll name="sorg">0.15</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.15</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.15</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.15</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.15</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.15</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.15</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>0.77</oc>
            <fbiom>0.015</fbiom>
            <finert>0.75</finert>
          </layer>
          <layer>
            <thickness>300</thickness>
            <ll15>0.17</ll15>
            <airdry>0.17</airdry>
            <dul>0.285</dul>
            <sat>0.34</sat>
            <swcon>0.5</swcon>
            <bd>1.34</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6.2</ph>
            <oc>0.57</oc>
            <fbiom>0.01</fbiom>
            <finert>0.9</finert>
          </layer>
          <layer>
            <thickness>300</thickness>
            <ll15>0.17</ll15>
            <airdry>0.17</airdry>
            <dul>0.27</dul>
            <sat>0.33</sat>
            <swcon>0.3</swcon>
            <bd>1.33</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6.4</ph>
            <oc>0.46</oc>
            <fbiom>0.01</fbiom>
            <finert>0.99</finert>
          </layer>
          <layer>
            <thickness>300</thickness>
            <ll15>0.17</ll15>
            <airdry>0.17</airdry>
            <dul>0.27</dul>
            <sat>0.33</sat>
            <swcon>0.3</swcon>
            <bd>1.31</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.06</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.06</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.06</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.06</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.06</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.06</kl>
            <xf name="soybean">1</xf>
            <ph>6.5</ph>
            <oc>0.43</oc>
            <fbiom>0.01</fbiom>
            <finert>0.99</finert>
          </layer>
          <layer>
            <thickness>300</thickness>
            <ll15>0.17</ll15>
            <airdry>0.17</airdry>
            <dul>0.27</dul>
            <sat>0.33</sat>
            <swcon>0.3</swcon>
            <bd>1.31</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.04</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.04</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.04</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.04</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.04</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.04</kl>
            <xf name="soybean">1</xf>
            <ph>6.5</ph>
            <oc>0.29</oc>
            <fbiom>0.01</fbiom>
            <finert>0.99</finert>
          </layer>
        </profile>
        <Cona>5</Cona>
        <U>5</U>
        <CN2Bare>80</CN2Bare>
        <Salb>0.13</Salb>
        <DiffusConst>88</DiffusConst>
        <DiffusSlope>32</DiffusSlope>
        <CNRed>20</CNRed>
        <CNCov>0.8</CNCov>
        <InitWater>
          <PercentMethod>
            <Percent>0.25</Percent>
            <Distributed>Filled from top</Distributed>
          </PercentMethod>
        </InitWater>
        <RootCN>45</RootCN>
        <RootWT>400</RootWT>
        <SoilCN>10</SoilCN>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>2</no3>
              <nh4>1</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>1</nh4>
              <thickness>150</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>1</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.500</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.500</nh4>
              <thickness>300</thickness>
            </layer>
            <layer>
              <no3>1</no3>
              <nh4>0.500</nh4>
              <thickness>300</thickness>
            </layer>
          </profile>
        </InitNitrogen>
        <Phosphorus>
          <layer name="1">
            <LabileP>4</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>115</Sorption>
          </layer>
          <layer name="2">
            <LabileP>4</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>150</Sorption>
          </layer>
          <layer name="3">
            <LabileP>3</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>160</Sorption>
          </layer>
          <layer name="4">
            <LabileP>3</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>200</Sorption>
          </layer>
          <layer name="5">
            <LabileP>3</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>200</Sorption>
          </layer>
          <layer name="6">
            <LabileP>3</LabileP>
            <BandedP>0</BandedP>
            <RockP>0</RockP>
            <Sorption>200</Sorption>
          </layer>
          <ResidueCP>250</ResidueCP>
          <RootCP>200</RootCP>
          <RateDissolRock>0.2</RateDissolRock>
        </Phosphorus>
      </soil>
    </area>
  </simulation>
  <simulation name="Rotation Maize_Legume and Weeds Simulation">
    <clock name="clock">
      <start_date name="start_date" description="Select the start date of the simulation" type="date" lbound="2/11/1961" ubound="31/01/2001">1/05/1991</start_date>
      <end_date name="end_date" description="Select the end date of the simulation" type="date" lbound="2/11/1961" ubound="31/01/2001">1/05/2000</end_date>
    </clock>
    <summaryfile name="summaryfile">
      <filename name="filename">Rotation Maize_Legume and Weeds Simulation.sum</filename>
    </summaryfile>
    <metfile name="met">
      <filename name="filename">C:\Program Files\Apsim51\apsim\met\sample\hre.met</filename>
    </metfile>
    <area name="paddock">
      <registrations name="global" />
      <manager name="Manager">
        <rule name="Harvesting rule for intercropping">
          <condition name="init">
          [crop]_to_harvest = 0
      </condition>
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            [crop] harvest, remove=[fraction_to_remove]
            [crop] kill_crop
            [crop] end_crop
                  crop_in = crop_in - 1
            [crop]_to_harvest = 0
            fert_tot = 0
            sow_year = 0
            if (crop_current = '[crop]') then
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current1 = '[crop]') then
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current2 = '[crop]') then
               crop_current2 = blank
            endif
         endif

         if ([crop].stage_name = 'harvest_ripe' OR [crop].plant_status = 'dead') then
            [crop]_to_harvest = 1
         endif
      </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">maize</crop>
            <fraction_to_remove type="text" description="Enter fraction of stover to remove : ">0.95</fraction_to_remove>
          </category>
        </rule>
        <rule name="Output at harvest for intercropping">
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            outputfile do_output
         endif
      </condition>
          <category name="Output criteria">
            <crop type="crop" description="Enter name of crop to output at harvest : ">maize</crop>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
            </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">maize</crop>
            <cultivar1 type="cultivars" croppropertyname="crop" description="Enter cultivar">sc401</cultivar1>
            <cropmethod type="list" listvalues="sole,intercrop" description="Method of cropping">intercrop</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">no</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">1-nov</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">30-dec</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">20</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">5</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">2.2</density>
            <depth description="Enter sowing depth  (mm)">100</depth>
            <row_spacing type="text" description="Enter row spacing  (mm) (m for maize)">0.9</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha)">0</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress type="text" description="Enter number of days after sowing to apply top-dress fertiliser (days)">35</fert_days_TopDress>
            <fert_amount_TopDress type="text" description="Amount of TopDress fertiliser (kg/ha)">27</fert_amount_TopDress>
            <fert_type_TopDress type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow type="text" description="Enter number of days before window to apply pre-crop manure (days)">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type type="list" listvalues="user_defined, planter" description="Planter type">user_defined</planter_type>
            <planter_depth type="text" description="User_defined depth of seedbed preparation (mm)">150</planter_depth>
            <thin_fraction type="text" description="Enter fraction of weed population killed (0-1)">1.0</thin_fraction>
            <planter_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Remove all residues on a fixed date">
          <condition name="start_of_day">
         if today = date('[date]') then
            '[surfaceommodule]' tillage type = user_defined, f_incorp = 0.95 (), tillage_depth = 0.0 ()
         endif
            </condition>
          <category name="Removal criteria">
            <date type="ddmmmdate" description="Date to remove residues (dd-mmm) :">08-may</date>
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">surface organic matter</surfaceommodule>
          </category>
        </rule>
        <rule name="Sow using a variable rule with intercropping{2}">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_manure_pre_sow = 0
         days_last_year = 365
         manure_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="end_of_day">

         if (date_within('[date1], [date2]') = 1) THEN
         else
            wht_sow_opp_num = 0
            wht_sow_opp_days = 0
         endif
            </condition>
          <condition name="process"><![CDATA[

         if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
               !  Presowing  manure application

            if ([manure_amount_pre_sow] > 0) then
               !  calculate day to fertilise
               manure_day_pre_sow = date('[date1]') - [manure_days_pre_sow]
               ! Need to correct for possible year boundary condition
               if (manure_day_pre_sow < today) then
                  manure_day_pre_sow = days_this_year + manure_day_pre_sow
               endif
               if (today = manure_day_pre_sow) then
                  ready_to_manure_pre_sow = 1
               endif
               if (crop_in = 0 and ready_to_manure_pre_sow = 1) then
                        ! just put on a fixed amount of manure
                  '[surfaceommodule_pre_sow]' add_surfaceom type=[manure_type_pre_sow], name=[manure_type_pre_sow], mass=[manure_amount_pre_sow], cnr=[manure_cnr_pre_sow], cpr=[manure_cpr_pre_sow]
                  ready_to_manure_pre_sow = 0
                  manure_day_pre_sow = 0
               endif
            endif

            if (today = date('[date2]')) then
               if ('[rotation_exclude]' = 'no') then
                  ready_for_next = 1
               endif
            endif

            if (wht_sow_opp_num > 0) then
               wht_sow_opp_days = wht_sow_opp_days + 1
            else
            endif

         if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
             AND [crop].plant_status = 'out')) then
               if (date_within('[date1], [date2]') = 1) then
                  crop_sow = 'waiting'
                  surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                  if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                        (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                      ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                     if (wht_sow_opp_days >= [rain_days] OR wht_sow_opp_num = 0) then
                        wht_sow_opp_num = wht_sow_opp_num + 1
                        wht_sow_opp_days = 0
                     endif

                     if ((wht_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                          [crop] sow cultivar = [cultivar1], plants = [density] (plants/m2), sowing_depth = [depth], row_spacing = [row_spacing]
                        crop_in = crop_in + 1
                        if ('[rotation_exclude]' = 'no') then
                           ready_for_next = 1
                        endif
                        crop_current2 = crop_current1
                        crop_current1 = crop_current
                        crop_current = '[crop]'
                        crop_sow = '[crop]'
                        ready_to_manure_pre_sow = 0
                        if ([fert_amount_sow] > 0) then
                           fertiliser apply amount = [fert_amount_sow] (kg/ha), depth = 50 (mm), type = [fert_type_sow] ()
                        endif
                        !   Planter -
                        ! Planting
                        if (crop_current = 'weed' or crop_current1 = 'weed' or crop_current2 = 'weed') then
                           if (weed.plant_status <> 'out' AND [thin_fraction] > 0) then
                              weed kill_crop plants_kill_fraction = [thin_fraction]
                              if ([thin_fraction] = 1.0) then
                                 weed end_crop
                                 days_after_weed_kill = 0
                              else
                              endif
                              if ([thin_fraction] = 1.0) then
                                    crop_in = crop_in - 1
                                   if (crop_current = 'weed') then
                                       crop_current = crop_current1
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current1 = 'weed') then
                                       crop_current1 = crop_current2
                                       crop_current2 = blank
                                    elseif (crop_current2 = 'weed') then
                                       crop_current2 = blank
                                    endif
                              endif
                           endif
                        endif
                        if ('[planter_type]' = 'user_defined') then
                            '[surfaceommodule]' tillage type = [planter_type], f_incorp = [planter_f_incorp] (), tillage_depth = [planter_depth]
                        else
                            '[surfaceommodule]' tillage type = [planter_type] ()
                        endif


                     else
                        !not this opportunity
                     endif
                  endif
               endif
            endif
         endif
         ! apply topdress fertiliser
         if ([fert_amount_TopDress] > 0.0) then
            if ([crop].das = [fert_days_TopDress]) then
               fertiliser apply amount = [fert_amount_TopDress] (kg/ha), depth = 50 (mm), type = [fert_type_TopDress] ()
            else
            endif
         else
         endif
         ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">peanut</crop>
            <cultivar1 type="cultivars" croppropertyname="crop" description="Enter cultivar">early_bunch</cultivar1>
            <cropmethod type="list" listvalues="sole,intercrop" description="Method of cropping">intercrop</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">no</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">1-nov</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">30-dec</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount description="Enter amount of cumulative rainfall (mm)">30</rain_amount>
            <rain_days description="Enter number of days to accumulate rainfall (days)">5</rain_days>
            <esw_amount description="Enter amount of soil water (mm)">30</esw_amount>
            <sow_opp description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density description="Enter sowing density  (plants/m2)">11.1</density>
            <depth description="Enter sowing depth  (mm)">100</depth>
            <row_spacing type="text" description="Enter row spacing  (mm) (m for maize)">450</row_spacing>
          </category>
          <category name="Starter fertiliser application">
            <fert_amount_sow type="text" description="Amount of starter fertiliser at sowing (kg/ha)">0</fert_amount_sow>
            <fert_type_sow type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type">urea_N</fert_type_sow>
          </category>
          <category name="TopDress fertiliser application">
            <fert_days_TopDress type="text" description="Enter number of days after sowing to apply top-dress fertiliser (days)">35</fert_days_TopDress>
            <fert_amount_TopDress type="text" description="Amount of TopDress fertiliser (kg/ha)">0</fert_amount_TopDress>
            <fert_type_TopDress type="list" listvalues="NO3_N, NH4_N, NH4NO3, urea_N, urea_no3, urea" description="Type"> NH4NO3</fert_type_TopDress>
          </category>
          <category name="Pre-sowing manure application">
            <surfaceommodule_pre_sow type="modulename" description="Module used to apply the manure : ">Surface Organic Matter</surfaceommodule_pre_sow>
            <manure_days_pre_sow type="text" description="Enter number of days before window to apply pre-crop manure (days)">30</manure_days_pre_sow>
            <manure_amount_pre_sow type="text" description="Amount of manure to apply (kg/ha) : ">0</manure_amount_pre_sow>
            <manure_type_pre_sow type="list" listvalues="manure,fym,heap_uncov,heap_cov,pit,communal" description="manure type : ">manure</manure_type_pre_sow>
            <manure_cnr_pre_sow type="text" description="manure CNR : ">25</manure_cnr_pre_sow>
            <manure_cpr_pre_sow type="text" description="manure CPR : ">50</manure_cpr_pre_sow>
          </category>
          <category name="Planter Tillage">
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <planter_type type="list" listvalues="user_defined, planter" description="Planter type">user_defined</planter_type>
            <planter_depth type="text" description="User_defined depth of seedbed preparation (mm)">150</planter_depth>
            <thin_fraction type="text" description="Enter fraction of weed population killed (0-1)">1.0</thin_fraction>
            <planter_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</planter_f_incorp>
          </category>
        </rule>
        <rule name="Harvesting rule for intercropping{2}">
          <condition name="init">
          [crop]_to_harvest = 0
      </condition>
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            [crop] harvest, remove=[fraction_to_remove]
            [crop] kill_crop
            [crop] end_crop
                  crop_in = crop_in - 1
            [crop]_to_harvest = 0
            fert_tot = 0
            sow_year = 0
            if (crop_current = '[crop]') then
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current1 = '[crop]') then
               crop_current1 = crop_current2
               crop_current2 = blank
            elseif (crop_current2 = '[crop]') then
               crop_current2 = blank
            endif
         endif

         if ([crop].stage_name = 'harvest_ripe' OR [crop].plant_status = 'dead') then
            [crop]_to_harvest = 1
         endif
      </condition>
          <category name="Harvesting criteria">
            <crop type="crop" description="Enter name of crop to harvest when ripe : ">peanut</crop>
            <fraction_to_remove type="text" description="Enter fraction of stover to remove : ">0.95</fraction_to_remove>
          </category>
        </rule>
        <rule name="Output at harvest for intercropping{2}">
          <condition name="end_of_day">
         if ([crop]_to_harvest = 1) then
            outputfile do_output
         endif
      </condition>
          <category name="Output criteria">
            <crop type="crop" description="Enter name of crop to output at harvest : ">peanut</crop>
          </category>
        </rule>
        <rule name="Rotations with Intercrop">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_fert_pre_sow = 0
         days_last_year = 365
         fert_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="start_of_day">
         if (ready_for_next = 1) then
            if      (next = 1) THEN
               next_crop = '[crop01]'
               next = 2
            elseif      (next = 2) THEN
               next_crop = '[crop02]'
               next = 3
            elseif (next = 3) THEN
               next_crop = '[crop03]'
               next = 4
            elseif (next = 4) THEN
               next_crop = '[crop04]'
               next = 5
            elseif (next = 5) THEN
               next_crop = '[crop05]'
               next = 6
            elseif (next = 6) THEN
               next_crop = '[crop06]'
               next = 7
            elseif (next = 7) THEN
               next_crop = '[crop07]'
               next = 8
            elseif (next = 8) THEN
               next_crop = '[crop08]'
               next = 9
            elseif (next = 9) THEN
                  next_crop = '[crop09]'
                  next = 10
            elseif (next = 10) THEN
                  next_crop = '[crop10]'
                  next = 11
            elseif (next = 11) THEN
                  next_crop = '[crop11]'
                  next = 12
            elseif (next = 12) THEN
                  next_crop = '[crop12]'
                  next = 13
            elseif (next = 13) THEN
                  next_crop = '[crop13]'
                  next = 14
            elseif (next = 14) THEN
                  next_crop = '[crop14]'
                  next = 15
            elseif (next = 15) THEN
                  next_crop = '[crop15]'
                  next = 16
            elseif (next = 16) THEN
                  next_crop = '[crop16]'
                  next = 17
            elseif (next = 17) THEN
                  next_crop = '[crop17]'
                  next = 18
            elseif (next = 18) THEN
                  next_crop = '[crop18]'
                  next = 19
            elseif (next = 19) THEN
                  next_crop = '[crop19]'
                  next = 20
            elseif (next = 20) THEN
                  next_crop = '[crop20]'
                  next = 1
            endif
            if (next_crop = 'nil' OR next_crop = blank) THEN
               next_crop = '[crop01]'
               next = 2
            endif
            ready_for_next = 0
         endif

            ! treat fallow as a crop - its window starts when the other fallow finishes
            ! assume initiation (sowing) of fallow takes place when previous fallow finishes
            ! or when previous crop is harvested, whichever is the latest.
            ! Assume fallow finishes (harvested) at end of fallow date.

         if (next_crop = '[winterf_name]') then
               ! initiate (sow)
            if ((crop_in = 0)
              OR (crop_in = 1 AND (crop_current = 'weed' OR crop_current1 = 'weed' OR crop_current2 = 'weed'))) then
               if (date_within('[summerf_d2], [winterf_d2]') then
                  crop_in = crop_in + 1
                  ready_for_next = 1
                  crop_current2 = crop_current1
                  crop_current1 = crop_current
                  crop_current = '[winterf_name]'
                  crop_sow = '[winterf_name]'
                  ready_to_fert_pre_sow = 0
               endif
            endif

         elseif (next_crop = '[summerf_name]') then
              ! initiate (sow)
            if ((crop_in = 0)
              OR (crop_in = 1 AND (crop_current = 'weed' OR crop_current1 = 'weed' OR crop_current2 = 'weed'))) then
               if (date_within('[winterf_d2], [summerf_d2]') then
                  crop_in = crop_in + 1
                  ready_for_next = 1
                  crop_current2 = crop_current1
                  crop_current1 = crop_current
                  crop_current = '[summerf_name]'
                  crop_sow = '[summerf_name]'
                  ready_to_fert_pre_sow = 0
               endif
            endif
         endif

         if (crop_current = '[winterf_name]'
          OR crop_current1 = '[winterf_name]'
          OR crop_current2 = '[winterf_name]') then
               ! terminate (harvest)
            if (today = date('[winterf_d2]')+1) then
               crop_in = crop_in - 1
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            endif
         elseif (crop_current = '[summerf_name]'
              OR crop_current1 = '[summerf_name]'
              OR crop_current2 = '[summerf_name]') then
               ! terminate (harvest)
            if (today = date('[summerf_d2]')+1) then
               crop_in = crop_in - 1
               crop_current = crop_current1
               crop_current1 = crop_current2
               crop_current2 = blank
            endif
         endif

      </condition>
          <category name="Fallow properties">
            <summerf_name type="text" description="summer fallow name : ">sf</summerf_name>
            <summerf_d2 type="ddmmmdate" description="summer fallow END   (dd-mmm) : ">15-mar</summerf_d2>
            <winterf_name type="text" description="winter fallow name : ">wf</winterf_name>
            <winterf_d2 type="ddmmmdate" description="winter fallow END   (dd-mmm) : ">23-aug</winterf_d2>
          </category>
          <category name="Crop and fallow rotation sequence - finish with nil">
            <crop01 type="crop" description="1 : ">maize</crop01>
            <crop02 type="crop" description="2 : ">wf</crop02>
            <crop03 type="crop" description="3 : ">peanut</crop03>
            <crop04 type="crop" description="4 : ">wf </crop04>
            <crop05 type="crop" description="5 : ">nil</crop05>
            <crop06 type="crop" description="6 : ">wf </crop06>
            <crop07 type="crop" description="7 : ">sf </crop07>
            <crop08 type="crop" description="8 : ">wf </crop08>
            <crop09 type="crop" description="9 : ">sf </crop09>
            <crop10 type="crop" description="10 : ">wf  </crop10>
            <crop11 type="crop" description="11 : ">sf  </crop11>
            <crop12 type="crop" description="12 : ">wf  </crop12>
            <crop13 type="crop" description="13 : ">sf  </crop13>
            <crop14 type="crop" description="14 : ">wf  </crop14>
            <crop15 type="crop" description="15 : ">sf  </crop15>
            <crop16 type="crop" description="16 : ">wf  </crop16>
            <crop17 type="crop" description="17 : ">sf  </crop17>
            <crop18 type="crop" description="18 : ">wf  </crop18>
            <crop19 type="crop" description="19 : ">sf  </crop19>
            <crop20 type="crop" description="20 : ">wf  </crop20>
          </category>
        </rule>
        <rule name="Sow WEEDS using a variable rule with intercropping">
          <condition name="init">
         next = 1
         crop_in = 0
         blank = 'fallow'
         next_crop = blank
         crop_current = blank
         crop_current1 = blank
         crop_current2 = blank
         crop_sow = blank
         ready_for_next = 1
         ready_to_fert_pre_sow = 0
         days_last_year = 365
         fert_day_pre_sow = 0
         ready_to_till_pre_sow = 0
         till_day_pre_sow = 0
         days_after_weed_kill = 0

      </condition>
          <condition name="process"><![CDATA[
               if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then


                  if (today = date('[date2]')) then
                     if ('[rotation_exclude]' = 'no') then
                        ready_for_next = 1
                     endif
                  endif

                  if (wd_sow_opp_num > 0) then
                     wd_sow_opp_days = wd_sow_opp_days + 1
                  else
                  endif

                  if (crop_in = 0 OR ('[cropmethod]' = 'intercrop'
                      AND weed.plant_status = 'out')
                      AND days_after_weed_kill > 0) then
                        if (date_within('[date1], [date2]') = 1) then
                           crop_sow = 'waiting'
                           surface_moist = (sw(1) - ll15(1)) / (dul(1)- ll15(1))
                           if ((rain[[rain_days]] >= [rain_amount]  AND  esw >= [esw_amount] AND
                                 (surface_moist <= [surface_up] and surface_moist >= [surface_low])) OR
                               ('[must_sow]' = 'yes' AND today = date('[date2]'))) THEN


                              if (wd_sow_opp_days >= [rain_days] OR wd_sow_opp_num = 0) then
                                 wd_sow_opp_num = wd_sow_opp_num + 1
                                 wd_sow_opp_days = 0
                              endif

                              if ((wd_sow_opp_num >= [sow_opp]) OR ('[must_sow]' = 'yes' AND today = date('[date2]')) then
                                 if (date_within('[date1], [date_ch1]') = 1) then
                                    weed sow crop_class = [cla], plants = [density] (plants/m2), sowing_depth = [depth], cultivar = [cultivar1], row_spacing = [row_spacing]
                                 else
                                    weed sow crop_class = [cla], plants = [density] (plants/m2), sowing_depth = [depth], cultivar = [cultivar2], row_spacing = [row_spacing]
                                 endif
                                 crop_in = crop_in + 1
                                 if ('[rotation_exclude]' = 'no') then
                                    ready_for_next = 1
                                 endif
                                 crop_current2 = crop_current1
                                 crop_current1 = crop_current
                                 crop_current = '[crop]'
                                 crop_sow = '[crop]'
                              else
                                 !not this opportunity
                              endif
                        endif
                     endif
                  endif
               endif
                           ]]></condition>
          <condition name="end_of_day"><![CDATA[

               days_after_weed_kill = days_after_weed_kill + 1

               if (next_crop = '[crop]' OR next_crop = blank OR '[rotation_exclude]' = 'yes') then
                  !   Tillage - presowing seedbed preparation
                  if ( [till_days_pre_sow] > 0) then
                     ! calculate presowing tillage date
                     till_day_pre_sow = date('[date1]') - [till_days_pre_sow]
                     ! Need to correct for possible year boundary condition
                     if (till_day_pre_sow < today) then
                        till_day_pre_sow = days_this_year + till_day_pre_sow
                     endif
                     if (today = till_day_pre_sow) then
                        ready_to_till_pre_sow = 1
                     endif
                     if ((crop_in = 0 OR '[must_till]' = 'yes') AND (ready_to_till_pre_sow = 1)) then
                        ! tillage
                        if (weed.plant_status <> 'out') then
                           weed harvest, remove=[fraction]
                           weed kill_crop
                           weed end_crop
                           crop_in = crop_in - 1
                          if (crop_current = 'weed') then
                              crop_current = crop_current1
                              crop_current1 = crop_current2
                              crop_current2 = blank
                           elseif (crop_current1 = 'weed') then
                              crop_current1 = crop_current2
                              crop_current2 = blank
                           elseif (crop_current2 = 'weed') then
                              crop_current2 = blank
                           endif
                        endif
                     endif
                  endif
               endif


               if (date_within('[date1], [date2]') = 1) THEN
               else
                  wd_sow_opp_num = 0
                  wd_sow_opp_days = 0
               endif

            ]]></condition>
          <category name="Crop properties">
            <crop type="crop" description="Name of this crop">weed</crop>
            <cultivar1 type="list" listvalues="late, early" description="Enter first type"> early</cultivar1>
            <cla type="list" listvalues="winter_grass, winter_dicot, summer_grass, perennial_legume" description="Enter class type "> summer_grass</cla>
            <date_ch1 type="ddmmmdate" description="Enter type change date (dd-mmm)">1-jul</date_ch1>
            <cultivar2 type="list" listvalues="late, early" description="Enter second type">late</cultivar2>
            <cropmethod type="list" listvalues="sole, intercrop" description="Method of cropping">intercrop</cropmethod>
            <rotation_exclude type="yesno" description="Exclude from rotation sequence">yes</rotation_exclude>
          </category>
          <category name="Sowing criteria">
            <date1 type="ddmmmdate" description="Enter sowing window START date (dd-mmm)">01-oct</date1>
            <date2 type="ddmmmdate" description="Enter sowing window END date (dd-mmm)">30-apr</date2>
            <must_sow type="yesno" description="Must Sow">no</must_sow>
            <rain_amount type="text" description="Enter amount of rainfall (mm)">10</rain_amount>
            <rain_days type="text" description="Enter number of days of rainfall (days)">5</rain_days>
            <esw_amount type="text" description="Enter amount of soil water (mm)">5</esw_amount>
            <sow_opp type="text" description="Enter sowing opportunity number to sow on (1..n)">1</sow_opp>
            <surface_up type="text" description="Enter upper limit of sw in top layer (0-2) (mm esw/mm soil)">2</surface_up>
            <surface_low type="text" description="Enter lower limit of sw in top layer (0-1) (mm esw/mm soil)">0</surface_low>
          </category>
          <category name="Sowing specs">
            <density type="text" description="Enter sowing density  (plants/m2)">5</density>
            <depth type="text" description="Enter sowing depth  (mm)">15</depth>
            <row_spacing type="text" description="Enter row spacing  (mm)">350</row_spacing>
          </category>
          <category name="Seed-bed Tillage Preparation">
            <till_days_pre_sow type="text" description="Enter number of days before window to prepare seed-bed (days)">0</till_days_pre_sow>
            <must_till type="yesno" description="Must Till">no</must_till>
            <tillage_type type="list" listvalues="user_defined, chisel, disc, planter,burn, burn_90, graze, scarifier, rip, blade, tine" description="Tillage type">disc</tillage_type>
            <tillage_depth type="text" description="User_defined depth of seedbed preparation (mm)">100</tillage_depth>
            <tillage_f_incorp type="text" description="User_defined fraction of surface residues to incorporate (0-1)">1</tillage_f_incorp>
            <fraction type="text" description="Enter biomass removal fraction of growing weeds from field (0-1)">0.0</fraction>
          </category>
        </rule>
        <rule name="Weeding at threshold weed biomass or maximum days">
          <condition name="init">
          daemerge = 0
      </condition>
          <condition name="end_of_day"><![CDATA[
         if ((crop_in >= 1)
            AND (weed.plant_status <> 'out')) then
            if (weed.stage >= 3.0) then
               daemerge = daemerge + 1
            endif

            if (weed.biomass > [weed_biomass] OR daemerge >= [weed_interval]) then
               if ((crop_in > 1 AND [weed_maxno_in] > weed_count_in) OR (crop_in = 1 AND [weed_maxno_out] > weed_count_out)) then
                  if (crop_in > 1) then
                     weed_count_in = weed_count_in + 1
                  elseif (crop_in = 1) then
                     weed_count_out = weed_count_out + 1
                  endif
                  weed harvest, remove = [fraction]
                  weed kill_crop plants_kill_fraction = [thin_fraction]
                  if ([thin_fraction] = 1.0) then
                     weed end_crop
                     days_after_weed_kill = 0
                 else
                  endif
                  '[surfaceommodule]' tillage type = [tillage_type], f_incorp = [f_incorp], tillage_depth = [tillage_depth]
                  if ([thin_fraction] = 1.0) then
                    crop_in = crop_in - 1
                    if (crop_current = 'weed') then
                        crop_current = crop_current1
                        crop_current1 = crop_current2
                        crop_current2 = blank
                     elseif (crop_current1 = 'weed') then
                        crop_current1 = crop_current2
                        crop_current2 = blank
                     elseif (crop_current2 = 'weed') then
                        crop_current2 = blank
                     endif
                     daemerge = 0
                  else
                  endif
               else
               endif
            else
            endif
         else
            daemerge = 0
         endif

         if (((crop_in = 1)
            AND (weed.plant_status <> 'out'))
            OR (crop_in = 0)) then
            weed_count_in = 0
         else
            weed_count_out = 0
         endif
      ]]></condition>
          <category name="Weeding properties">
            <weed_interval type="text" description="Maximum days after emergence to weed (days) : ">35</weed_interval>
            <weed_biomass type="text" description="Weeding biomass threshold to weed (kg/ha) : ">5000</weed_biomass>
            <weed_maxno_in type="text" description="Maximum number of in-crop weedings (1..n) : ">1</weed_maxno_in>
            <weed_maxno_out type="text" description="Maximum number of fallow weedings (1..n) : ">0</weed_maxno_out>
            <thin_fraction type="text" description="Enter fraction of weed population weeded (0-1) : ">1.0</thin_fraction>
            <fraction type="text" description="Enter biomass removal fraction from field (0-1) : ">0.0</fraction>
            <surfaceommodule type="modulename" description="Module used to apply the tillage : ">Surface Organic Matter</surfaceommodule>
            <tillage_type type="text" description="Enter name of tillage type : ">user_defined</tillage_type>
            <f_incorp type="text" description="Enter fraction of surface residues incorporated into soil (0-1) : ">0.1</f_incorp>
            <tillage_depth type="text" description="Enter depth of incorporation of surface residues (mm) : ">25</tillage_depth>
          </category>
        </rule>
      </manager>
      <fertiliser name="fertiliser" />
      <surfaceom name="surface organic matter">
        <PoolName description="Organic Matter pool name">wheat</PoolName>
        <type description="Organic Matter type">wheat</type>
        <mass description="Initial surface residue (kg/ha)">0</mass>
        <cnr description="C:N ratio of initial residue">80.0</cnr>
        <standing_fraction description="Fraction of residue standing">0.0</standing_fraction>
      </surfaceom>
      <outputfile name="outputfile">
        <filename name="filename">Rotation Maize_Legume and Weeds Simulation.out</filename>
        <variables name="My Variables">
          <variable name="dd/mm/yyyy as Date" description="Date (dd/mm/yyyy)" array="?" />
          <variable name="esw" description="Extractable Soil Water (mm)" VariableType="Water" array="?" />
          <variable name="day" description="Day" array="?" />
          <variable name="year" description="Year" array="?" />
          <variable name="maize.yield as yield_mz" description="Maize Yield (kg/ha)" array="?" />
          <variable name="maize.stover as stover_mz" description="Maize Stover (kg/ha)" array="?" />
          <variable name="maize.biomass as biom_mz" description="Maize Total Above Ground Biomass (kg/ha)" array="?" />
          <variable name="surface organic matter.surfaceom_wt" description="Total mass of all surface organic materials" array="?" />
          <variable name="peanut.yield as yield_pnut" description="Yield" array="?" />
          <variable name="peanut.biomass as biomass_pnut" description="Biomass" array="?" />
          <variable name="Manager.crop_in" array="?" />
          <variable name="Manager.next_crop" array="?" />
          <variable name="Manager.ready_for_next" array="?" />
        </variables>
        <events name="My Variables Events" />
      </outputfile>
      <maize />
      <weed />
      <peanut />
      <canopy name="Canopy">
        <intercrop name="intercrop" description="Enter crop names to intercrop" type="text">maize peanut weed</intercrop>
      </canopy>
      <soil name="Zimbabwe Fertile Luvisol (187mm PAWC)">
        <profile>
          <layer>
            <thickness>100</thickness>
            <ll15>0.11</ll15>
            <airdry>0.04</airdry>
            <dul>0.22</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.11</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.11</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.11</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.11</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.11</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.11</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.11</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1.2</oc>
            <fbiom>0.02</fbiom>
            <finert>0.6</finert>
            <ll name="weed">0.11</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.14</ll15>
            <airdry>0.14</airdry>
            <dul>0.25</dul>
            <sat>0.3</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.14</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.14</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.14</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.14</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.14</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.14</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.14</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>1</oc>
            <fbiom>0.01</fbiom>
            <finert>0.65</finert>
            <ll name="weed">0.14</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>100</thickness>
            <ll15>0.16</ll15>
            <airdry>0.15</airdry>
            <dul>0.27</dul>
            <sat>0.32</sat>
            <swcon>0.5</swcon>
            <bd>1.35</bd>
            <ll name="sorg">0.16</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.16</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.16</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.16</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.16</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.16</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.16</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6</ph>
            <oc>0.86</oc>
            <fbiom>0.01</fbiom>
            <finert>0.7</finert>
            <ll name="weed">0.16</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.17</ll15>
            <airdry>0.16</airdry>
            <dul>0.28</dul>
            <sat>0.33</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.17</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.17</ll>
            <kl name="cowpea">0.08</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.17</ll>
            <kl name="maize">0.08</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.17</ll>
            <kl name="mucuna">0.08</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.17</ll>
            <kl name="peanut">0.08</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.17</ll>
            <kl name="pigeonp">0.08</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.17</ll>
            <kl name="soybean">0.08</kl>
            <xf name="soybean">1</xf>
            <ph>6.2</ph>
            <oc>0.83</oc>
            <fbiom>0.01</fbiom>
            <finert>0.75</finert>
            <ll name="weed">0.17</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.19</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.34</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.19</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.19</ll>
            <kl name="cowpea">0.06</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.19</ll>
            <kl name="maize">0.06</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.19</ll>
            <kl name="mucuna">0.06</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.19</ll>
            <kl name="peanut">0.06</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.19</ll>
            <kl name="pigeonp">0.06</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.19</ll>
            <kl name="soybean">0.06</kl>
            <xf name="soybean">1</xf>
            <ph>6.5</ph>
            <oc>0.58</oc>
            <fbiom>0.01</fbiom>
            <finert>0.8</finert>
            <ll name="weed">0.19</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.3</dul>
            <sat>0.35</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.07</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.04</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.04</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.04</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.04</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.04</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.04</kl>
            <xf name="soybean">1</xf>
            <ph>6.7</ph>
            <oc>0.54</oc>
            <fbiom>0.01</fbiom>
            <finert>0.85</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.07</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.36</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.03</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.03</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.03</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.03</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.03</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.03</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.47</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.32</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.02</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.02</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.02</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.02</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.02</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.02</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
          <layer>
            <thickness>200</thickness>
            <ll15>0.2</ll15>
            <airdry>0.18</airdry>
            <dul>0.31</dul>
            <sat>0.37</sat>
            <swcon>0.5</swcon>
            <bd>1.4</bd>
            <ll name="sorg">0.2</ll>
            <kl name="sorg">0.04</kl>
            <xf name="sorg">1</xf>
            <ll name="cowpea">0.2</ll>
            <kl name="cowpea">0.01</kl>
            <xf name="cowpea">1</xf>
            <ll name="maize">0.2</ll>
            <kl name="maize">0.01</kl>
            <xf name="maize">1</xf>
            <ll name="mucuna">0.2</ll>
            <kl name="mucuna">0.01</kl>
            <xf name="mucuna">1</xf>
            <ll name="peanut">0.2</ll>
            <kl name="peanut">0.01</kl>
            <xf name="peanut">1</xf>
            <ll name="pigeonp">0.2</ll>
            <kl name="pigeonp">0.01</kl>
            <xf name="pigeonp">1</xf>
            <ll name="soybean">0.2</ll>
            <kl name="soybean">0.01</kl>
            <xf name="soybean">1</xf>
            <ph>6.8</ph>
            <oc>0.5</oc>
            <fbiom>0.01</fbiom>
            <finert>0.93</finert>
            <ll name="weed">0.20</ll>
            <kl name="weed">0.04</kl>
            <xf name="weed">1.00</xf>
          </layer>
        </profile>
        <Cona>2.5</Cona>
        <U>9</U>
        <CN2Bare>75</CN2Bare>
        <Salb>0.13</Salb>
        <DiffusConst>88</DiffusConst>
        <DiffusSlope>35.4</DiffusSlope>
        <CNRed>20</CNRed>
        <CNCov>0.8</CNCov>
        <RootCN>45</RootCN>
        <RootWT>1000</RootWT>
        <SoilCN>14.5</SoilCN>
        <EnrACoeff>7.4</EnrACoeff>
        <EnrBCoeff>0.2</EnrBCoeff>
        <InitNitrogen>
          <profile>
            <layer>
              <no3>0.237</no3>
              <nh4>0.194</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.484</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.712</no3>
              <nh4>0.290</nh4>
              <thickness>100</thickness>
            </layer>
            <layer>
              <no3>0.554</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.395</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.237</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.158</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
            <layer>
              <no3>0.079</no3>
              <nh4>0.290</nh4>
              <thickness>200</thickness>
            </layer>
          </profile>
        </InitNitrogen>
        <InitWater>
          <PercentMethod>
            <Percent>0.00</Percent>
            <Distributed>Filled from top</Distributed>
          </PercentMethod>
        </InitWater>
        <WaterFormat>VolumetricPercent</WaterFormat>
      </soil>
    </area>
  </simulation>
</folder>