! Last Change:   JNGH/MJR         26 March 2003 -
!                    Externalisation of phenology after harvest -
!                     	When the crop is harvested, phenology is wound back to a previous stage.
!                          This has been externalised in a table in the ini file.
!                          The table used is defined by two keywords -  stage_code and stage_stem_reduction_harvest.
!                          This allows definition of a new stage to follow harvesting within any phenological stage.
!                    New Kill_stem manager action for severe frosting of perennials -
!                     	A new kill_stem manager action e.g. lucerne kill_stem.
!                          When this action is used, phenology is wound back using a new table specified in the ini file.
!                          The keywords are - stage_code and stage_stem_reduction_kill_stem.
!                          On this action, the regrowth class is read from the ini file, as for a harvest action.
!                    Interpolation of rue against phenological stage -
!                     	Rue is now interpolated from a table read from the ini file.
!                          The table is specified by the two keywords - x_stage_code_rue and  y_rue where y_rue is the rue
!                          at the corresponding stage in x_stage_code_rue. The previous rue keyword is now obsolete.
!                    A new optional cultivar parameter eo_crop_factor has been implemented. This is used to limit the
!                          soilwater demand by the transpiration efficiency method. The limit is calculated as
!                          eo_crop_factor * eo * cover_green. A default (eo_crop_factor_default) is read from the ini file and
!                          is currently to 100 so it is effectively turned off for backwards compatibility.
!                    Unused configuration constants removed -
!                     	X_temp_grain
!                     	Y_grain_rate
!                     	Leaf_app_rate1
!                     	Leaf_app_rate2
!                     	Leaf_no_rate_change
!     Last change:  MJR 13 Dec 2000


!***********************************************************************************************************
!  CONSTANTS  - SPECIES-SPECIFIC PARAMETERS
!***********************************************************************************************************

[standard.butterflypea.constants]

crop_type = butterflypea
default_crop_class = plant
leaf_part = generic_leaf
grain_part_type = harvest_index


stress_determinants = leaf stem meal
yield_parts = meal oil

retrans_parts = leaf stem root

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION - VALUE LIMITS - MAX AND MINS
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!------------------------------------------------------------------------------
!OTHER VARIABLES
! limits set to check inputs

sw_ub                   = 1.0
sw_lb                   = 0.0
year_ub                 = 2000      ()      !  year upper limit
year_lb                 = 1800      ()      !  year lower limit
latitude_ub             = 90        (oL)    !  latitude upper limit
latitude_lb             = -90       (oL)    !  latitude lower limit
maxt_ub                 = 55        (oC)    !  max. temperature upper limit
maxt_lb                 = 0         (oC)    !  max. temperature lower limit
mint_ub                 = 40        (oC)    !  min. temperature upper limit
mint_lb                 = -10       (oC)    !  min. temperature lower limit
radn_ub                 = 50        (MJ/m^2)!  radiation upper limit
radn_lb                 = 1         (MJ/m^2)!  radiation lower limit
dlayer_ub               = 1000      (mm)    !  layer depth upper limit
dlayer_lb               = 0         (mm)    !  layer depth lower limit
dul_dep_ub              = 1000      (mm)    !  drained upper limit upper limit
dul_dep_lb              = 0         (mm)    !  drained upper limit lower limit
sw_dep_ub               = 1000      (mm)    !  soil water upper limit
sw_dep_lb               = 0         (mm)    !  soil water lower limit
no3_ub                  = 10000     (kg/ha) !  soil nitrate upper limit
no3_lb                  = 0         (kg/ha) !  soil nitrate lower limit
no3_min_ub              = 10000     (kg/ha) !  min. soil nitrate upper limit
no3_min_lb              = 0         (kg/ha) !  min. soil nitrate lower limit
nh4_ub                  = 10000     (kg/ha) !  soil ammonium upper limit
nh4_lb                  = 0         (kg/ha) !  soil ammonium lower limit
nh4_min_ub              = 10000     (kg/ha) !  min. soil ammonium upper limit
nh4_min_lb              = 0         (kg/ha) !  min. soil ammonium lower limit

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 1 - CROP PHENOLOGY: Stage and Phase names
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
phenology_model = legume
stage_code_list=  1         2          3         4                5               6           7               8             9            10       12
stage_names = sowing germination emergence end_of_juvenile floral_initiation flowering start_grain_fill end_grain_fill maturity harvest_ripe end_crop
phase_names = sowing germination emergence end_of_juvenile floral_initiation flowering start_grain_fill end_grain_fill maturity harvest_ripe end_crop
phase_type  = generic generic    generic   generic         generic           generic   generic          generic        generic  generic      generic
composite_phases = under_ground above_ground grainfill reproductive leaf_senescence vernalisation  emergence2floral_initiation preflowering node_formation start_grain_fill2harvest_ripe hi_stress_sensitive stress_reporting

under_ground = sowing germination
above_ground =                   emergence end_of_juvenile floral_initiation flowering start_grain_fill end_grain_fill maturity harvest_ripe
leaf_senescence =                                          floral_initiation flowering start_grain_fill end_grain_fill maturity harvest_ripe
reproductive =                                                               flowering start_grain_fill end_grain_fill
grainfill =                                                                            start_grain_fill end_grain_fill
vernalisation=        germination emergence end_of_juvenile
emergence2floral_initiation  =    emergence end_of_juvenile floral_initiation
start_grain_fill2harvest_ripe =                                                         start_grain_fill end_grain_fill maturity
preflowering  =                   emergence end_of_juvenile floral_initiation
node_formation =                  emergence end_of_juvenile floral_initiation flowering start_grain_fill end_grain_fill
hi_stress_sensitive =                                                         flowering
stress_reporting =                          end_of_juvenile floral_initiation flowering start_grain_fill end_grain_fill

[standard.butterflypea.butterflypea]

! list of crop class definitions
plant = butterflypea
small_leaf = butterflypea_small_leaf_perennial butterflypea

class_action = harvest
class_change = unchanged

partition_option = 1
n_uptake_option = 1

leaf_no_pot_option = 1


n_retrans_option = 1
dm_senescence_option = 1
n_senescence_option = 1
n_stress_option = 1

fruit_no_option = 1
parasite_option = 1
root_growth_option = 1

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 0 - CO2
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!!!!!!!!!! JH new block need to calibrate !!!!!!!!!!!!!!!!!

co2_default = 350                      (ppm)
photosynthetic_pathway = C3            (C3, or C4)
x_co2_te_modifier =   350              (ppm co2)
y_co2_te_modifier =   1.0              ()

x_co2_nconc_modifier =  350          (ppm co2)
y_co2_nconc_modifier =  1.0          ()
!!!!!!!!!! JH end new block need to calibrate !!!!!!!!!!!!!!!!!

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 1 - CROP PHENOLOGY
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
stage_code_list                  = 1      2    3     4     5     6     7      8     9    10     11  ()     ! numeric code for phenological stages
stage_stem_reduction_harvest     = 1      2    3     3     4     4     4      4     4     4     11  ()
stage_stem_reduction_kill_stem   = 1      2    3     3     4     4     4      4     4     4     11  ()

!-----------------------------------------------------------------------------------------------------------
!SEED GERMINATION

!Water stress factor for germination
pesw_germ = 0.00 (mm/mm)     !plant extractable soil water in seedling layer inadequate for germination (mm/mm)

!-----------------------------------------------------------------------------------------------------------
!EMERGENCE

shoot_lag =  30.0 (oCd)      ! Time lag before linear coleoptile growth starts (deg days)
shoot_rate = 3.0  (oCd/mm)   ! Growing deg day increase with depth for coleoptile (deg day/mm depth)

!Water stress factor for emergence
fasw_emerg     = 0.0  1.0    ! Fraction of available soil water
rel_emerg_rate = 1.0  1.0    ! Stress factor for thermal time calculation between germination and emergence

!fasw_emerg     = 0.0  0.5   1.0    ! Fraction of available soil water
!rel_emerg_rate = 0.0  1.0   1.0    ! Stress factor for thermal time calculation between germination and emergence

!-----------------------------------------------------------------------------------------------------------
!PHOTOPERIOD AND TWILIGHT

twilight = -6.0 (o)   ! Twilight is defined as the interval between sunrise or sunset and the time when the true
                      ! centre of the sun is 2.2 degrees below the horizon. Sunrise or sunset is defined as when
                      ! the true centre of the sun is 50' below the horizon.

!-----------------------------------------------------------------------------------------------------------
!Vernalisation

x_vernal_temp = 0 2  8  15
y_vernal_days = 1 1  1  1

!-----------------------------------------------------------------------------------------------------------
!THERMAL TIME CALCULATION

!Thermal time calculation
x_temp                  = 15.0 32.0  40.0        (oC)   ! temperature table for thermal time
y_tt                    = 0.0  17.0   0.0        (oCd)  ! thermal time

x_removeBiomPheno       = 0.0  0.1   0.4  0.5  1.0       ()  ! fraction of above ground biomass removed
y_removeFractPheno      = 0.0  0.08  0.4  0.5  1.0     ()  ! fraction of above ground thermal time removed

!-----------------------------------------------------------------------------------------------------------
!LEAF NUMBER DEVELOPMENT

!currently leaf number at emergence will affect LAI at early stage, leaf_no_seed has no effect on the model, but will have in future

leaf_no_at_emerg = 2.0     ! (expanded) leaf number at emergence ()


x_node_no_app    = 0    30
y_node_app_rate  = 32   32   !!was 35

!
x_node_no_leaf   = 0  2    7     12    16
y_leaves_per_node= 1  1   2.0    3.0   5.0

x_lai_ratio      = 0.0  0.8 1.0 () ! ratio table for critical leaf size below which leaf number is reduced ()
y_leaf_no_frac   = 1.0  1.0 1.0  () ! reduction in leaf appearance ()

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 2 - PHOTOSYNTHESIS, BIOMASS GROWTH AND PARTITION
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!PHOTOSYNTHESIS AND RADIATION USE EFFICIENCY (RUE)
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!STAGE DEPENDENT RUE
!                      sow    ger   eme  juv    fi    fl   st_gf end_gf  mat hv_rpe  end
!stage_code            = 1      2    3     4     5     6     7      8     9    10     11  ()
x_stage_rue      = 1      2    3     4     5     6     6.999  7      7.999  8     9      10    11  ()     ! numeric code for phenological stages
y_rue            = 0      0    1.0  1.0   1.0   1.0    1.0    0.60   0.045  0.00  0.00  0.00   0  (g/MJ)

!-----------------------------------------------------------------------------------------------------------
!EXTINCTION COEFFICIENT

!ROW SPACING DETERMINED
skiprow_default     = 0
row_spacing_default = 300 (mm)      !!was 500
x_row_spacing      = 200  1000           ! from Flenet et al Agron J vol. 88: 185-190
y_extinct_coef     = 0.60 0.60
y_extinct_coef_dead= 0.30 0.30

!POD EXTINCTION COEFFICIENT and RUE
extinct_coef_pod =  0   ()
spec_pod_area    =  0 (mm^2/g)
rue_pod          =  0   (g/MJ)
!-----------------------------------------------------------------------------------------------------------
!TEMPERATURE RESPONSE OF PHOTOSYNTHESIS - RUE

x_ave_temp      = 10.0  20.0  30.0  40.0 (oC)  ! mean daily temperature
y_stress_photo  = 0.0   1.0   1.0   0.0  ()    ! multiplier on RUE

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!BIOMASS INITIATION, PARTITION AND TRANSLOCATION
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!INITIATION

! part weights at emergence
root_dm_init = 0.2  (g/plant)
leaf_dm_init = 0.3
stem_dm_init = 0.4
pod_dm_init = 0.0
meal_dm_init = 0.0
oil_dm_init = 0.0

!-----------------------------------------------------------------------------------------------------------
!TRANSLOCATION PARTS

stem_trans_frac = 0.30 ()     ! fraction of stem used in translocation to grain - not used for i_wheat option
leaf_trans_frac = 0.10 ()     ! fraction of leaf used in translocation to grain
pod_trans_frac  = 0.00 ()     ! fraction of podwall used in translocation to grain
meal_trans_frac  = 0.00 ()     ! fraction of meal used in translocation to grain
oil_trans_frac  = 0.00 ()     ! fraction of oil used in translocation to grain
root_trans_frac  = 0.00 ()     ! fraction of root used in translocation to grain

!-----------------------------------------------------------------------------------------------------------
!BIOMASS PARTITIONING

!                      sow    ger   eme  juv    fi    fl    st_gf end_gf  mat hv_rpe  end
!stage_code           = 1      2    3     4     5     6      7      8     9    10     11   ()
ratio_root_shoot      = 0      0    1.0   1.0   0.33  0.33   0.087  0     0     0      0   (0-1)
frac_leaf             = 0      0    0.80  0.70  0.50  0.50   0.30   0.30  0     0      0   (0-1)  ! fraction of remaining dm allocated to leaves
frac_pod              = 0      0    0     0     0     0.40   0.28   0.28  0     0      0   (0-1)  ! fraction of dm allocated to pod or multiplier of grain dm to account for pod dm
!-----------------------------------------------------------------------------------------------------------
!GRAIN NUMBER DETERMINATION

!-----------------------------------------------------------------------------------------------------------
!GRAIN FILLING

sw_fac_max              = 1.125     ()      !  soil water stress factor maximum
temp_fac_min            = 0.69      ()      !  temperature stress factor minimum
sfac_slope              = -0.125    ()      !  soil water stress factor slope
tfac_slope              = 0.0125    ()      !  temperature stress factor slope

carbo_oil_conv_ratio    = 1.0               ! Carbohydrate:oil conversion ratio (>= 1.0)
grain_oil_conc          = 0.0                 ! fractional oil content of grain (0-1)

!-----------------------------------------------------------------------------------------------------------
!GRAIN WATER CONTENT

grn_water_cont = 0.12 (g/g)           ! water content of grain g/g

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 3 - LEAF/STEM/POD AREA GROWTH
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!------------------------------------------------------------------------------
!LEAF SIZE AS A FUNCTION OF LEAF NUMBER

! mungbean numbers
node_no_correction = 1.2
x_node_no   = 1     2     4      6       10     12     15
!y_leaf_size =7400  8400  20000  24000   24000  16800  9900
y_leaf_size = 7400  8400  15000  24000   24000  24000  24000

!------------------------------------------------------------------------------
!SPECIFIC LEAF AREA - SLA

x_lai       =   0.5   4
y_sla_max   = 35000 35000          ! maximum specific leaf area for delta LAI

sla_min         =  18000           ! minimum specific leaf area for delta LAI

!------------------------------------------------------------------------------
!TPLA  - USED TO INTIALISE THE INITIAL LAI

initial_tpla    = 3500    (mm^2/plant)  ! initial total plant leaf area

!------------------------------------------------------------------------------
!HARVESTING EFFECTS ON LEAF AREA

fr_height_cut           = 0.0  0.1    1
fr_stem_remain          = 0.0  0.2    1

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 4 - ROOT DEPTH AND ROOT LENGTH GROWTH
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!-----------------------------------------------------------------------------------------------------------
!ROOTING DEPTH

!                      sow    ger   eme  juv    fi    fl   st_gf end_gf  mat hv_rpe  end
!stage_code           = 1      2    3     4     5     6     7      8     9    10     11  ()
root_depth_rate       = 0      10.0 20.0  25.0  25.0  25.0  0.0    0.0   0.0   0.0    0  (mm/d)

!Effect of sw_supply_demand_ratio on root depth increase
x_ws_root       = 0   1   !sw_supply_demand_ratio
y_ws_root_fac   = 1   1   !effect of supply_demand_ratio on root depth increase


!x_sw_ratio = [sw_dep(lay)-ll_dep(lay)]/[dul_dep(lay)-ll_dep(lay)] in the deepest root layer

x_sw_ratio       = 0.0 0.25 ()       ! water availability for effects on root depth growth
y_sw_fac_root    = 0   1    ()       ! stress factor for root depth growth, This may be probably the same for all crops

!-----------------------------------------------------------------------------------------------------------
!TEMPERATURE EFFECT ON ROOT ADVANCE

x_temp_root_advance = 0 20 32
y_rel_root_advance  = 1 1  1

!-----------------------------------------------------------------------------------------------------------
!ROOT LENGTH CALCULATION

initial_root_depth   = 110.0 (mm)          ! initial depth of roots (mm)
specific_root_length = 60000 (mm/g)

!The following can increase or decrease the root length density in a layer based on the rld per plant

x_plant_rld             = 0   0.0001  0.0003 (mm/mm3/plant)  ! root branching
y_rel_root_rate         = 0.02  0.10  1.0   (0-1)
!y_rel_root_rate          = 1.0   1.0   1.0   (0-1)

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 5 - WATER RELATIONS AND WATER STRESS FACTORS
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!STAGE DEPENDENT TRANSPIRATION EFFICIENCY COEFFICIENTS

!Transpiration efficiency coefficient to convert vpd to transpiration efficiency (kpa)
!The following transp_eff_cf values are
!in the form kpa/g carbo per m^2 / g water per m^2 (kpa/g carbo per m^2 / mm water) because 1g water = 1 cm^3 water

!                      sow    ger   eme  juv    fi    fl   st_gf end_gf  mat   hv_rpe  end
!stage_code           = 1      2    3     4     5     6     7      8     9     10      11  ()
transp_eff_cf         = 0      0    .005  .005  .005  .005  .005  .005   .0020 .0020   .0 (Pa)   !

!-----------------------------------------------------------------------------------------------------------
!VPD FRACTION

!Fraction of distance between svp at min temp and svp at max temp where average svp during transpiration lies.
svp_fract   = 0.75  !   (0-1)
eo_crop_factor_default = 100.0  ! default crop factor for limiting soil
                                ! water demand to some fraction/multiple
                                ! of atmospheric potential.



!-----------------------------------------------------------------------------------------------------------
!WATER STRESS FACTORS FOR PHOTOSYNTHESIS, EXPANSION AND DEVELOPMENT

!swdef_photo for photosynthesis is calculated in the code as = sw_supply_sum/sw_demand - function crop_swdef_photo

!For expansion growth, more sensitive than other growth processes
!x_sw_demand_ratio = sw_supply_sum/sw_demand

x_sw_demand_ratio= 0.1 1.1 ()          ! water availability
y_swdef_leaf     = 0   1   ()          ! stress indices

!For phenology stress factor based on available soil water portion
!sw_avail_pot_sum = sum_real_array (sw_avail_pot, deepest_layer),
!sw_avail_sum     = sum_real_array (sw_avail, deepest_layer)
!sw_avail_ratio   = divide (sw_avail_sum, sw_avail_pot_sum, 1.0) !???

x_sw_avail_ratio = 0.0 0.16 ()           ! water availability
y_swdef_pheno    = 1.0 1.0  ()           ! stress index for phenology

!!!!!!!!!! JH new block need to calibrate !!!!!!!!!!!!!!!!!
x_sw_avail_ratio_flower =    0.2   0.50  1.0  ()         ! water availability
y_swdef_pheno_flower    =    1.0   1.0    1.0  ()        ! stress index for flowering phenology

x_sw_avail_ratio_grainfill = 0.2   0.50   1.0  ()        ! water availability
y_swdef_pheno_grainfill    = 1.0   1.0    1.0  ()        ! stress index for grainfilling phenology

!!!!!!!!!! JH end new block need to calibrate !!!!!!!!!!!!!!!!!

!-----------------------------------------------------------------------------------------------------------
!WATERLOGGING STRESS (OXYGEN DEFICIT) FACTOR FOR PHOTOSYNTHESIS

oxdef_photo_rtfr        = 0.0  0.8   1.0         ()     ! fraction of roots waterlogged for effect on photosynthesis
oxdef_photo             = 1.0  1.0   1.0         (0-1)  ! stress index on photosynthesis

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 6 -NITROGEN RELATIONS, UPTAKE AND STRESS FACTORS
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!------------------------------------------------------------------------------
!UPTAKE PREFERENCE AND CONSTANTS

!preference for n supply - it is assumed that mass flow is always predominant, but further crop preference can
!be specified as follows:
! 'active'   = diffusive flow before fixation
! 'fixation' = fixed N before active uptake.

n_supply_preference = active

!Time constant for N uptake by diffusion. H van Keulen &  NG Seligman. Purdoe 1987.
!This is the  time it would take to remove, by diffusion, current amount of N if it wasn't depleted between time steps

no3_diffn_const  = 2.0 (days)

!------------------------------------------------------------------------------
!LEGUME N FIXATION RATE - potential rate of N fixation (g N fixed per g above ground biomass)

!                      sow    ger   eme  juv    fi    fl    st_gf end_gf  mat hv_rpe  end
!stage_code           = 1      2    3     4     5     6      7      8     9    10     11  ()
N_fix_rate            = 0      0    0.003 0.003 0.003 0.003  0.002  0     0     0      0  (gN/gDM)

x_sw_avail_fix          = 0.0  0.50  0.95  1.0   ()     ! soil water ratio for effect on N fixation
y_swdef_fix             = 0.0  1.0   1.0   1.0   (0-1)  ! stress index on N fixation

!------------------------------------------------------------------------------
!NITROGEN STRESS FACTORS FOR PHOTOSYNTHESIS,LEAF GROWTH AND DEVELOPMENT

!n_conc_ratio      = divide ((N_conc_stover - N_conc_stover_min),(N_conc_stover_crit-N_conc_stover_min),0.0)
!n_conc_ratio_leaf = divide ((N_conc_leaf - N_conc_leaf_min), (N_conc_leaf_crit - N_conc_leaf_min), 0.0)
!g_nfact_photo     = N_fact_photo * N_conc_ratio
!g_n_fact_pheno    = N_fact_pheno * N_conc_ratio
!g_nfact_expansion = N_fact_expansion * n_conc_ratio_leaf

!!!!!!!!!! JH new block need to calibrate !!!!!!!!!!!!!!!!!
N_stress_start_stage = 3   ! N stress can start at emergence
!!!!!!!!!! JH end new block need to calibrate !!!!!!!!!!!!!!!!!

N_fact_photo     = 1.25    ! multipler for N deficit effect on photosynthesis

N_fact_expansion = 100     ! multipler for N deficit effect on leaf expansion

N_fact_pheno     = 5.75     ! multipler for N deficit effect on phenology

!------------------------------------------------------------------------------
!NITROGEN CONCENTRATION LIMITS: MAX. CRITICAL AND MINIMUM N CONCENTRATIONS

                        ! emerg    flower   maturity
x_stage_code            = 3        6        9        () ! stage code used in table

y_n_conc_min_leaf       = 0.0200   0.0100   0.0100   () ! leaf minimum N conc.
y_n_conc_crit_leaf      = 0.0650   0.0550   0.0300   () ! leaf critical N conc.
y_n_conc_max_leaf       = 0.0650   0.0550   0.0300   () ! leaf maximum N conc.

y_n_conc_min_stem       = 0.0150   0.0100   0.0100   () ! stem minimum N conc.
y_n_conc_crit_stem      = 0.0500   0.0400   0.0150   () ! stem critical N conc.
y_n_conc_max_stem       = 0.0500   0.0400   0.0150   () ! stem maximum N conc.

y_n_conc_min_pod        = 0.0200   0.0100   0.0100   () ! flower minimum N conc.
y_n_conc_crit_pod       = 0.0600   0.0400   0.0100   () ! flower critical N conc.
y_n_conc_max_pod        = 0.0600   0.0400   0.0100   () ! flower maximum N conc.

n_conc_min_grain        = 0.060                      () ! grain minimum N conc.
n_conc_crit_grain       = 0.075                      () ! grain maximum N conc.
n_conc_max_grain        = 0.075                      () ! grain critical N conc.

n_conc_min_root         = 0.00795                    () ! root minimum N conc.
n_conc_crit_root        = 0.01500                    () ! root maximum N conc.
n_conc_max_root         = 0.01500                    () ! root critical N conc.


y_n_conc_min_meal    =    0.0   0.060    0.060      ()
y_n_conc_crit_meal   =    0.0   0.075    0.075      ()
y_n_conc_max_meal    =    0.0   0.075    0.075      ()

y_n_conc_min_oil    =   0.0    0.0    0.0   ()
y_n_conc_crit_oil   =   0.0    0.0    0.0   ()
y_n_conc_max_oil    =   0.0    0.0    0.0   ()

!------------------------------------------------------------------------------
!INITIAL NITROGEN CONCENTRATION OF ORGANS

!             root
root_n_init_conc = 0.022
leaf_n_init_conc = 0.065
stem_n_init_conc = 0.045
pod_n_init_conc = 0.0
meal_n_init_conc = 0.0
oil_n_init_conc = 0.0

!------------------------------------------------------------------------------
!NITROGEN CONCENTRATION IN SENESCENCED ORGANS
!This means that as soon as leaves fall off, all N except for the amount below is
!instantly transferred from leaves to stem

!            root
root_n_sen_conc = 0.005
leaf_n_sen_conc = 0.01
stem_n_sen_conc = 0.0
pod_n_sen_conc = 0.0
meal_n_sen_conc = 0.0
oil_n_sen_conc = 0.0

!------------------------------------------------------------------------------
!GRAIN NITROGEN CONCENTRATION

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 7 -SENESCENCE AND DETACHMENT
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!------------------------------------------------------------------------------
!DM SENESCENCE

root_die_back_fr = 0.1  (0-1) ! fraction of roots lost at harvest

! dm fraction senesced for each fraction of canopy senesced.
x_dm_sen_frac_root = 0    1     ! root
y_dm_sen_frac_root = 0.005 0.005
x_dm_sen_frac_leaf = 0    1     ! leaf
y_dm_sen_frac_leaf = 0    1
x_dm_sen_frac_stem = 0    1     ! stem
y_dm_sen_frac_stem = 0    0
x_dm_sen_frac_pod = 0    1     ! flower
y_dm_sen_frac_pod = 0    0
x_dm_sen_frac_meal = 0    1     ! meal
y_dm_sen_frac_meal = 0    0
x_dm_sen_frac_oil = 0    1     ! oil
y_dm_sen_frac_oil = 0    0

!------------------------------------------------------------------------------
!LEAF NUMBER AND AREA SENESCENCE

min_tpla                = 0.0   ()   ! lower limit of total plant leaf area
sen_start_stage = 6                  ! stage at which age senescence starts
node_sen_rate           = 100   (oCd/node) !  rate of node senescence on main stem
fr_lf_sen_rate          = 0.01   ()         !  fraction of total leaf number senescing per main stem node
!!!!!!!!!! JH new block need to calibrate !!!!!!!!!!!!!!!!!
n_fact_lf_sen_rate      = 0.0     ! max relative increase in leaf senescence due to N stress
!!!!!!!!!! JH end new block need to calibrate !!!!!!!!!!!!!!!!!

lai_sen_light = 4.0  (m^2/m^2)    ! induced senescence occurs (m^2/m^2)
sen_light_slope = 0.02()         ! sensitivity of leaf area senescence to shading

x_temp_senescence = 0.0   5.0  !  4.0  12.0     ! minimum temperature for frost senescence table (oC)
y_senescence_fac  =  1    0       ! daily fraction of leaf area senesced due to frost (0-1)

sen_rate_water = 0.05 ()          ! slope in linear eqn relating soil water stress during photosynthesis to leaf senesence rate

!------------------------------------------------------------------------------
!DETACHMENT

                 ! root

root_dead_detach_frac = 0   ()      ! fraction detached from each part of a dead plant per day.
root_sen_detach_frac =  1   ()      ! fraction of senesced plant part detached each day from live plants
leaf_dead_detach_frac = 0.0
leaf_sen_detach_frac =  0.0
stem_dead_detach_frac = 0.0
stem_sen_detach_frac =  0.0
pod_dead_detach_frac = 0.0
pod_sen_detach_frac =  0.0
meal_dead_detach_frac = 0.0
meal_sen_detach_frac =  0.0
oil_dead_detach_frac = 0.0
oil_sen_detach_frac =  0.0

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 8 - WE MIGHT PUT RETRANSLOCATION OF DM AND N IN THIS SECTION
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 9 - CROP FAILURE AND DEATH
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!------------------------------------------------------------------------------
! crop failure

leaf_no_crit    =  10.0      ()     ! critical number of leaves, below which portion of the crop may die due to water stress
tt_emerg_limit  = 300.0     (oCd)   ! maximum degree days allowed for emergence to take place
days_germ_limit = 40.0      (days)  ! maximum days allowed after sowing for germination to take place (days)
swdf_photo_limit= 99.0      ()      ! critical cumulative photosynthesis water stress, above which the crop partly fails (unitless)
swdf_photo_rate = 0.0       ()      ! rate of plant reduction with photosynthesis water stress
swdf_pheno_limit = 25       ()      ! critical cumulative phenology water stress, above which the crop fails (unitless)

!------------------------------------------------------------------------------
!PLANT DEATH

x_weighted_temp = 55.0  60.0  (oC)
y_plant_death   =  0.0   1.0

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION 10 - PHOSPHORUS RELATIONS, UPTAKE AND STRESS FACTORS
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!SECTION - VALUE LIMITS - MAX AND MINS
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

!------------------------------------------------------------------------------
!ROOT PARAMETERS

ll_ub  = 1000.0 ()                     ! upper limit of lower limit
kl_ub  = 1.0    ()                     ! upper limit of water uptake factor

!------------------------------------------------------------------------------
!SOIL WATER

minsw  = 0.00001 ()                    ! lowest acceptable value for ll

! cultivar parameter upper bounds

tt_emerg_to_endjuv_ub       = 1000.0 (oCd)   ! upper limit
tt_flower_to_maturity_ub    = 1500.0 (oCd)   ! upper limit
tt_maturity_to_ripe_ub      = 1000.0 (oCd)   ! upper limit
tt_flower_to_start_grain_ub = 1000.0 (oCd)   ! upper limit
tt_init_to_flower_ub        = 1000.0 (oCd)   ! upper limit

!***********************************************************************************************************
!  PARAMETERS  - CROP CLASS SPECIFIC VALUES
!***********************************************************************************************************

[standard.butterflypea.butterflypea_small_leaf_perennial]
! smaller leaf sizes for Endurance type of cultivar

x_node_no   = 1     2     4      6       10     12     15
y_leaf_size = 3800  4400  9600   11200   13000  11300  7600

initial_tpla    = 1000    (mm^2/plant)  ! initial total plant leaf area

min_tpla = 5

!***********************************************************************************************************
!  PARAMETERS  - CULTIVAR-SPECIFIC VALUES
!***********************************************************************************************************

[standard.butterflypea.milgarra]

   x_pp_hi_incr               =    1      24    (h)
   y_hi_incr                  =    0.03   0.03   (1/days)     ! rate of HI increase (optional)
   x_hi_max_pot_stress        =    0.0  1.0   ()          ! maximum harvest index potential
   y_hi_max_pot               =    0.20 0.20  () !0.25 0.25 ! 0.35 0.35  ()
   cum_vernal_days            =   0       100   (d)
   tt_emerg_to_endjuv         =  500      500   (oCd)    ! TT from emergence to end of juvenile phase
   est_days_emerg_to_init     =  20         (d)          ! estimated days from emergence to floral init.
   x_pp_endjuv_to_init        = 13.3   18.0   (h)        ! photoperiod (h)
   y_tt_endjuv_to_init        = 600     600   (oCd)      ! TT from end juvenile to floral initiation
   x_pp_init_to_flower        =   1      24   (h)
   y_tt_init_to_flower        =   20.0  20.0  (oCd)           ! TT from initiation to flowering
   x_pp_flower_to_start_grain =   1      24   (h)
   y_tt_flower_to_start_grain =  100.0   100 (oCd)           ! TT from flowering to start grain fill
   x_pp_start_to_end_grain    =   1      24   (h)
   y_tt_start_to_end_grain    =   900   900 (oCd) !1300   1300  (oCd)
   tt_end_grain_to_maturity   =   400       (oCd) ! 60     (oCd)
   tt_maturity_to_ripe        =    5.0      (oCd)        ! TT from maturity to harvest ripe
   x_stem_wt                  = 0      15   (g)          ! stem weight (g/plant)
   y_height                   = 0      1200 (mm)         ! plant height (mm)
